## Changelog ‚Äì 12. juli 2025 ##
Noter p√• Bucketlist:
Implementeret funktionalitet til at oprette, redigere og slette noter (historik) tilknyttet hvert bucket-m√•l via separat tabel bucket_history.
Noter vises nu direkte i modalboksen for det enkelte m√•l.

Visning af antal noter:
Der er arbejdet p√• at vise ‚ÄúDer er X noter‚Äù nederst p√• hvert bucket-kort p√• forsiden.
Funktionen er delvist implementeret, men ikke f√¶rdiggjort/aktiveret endnu.

Fejlfinding og integration:
Fejl i noteflow relateret til user-id, bucket-id og foreign key i Supabase identificeret og l√∏st.
Test af insert direkte i SQL-editor for at sikre validitet af UUIDs og relationer.

Tilf√∏jet/√¶ndret:

Ny tabel: error_log

Kolonner:

id (uuid, primary key)

title (text)

description (text)

page (text, hovedside-navn)

subpage (text, underpunkt-navn, nullable)

category (text, v√¶rdier: 'Kritisk', 'Mindre fejl')

created_at (timestamp, default now())

Ny tabel: error_pages

Kolonner:

id (uuid, primary key)

name (text)

parent_id (uuid, nullable, reference til id i samme tabel for underpunkter)

created_at (timestamp, default now())

Tilf√∏jet/√¶ndret i idebanken:

Kolonnerne importance og created_at i idea_bank

Kolonnen parent_id i idea_pages (for at underst√∏tte underpunkter)

Triggers (valgfrit):

Trigger oprettet, s√• nye sider/underpunkter tilf√∏jet i idea_pages automatisk oprettes i error_pages (og omvendt, hvis valgt).

Indexes:

(valgfrit/kan anbefales) Indexes p√• page, subpage og category i b√•de idea_bank og error_log for hurtigere s√∏gninger og filtrering.

Tilf√∏jelse af billedupload til Manifestation Board
Ny funktionalitet: Mulighed for at uploade et bannerbillede ved oprettelse af manifestation.

Redigeringsmodal: Tilf√∏jet billeduploadfelt i redigeringsmodal, s√• man kan √¶ndre/bytte billedet p√• eksisterende manifestationer.

Billedvisning: Bannerbilledet vises nu b√•de i kortoversigten og i modalvisningen.

Uploadh√•ndtering: Upload af billeder gemmes i Supabase Storage under bucket manifestation-images.

Forbedret brugeroplevelse: Upload-knapper deaktiveres under billedupload, og der vises upload-status.

Fejlh√•ndtering: Visning af fejlbeskeder ved upload- eller opdateringsfejl.

Kodeforbedringer: Refaktoreret Modal-komponent til bedre state-h√•ndtering af billedupload, titel og beskrivelse.

Status og Opdatering ‚Äì Alkohol-sektion
Seneste √¶ndringer:

Tilf√∏jede felter og funktioner:
1. Stemning (Mood)
Viser fordelingen af daglige stemninger (frost, k√∏lig, neutral, lun, hed) med doughnut-diagram.

Lister opt√¶lling for hver stemningstype.

2. Top f√∏lelser/tanker (Tags)
Bar chart viser de 12 mest brugte tags for f√∏lelser/tanker, sorteret efter hyppighed.

3. Udvikling over tid (Linje-diagram)
Viser m√•nedlig udvikling i positive og negative tanker/f√∏lelser, baseret p√• valgte m√•neder (3, 6, 12, 24).

4. Blomster
Viser hvor mange dage siden, du sidst har givet blomster til din partner.

Viser besked hvis du aldrig har givet blomster, eller hvis det er gjort i dag.

5. Gaver
Viser hvor mange dage siden, du sidst har givet en gave.

Viser hvor mange gaver du samlet har givet, og total v√¶rdi i kroner.

Beregner gennemsnitlig udgift pr. dag siden fast startdato (11/7-2025).

6. Alkohol
Doughnut-diagram for fordeling mellem ‚ÄúAlkohol drukket‚Äù og ‚ÄúIngen alkohol‚Äù.

Farver og labels matcher nu intentionen (gr√∏n for alkohol, gul for ingen).

Opt√¶lling og forklaring i tekst under diagrammet.

7. √Ürlighedssnak
T√¶ller antal registrerede √¶rlighedssamtaler (honesty_talk).

Viser liste over alle registrerede snakke med dato og evt. emne.

8. ‚ÄúJeg elsker dig‚Äù ‚Äì hvem sagde det f√∏rst?
Doughnut-diagram og liste, som viser hvem der har sagt ‚Äújeg elsker dig‚Äù f√∏rst/kun (mig, partneren, begge, ingen).

Viser ogs√• hvor mange dage siden, du/partneren/sidst har sagt det.

Viser hvis ingen nogensinde har sagt det.

Generelle forbedringer
Alle diagrammer og lister opdateres dynamisk baseret p√• periodevalg (antal m√•neder).

Alle felter og visualiseringer tr√¶kker p√• daglige checkins i Supabase.

Nye aggregationer og beregninger tilf√∏jet for at f√• mere pr√¶cis statistik og brugerfeedback.

## Changelog ‚Äì 11. juli 2025 Part 1 ##
Database√¶ndringer
Tilf√∏jet tabel manifestation_points med kolonner:

id (unik identifikator)

title (titel p√• manifestpunkt)

content (HTML eller tekstindhold for manifestpunktet)

remind_me (boolean, om punktet skal vises i widget)

created_at (timestamp)

Funktionelle √¶ndringer i Manifestation og Widget
Omdannet manifest-widget /components/widgets/ManifestReminderWidget.tsx til at:

Hente punkter fra manifestation_points i stedet for kun manifestations

Splitte content i flere afsnit baseret p√• nummerering og linjeskift

Vise √©t tilf√¶ldigt manifestpunkt pr. dag, baseret p√• dag i √•ret modulo antal punkter

Justeret eksisterende manifestation-funktionalitet, s√• data fra manifestation_points indg√•r korrekt i widget.

Widget underst√∏tter nu visning af et enkelt manifestpunkt dagligt med titel og indhold.

Fremtidige planer (noter)
Udvikling af AI-genereret profiltekst baseret p√• udvalgte kolonner i bruger- og partnerprofiler.

Overvejelse af settings-side /settings/profileheadersuggestion til at v√¶lge hvilke kolonner der skal inkluderes i AI-prompt.

Mulighed for dynamisk tilpasning af tekst baseret p√• brugerens og partnerens data.

Forventet proof-of-concept klar inden for 30-60 minutter, fuld implementering p√• 2-3 timer.

## Changelog ‚Äì 10. juli 2025 Part 4 ##
Log over notifikationsprojektet ‚Äì Status og problemstillinger
Hvad vi har lavet
Notifikationstyper (konfiguration)
Vi har defineret notificationsConfig.ts med klare typer, skabeloner, links og ikoner for notifikationer.

Funktion til oprettelse af notifikationer (createNotification)
En funktion i /lib/notifications.ts, som opretter notifikationer i databasen med korrekt tekst og link baseret p√• config.

Parsing af notifikationer (parseNotification)
Funktion der omdanner r√• notifikationer til frontend-venligt format med tekst, link, ikon og type.

DashboardUserWidget-komponenten
En React-komponent der viser notifikationsikon, antal ul√¶ste og en dropdown med parsed notifikationer.

NotificationSettingsPage-komponenten
En settings-side, hvor brugeren kan sl√• notifikationstyper til og fra. Denne gemmer indstillinger i notification_settings tabellen.

Filtrering af notifikationer i widget
Widgetten henter brugerens notification_settings og filtrerer notifikationer, s√• kun aktiverede typer vises.

RLS-politikker i Supabase
Vi har gennemg√•et n√∏dvendigheden af RLS (Row Level Security) p√• b√•de notifications og notification_settings tabellerne.

De v√¶sentlige problemer og hvorfor det ikke virker
Notifikationer oprettes ikke som forventet

Problemer med createNotification kald i frontend (fx i bucket-oprettelse).

Mulige RLS regler i Supabase, som blokerer inds√¶ttelse uden fejlbesked.

Manglende eller ukorrekt oprettede r√¶kker i notifications.

notification_settings opdateres ikke eller bruges ikke

Selvom tabellen eksisterer, bliver den ikke opdateret korrekt ved brugerens valg.

Upsert-kald i frontend kan fejle pga. ukorrekt onConflict eller manglende constraint.

Manglende synkronisering mellem notification_settings og filtrering af notifikationer.

Filtrering i widget fejler pga. manglende type i parsed notifikationer

parseNotification manglede at returnere type felt, s√• filterfunktionen fejlede.

Dette er nu rettet, men kan have p√•virket tidligere test.

Filtypen og JSX-forvirring

Forkert brug af .ts vs .tsx filer skabte syntaksfejl og frustration.

createNotification skal v√¶re i .ts, React-komponenter i .tsx.

Manglende debug logs i kritiske funktioner

Vi har tilf√∏jet flere console.log, men kan have overset at f√∏lge flowet helt til databaseinds√¶ttelse og RLS fejl.

Manglende klar separation mellem ‚Äúnotifikationer‚Äù og ‚Äúnotifikationsindstillinger‚Äù

Uklare forventninger til hvordan notification_settings skal bruges.

Ingen tydelig dokumentation eller eksisterende backend-logik, der forbinder indstillinger med filtrering.

Anbefaling til n√¶ste session
Gennemg√• RLS-politikker i Supabase for begge tabeller grundigt
S√¶t simple policies op til test med tilladelse til alle handlinger for din bruger, for at isolere om RLS blokerer.

Tilf√∏j og test debug-logs helt nede i backend/API og Supabase-klientens insert/upsert-kald
Bekr√¶ft at kald n√•r databasen, og log fejl.

Test manuel SQL-inds√¶ttelse i Supabase SQL-editor for b√•de notifications og notification_settings
Bekr√¶ft at inds√¶ttelser ikke fejler.

Isoler frontend-kald
Pr√∏v simple fetch/upsert uden UI-komponenter for at sikre at datah√•ndtering virker.

Dokument√©r datamodellen
Saml alle tabelstrukturer, constraints, RLS-politikker og forventede felter i et dokument.

Byg trinvis: f√∏rst sikre oprettelse af notifikationer, dern√¶st visning, til sidst filtrering.


## Changelog ‚Äì 10. juli 2025 Part 3 ##
Changelog & Status for /app/indtjekning/sex/page.tsx
Hvad vi har lavet indtil nu
Hele sexlog-systemet:

Formular til at oprette og redigere sexlogs med felter: dato, tid, initiativ, type, "vi pr√∏vede noget nyt", stillinger, placering, sted, tags.

Valgfelter og autocomplete p√• stillinger (positions), placeringer (locations), steder (places) og tags ‚Äì alt synkroniseres til Supabase.

Mulighed for at tilf√∏je nye stillinger, placeringer, steder og tags direkte fra UI.

Under ‚Äúvi pr√∏vede noget nyt‚Äù kan man v√¶lge og gemme en stilling som blev pr√∏vet for f√∏rste gang.

Rediger-funktion: Man kan v√¶lge en tidligere log og f√• alle v√¶rdier fyldt ud, klar til redigering.

Gem/redig√©r logik:

Hvis man opretter ny log, laves der INSERT i sexlife_logs, og tilh√∏rende batch-inserts i relationstabellerne (positions, locations, places, tags).

Hvis man redigerer eksisterende log (via editingId), opdateres hovedloggen (UPDATE), og ALLE gamle relationer i de fire koblingstabeller slettes og genskabes med nye v√¶rdier.

Seneste logs vises i bunden:

Viser de fem nyeste registreringer, kan √•bnes til redigering.

State resetter korrekt efter gem/annuller.

Hvad er problemet lige nu?
Kort version:

N√•r man redigerer en eksisterende sex-log og tilf√∏jer/fjerner en stilling (position), s√• bliver den ikke korrekt opdateret i visningen (eller i databasen). Enten bliver koblingen ikke gemt, eller ogs√• vises den ikke efterf√∏lgende i UI.

Det vi har pr√∏vet:

Vi har sikret, at der:

Laves UPDATE p√• hovedtabellen.

SLETTES ALT i de fire koblingstabeller for den aktuelle log_id.

Herefter INSERTES de nye koblinger.

Vi har testet med console.log og set, at selectedPositions har de rigtige IDs ved gem.

Vi har sikret at fetchLogs kaldes, s√• UI henter seneste data.

Der er ingen SQL/JS errors i consollen.

State bliver nulstillet og loggen lukkes.

Men:

Efter redigering mangler de nye/√¶ndrede stillinger i listen.

UI kan godt vise de gamle v√¶rdier, som om den ikke f√•r den nye kobling med fra Supabase.

Det g√¶lder is√¶r for ‚Äústillinger‚Äù ‚Äì de andre felter lader til at virke.

Forslag til n√¶ste GPT/udvikler
Fokus√©r p√• koblingen mellem sexlife_logs og sexlife_log_positions:

Tjek om selectedPositions faktisk indeholder de rigtige IDs ved redigering og gem.

Tjek at de nye INSERTs i sexlife_log_positions faktisk bliver lavet i Supabase.

Tjek at fetchLogs virkelig f√•r de nye koblinger med hjem fra Supabase ‚Äì is√¶r at select-statementet matcher!

Tjek at der ikke er caching, race conditions, eller stale state der forhindrer ny visning.

Supabase join-syntax skal inkludere nested objekter: M√•ske mangler en dybere join/rel.

Eksempel p√• select-statement vi bruger nu (til logs og koblinger):

js
Kopi√©r
Rediger
supabase
  .from('sexlife_logs')
  .select('*, sexlife_log_positions(position_id), sexlife_log_locations(location_id), sexlife_log_places(place_id), sexlife_log_tags(tag_id)')
  .order('log_datetime', { ascending: false })
  .limit(5)
TL;DR:
N√•r man redigerer en sexlog og v√¶lger nye stillinger, gemmes √¶ndringen ikke synligt ‚Äì eller ogs√• hentes den ikke korrekt hjem igen. Koblingen ‚Äústillinger‚Äù for en given log driller stadig.

## Changelog ‚Äì 10. juli 2025 Part 2 ##
Changelog - Lykkehjul Funktion til Quiz Conversation Starter
1. Funktionalitet implementeret
Ny side /quiz/spin til lykkehjulsfunktionalitet efter quiz-gennemf√∏rsel.

Lykkehjul med 8 felter (alternativt "Stine" og "Mads") som spinner og tilf√¶ldigt v√¶lger, hvem der skal starte samtalen.

Konfetti-animation ved afslutning af spin.

Knappen "Spin hjulet" forsvinder, n√•r der er valgt en person.

Knappen "Se resultater" vises efter valg, og f√∏rer videre til quiz-resultatsiden.

Pil peger konstant nedad √∏verst over hjulet (ikke roterende).

Hjulet spinner flere hele omgange (4 ekstra spins) og lander p√• det valgte felt.

2. Integration med Supabase
Ny tabel oprettet i Supabase: quiz_conversation_starter_log

Kolonner:

id (UUID / auto increment)

user_id (UUID, reference til den bruger, der spinner)

quiz_key (string, reference til quizzen)

starter (string, navnet p√• den valgte person fra hjulet, fx "Stine" eller "Mads")

created_at (timestamp, automatisk genereret)

N√•r hjulet spinner f√¶rdigt, inds√¶ttes et nyt log-entry med quiz-key, den ansvarlige (starter) og bruger-id.

3. Routing / Navigation
N√•r quizzen er gennemf√∏rt, redirectes brugeren til /quiz/spin?quizKey=[quizKey]&session=[sessionId].

Efter spinning kan brugeren klikke "Se resultater", som sender dem videre til /quiz/resultater/[quizKey]?session=[sessionId].

QuizSpin-komponenten modtager quizKey og sessionId som props for korrekt databaseinds√¶ttelse og routing.

4. Kode√¶ndringer
Oprettet komponent QuizSpin i /app/quiz/spin/QuizSpin.tsx med lykkehjulslogik og visuel fremstilling.

Tilf√∏jet side /app/quiz/spin/page.tsx, som h√•ndterer parametre og renderer QuizSpin-komponenten.

Opdateret quiz-gennemf√∏relsesflow til at redirecte til /quiz/spin efter quiz-afslutning (implementeres i quiz-side, fx /app/quiz/[quizKey]/page.tsx).

5. Forbedringer / ekstra
Brugerkontekst (useUserContext) anvendes for at hente bruger-id til databaseinds√¶ttelsen.

Error handling p√• databaseinds√¶ttelse med konsol-logs.

Konfetti-visualisering ved afslutning af spin.

Spinneranimation med CSS transitions og beregnet rotationsvinkel for realistisk spin.

Forhindring af gentagne spins, mens hjulet spinner.

Database√¶ndringer (Supabase SQL)
Hvis du ikke allerede har k√∏rt denne, skal du k√∏re:

sql
Kopi√©r
ALTER TABLE quiz_conversation_starter_log
ADD COLUMN IF NOT EXISTS quiz_key TEXT;

ALTER TABLE quiz_conversation_starter_log
ADD COLUMN IF NOT EXISTS starter TEXT;

ALTER TABLE quiz_conversation_starter_log
ADD COLUMN IF NOT EXISTS user_id UUID REFERENCES profiles(id);

ALTER TABLE quiz_conversation_starter_log
ALTER COLUMN created_at SET DEFAULT now();
Hvis tabellen ikke eksisterer, kan denne oprette den:

sql
Kopi√©r
CREATE TABLE IF NOT EXISTS quiz_conversation_starter_log (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES profiles(id),
  quiz_key TEXT NOT NULL,
  starter TEXT NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT now()
);
Opsummering
Lykkehjul er nu en integreret del af quiz-flowet og sikrer tilf√¶ldig samtalestarter.

Data om samtalestarter gemmes for hver quiz og bruger i Supabase.

Routing er sat op, s√• man kan bev√¶ge sig naturligt i flowet: quiz ‚Üí lykkehjul ‚Üí resultater.

Visuelt og funktionelt er lykkehjulet optimeret med animation, konfetti og brugervenlighed.

## Changelog ‚Äì 10. juli 2025 Part 1 ##
Aktivitetstracking & logging
Ny logik for aktivitetslogning:

Tilf√∏jet /lib/logUserActivity.ts med central logik til at inds√¶tte brugeraktivitet i Supabase.

Logging udf√∏res kun for bruger-id: 5687c342-1a13-441c-86ca-f7e87e1edbd5 (Stine).

ClientLayout ‚Äì logging & routing:

Oprettet ny komponent: /app/ClientLayout.tsx.

Denne komponent h√•ndterer logging via useEffect og sikrer, at kun Stines aktivitet bliver logget uanset hvilken bruger der er logget ind.

Flyttet logningskaldet ud af layout.tsx og ind i ClientLayout for at undg√• hydration-fejl og holde kodebasen ren.

ClientLayout wrappes rundt om main-content i layout.tsx.

√Ündringer i UserContext:

UserContext i /context/UserContext.tsx er opdateret:

Bruger-id, display_name, partner_id m.m. hentes nu direkte fra Supabase-profilen.

Der bruges nu en mere robust useEffect og lytter til auth-state-changes for at sikre, at brugerinfo altid er opdateret i hele appen.

UserContext anvendes p√• tv√¶rs af sider til at levere brugerobjektet til logning, widgets m.m.

Supabase/database:

Oprettet/tilf√∏jet:

Kolonnerne timestamp og created_at i user_activity_log.

Kolonnen email i profiles for nemmere profilopslag.

RPC-funktion get_top_visited_pages til at gruppere og t√¶lle mest bes√∏gte sider.

Fikset problemer med duplikerede/ambiguous feltnavne ved at bruge entydige kolonneopslag og tilf√∏je n√∏dvendige felter.

/settings/activity siden:

Side opdateret s√• den viser:

Brugerens navn, id, og email.

Seneste logins med klokkesl√¶t og dato.

Senest bes√∏gte sider, ogs√• med klokkesl√¶t og dato.

Top 10 mest bes√∏gte sider (hentes via ny RPC-funktion i Supabase).

Fejlrettelser & forbedringer
Rettet flere edge-cases og fejlmeddelelser i forbindelse med Supabase-queries og tomme resultater.

Korrigeret brugen af hooks i relation til Client vs Server Components.

Tilf√∏jet fallback til at vise bruger-id hvis display_name mangler.

Alle fejl vises nu konsistent i konsollen for lettere debugging.

S√•dan ser det ud i praksis:

Ny fil: /app/ClientLayout.tsx

Opdateret: /context/UserContext.tsx

Opdateret: /lib/logUserActivity.ts

Supabase: Struktur√¶ndringer og ny RPC

Ny/udvidet side: /settings/activity



## Changelog ‚Äì [Dato: 2025-07-09] - part 2 ##
üöÄ Overblik
St√∏rre refaktorering og opgradering af dashboard-widgets, XP-system, UI, og brugerens fleksibilitet. Fokus p√• visuel sammenh√¶ng, UX og flere dynamiske muligheder for b√•de Mads og Stine.

1. XP-system: Levels, Progress, Farveskift og Context
XP-context (/context/XpContext.tsx) er udvidet til at inkludere:

Dynamisk level length (kan √¶ndres via settings/admin).

Beregning af XP pr. bruger (alts√• kun XP p√• den bruger der er logget ind).

XP-meter (/components/widgets/XpMeter.tsx):

Ny visning: Cirkul√¶r progressbar, der tager hensyn til XP p√• det aktuelle level.

Level-badge nu placeret √∏verst til h√∏jre, ikke ovenp√• cirklen.

Progressfarve √¶ndrer sig: orange ‚Üí gul ‚Üí gr√∏n, afh√¶ngigt af hvor t√¶t man er p√• n√¶ste level.

Dynamisk beregning af XP og level med korrekt visning (fixet fejl hvor level count var for h√∏jt).

Responsive og st√∏rre cirkel, s√• den fylder ud til kanten af boksen p√• b√•de mobil og desktop.

Visning f√∏lger nu design med ‚ÄúXP-meter‚Äù overskrift og badge.

2. Widgets: Adgang, Layout og Drag & Drop
Widget-adgang (/app/settings/widgets/page.tsx):

Bruger kan nu enable/disable widgets for hver profil.

Support for ny widget: ‚ÄúTip til n√¶ste level‚Äù.

Fasts√¶ttelse af r√¶kkef√∏lge, bredde og h√∏jde pr. widget.

TODO: Drag & Drop support er foresl√•et, men ikke implementeret i denne session. (Planl√¶g evt. integration med dnd-kit).

Widget-layout (/app/settings/widgets/layout.tsx):

Brugeren kan v√¶lge r√¶kkef√∏lge og st√∏rrelse p√• widgets.

Klar til fremtidig drag/drop.

WidgetRenderer er opdateret til at underst√∏tte alle widgets, inkl. specialh√•ndtering af ChallengeCardWidget.

3. ChallengeCardWidget (Udfordringskort)
Ny styling med badge, mindre font p√• sp√∏rgsm√•l, og boksen fylder nu ud til samme bredde som XP-meter.

‚ÄúDu har X dage til at besvare‚Äù vises under submit-knappen.

Partnerens svar vises kun n√•r begge har svaret.

Responsive og elegant UI.

Fixet race conditions og blinking/flash ved indl√¶sning (loading state h√•ndteres rent).

Al logik til XP-log er testet og fejlrettet.

4. LevelTipWidget ‚Äì Ny Widget: ‚ÄúTip til n√¶ste level‚Äù
Split fra XP-meter ‚Äì tip vises nu i egen widget.

Widget finder automatisk den opgave (fra fantasies, bucketlist, checkin, tasks) som vil bringe brugeren n√¶rmest til n√¶ste level.

UI: Farvet badge, st√∏rre tekst, fed tip-boks med brug af shadow, rounded, gul nuance og icon.

Viser ‚Äúopgave + XP + hvor meget man mangler til n√¶ste level‚Äù.

Viser fallback hvis ingen opgaver er mulige at l√∏se.

Tilf√∏jet til widget administration og dashboard, kan t√¶ndes/slukkes pr. bruger.

5. Visuelle & Komponentm√¶ssige √¶ndringer
Badges: Badge-komponent nu brugt konsistent i alle widgets og har f√•et forslag til farvevarianter (badge-success, badge-warning, badge-danger).

Buttons: btn-primary og btn-secondary opdateret i globals.css til at bruge Tailwind-farver og hover/focus states. Lagt op til yderligere udvidelser (fx btn-outline, btn-sm).

Responsivitet: Alle st√∏rre widgets tilpasser nu layout og st√∏rrelse p√• mobil/desktop.

Code Cleanups: Fjernet gammel kode, tilf√∏jet masser af loading/console-debug (fjern evt. debug f√∏r deploy).

6. Settings, Rewards og Level Length
Under ‚ÄúRewards‚Äù kan admin nu definere hvor meget √©t level er v√¶rd (level length), og dette √¶ndrer sig live i XP-context.

Data-strukturen for rewards er udvidet s√• gave kan tildeles en bestemt bruger og XP-m√•l pr. gave.

Sikret at XP altid kun vises for den p√•g√¶ldende bruger.

7. Fejlrettelser
Level count: Level starter nu korrekt ved 1, og man rykker kun op n√•r XP overstiger (level * levelLength).

XP-meter beregner progress korrekt baseret p√• nuv√¶rende level, ikke total XP.

Race conditions p√• visning af partnerens svar i ChallengeCardWidget h√•ndteres bedre.

Fejlrettet: Nogle widgets forsvandt fra brugerens dashboard selvom de var enabled ‚Äì supporteretWidgets array skal altid indeholde alle n√∏gler fra admin.

XP-log, xp_settings og rewards loader nu kun for den aktuelle bruger og rolle.

8. Refaktorering & Optimering
Alt XP-logik ud i context.

Beregning og suggestions til opgaver til n√¶ste level isoleret til LevelTipWidget.

Forberedt til yderligere modulopdeling og dnd-kit (drag & drop).

Brug af useCallback, useEffect cleanups og loading-states for hurtigere feel.

Test & TODO
Test at alle widgets vises/skjules korrekt ved √¶ndring i settings (adgang og layout).

Test at XP for b√•de Mads og Stine vises korrekt og f√∏lger individets handlinger.

Test at tip til n√¶ste level altid foresl√•r en reel opgave og ikke over/undervurderer XP.

Test visning/validering af badges og buttons p√• tv√¶rs af hele platformen.

TEST drag/drop prototype for widget-layout.

TEST edge cases hvor brugeren f√•r XP fra flere opgaver p√• √©n gang.

Opsummering
En stor omgang, hvor is√¶r dashboardets visuelle udtryk og den gamificerede oplevelse er opgraderet, XP/level-logik er blevet robust og widgets nu styres og tilpasses helt fra settings/admin.

## Changelog ‚Äì [Dato: 2025-07-09] ##
Nyt: Udfordringskort med gamification
Widget: Ny Udfordringskort-widget tilf√∏jet p√• dashboard. Viser automatisk et nyt sp√∏rgsm√•l hver 14. dag, som begge parter skal besvare for at optjene XP.

Databasemodel:

Tilf√∏jet tabel challenge_cards med kolonnerne id, title, question, category, active_from, active_to.

Tilf√∏jet tabel challenge_answers til at gemme brugersvar, XP m.m.

Besvarelser & XP:

Point-system indf√∏rt: Svar p√• kortet udl√∏ser XP. Mulighed for ekstra XP ved s√¶rligt √¶rlige eller hurtige svar.

Gamification & UX:

Badge-system og streaks: Brugere kan opn√• badges for fx ‚Äú5 svar i tr√¶k‚Äù eller ‚Äús√•rbarheds-mester‚Äù.

Progressbar: Visning af hvor mange kort, der er besvaret.

Automatisk ‚Äúl√•s op for partnerens svar‚Äù, n√•r begge har svaret p√• kortet.

P√•mindelser/nudges, hvis man ikke har svaret inden for f√• dage.

Mulighed for anonym refleksion (privat svar).

Arkiv/historik over tidligere kort og besvarelser.

Admin:

Challenge cards kan nu administreres fra backend ‚Äì med titel, sp√∏rgsm√•l, kategori og aktiv periode.

Cron-job eller scheduled function planl√¶gges til at aktivere nyt kort hver 14. dag.

UI
Widget vises p√• dashboard.

Modal/side til besvarelse med XP-animation, feedback og badge-fejring.

‚ÄúAfventer partner‚Äù-status indtil begge har svaret.

Historik-side (eller sektion p√• profil) med overblik over gamle svar og XP.

Note:

Husk at opdatere seed-data i challenge_cards med de nye sp√∏rgsm√•l inkl. titel.

Husk at synkronisere widgets under /settings/widgets og layout under /settings/widgets/layout med den nye widget.

## Changelog ‚Äì [Dato: 2025-07-08]##

Tilf√∏jet
Ny responsiv kalenderfunktion:

Kalenderen viser nu ‚ÄúGoogle Calendar‚Äù-lignende grid p√• desktop og Apple-lignende dagsliste p√• mobil.

Begivenheder kan tilf√∏jes med enkeltklik/tap p√• dato ‚Äì ikke l√¶ngere dobbeltklik.

Kalenderen er opdelt i separate komponenter:

SharedCalendar.tsx: Wrapper, der automatisk v√¶lger mobil- eller desktop-visning.

BigCalendarView.tsx: Desktop grid med react-big-calendar.

MobileCalendarView.tsx: Mobilvisning med react-calendar og dagsliste.

Dummy-events indtil integration med Supabase.

√Ündret
Koden til kalenderen er nu delt op i separate komponenter i /components/calendar/

Bedre overblik, genbrug og vedligeholdelse.

Alle imports/exports er nu konsistente (named exports).

Rettet
Fejl med import/eksport er rettet ‚Äì alle filer bruger nu enten named eller default eksport, s√• der ikke opst√•r importfejl i Next.js.

Date-fns imports bruger nu korrekt curly-brace-syntax.

Fjernet
Dobbeltklik som oprettelsesmetode p√• events er fjernet ‚Äì nu kun enkeltklik/tap.

Kort opsummering
Hele kalenderfunktionen er nu responsiv, mere mobilvenlig, opdelt i rene komponenter og klar til videreudvikling med database-integration og custom UI.


## Sidste opdateret: 2025-07-07 ##

Nye funktioner og st√∏rre √¶ndringer
Sexstillinger univers:
Ny inspirationsside for sexstillinger p√• /sex/positions.

CRUD:
Opret, redig√©r, og slet sexstillinger via modal (inkl. billedupload).

Kategorier og familier:

Dynamisk mulighed for at v√¶lge eller oprette kategori og familie for hver stilling.

Begge v√¶lges i modal, vises som badges p√• cards.

Tags:

Opret og v√¶lg flere tags pr. stilling.

Tags kan v√¶lges fra eksisterende eller oprettes direkte i modal.

Tags vises i modal (ikke p√• card).

Effort/Sv√¶rhedsgrad:

Dropdown i modal: Let / Middel / Sv√¶r.

Hver effort-type tildeles XP dynamisk.

XP-ops√¶tning kan redigeres under /settings/points via Supabase.

XP-badge:

Nyt badge p√• hvert card og i modal, der viser XP-optjening for effort.

XP hentes fra xp_settings hvor role = 'common' og action = 'sex_position'.

Status:

Ny, Pr√∏vet, Afvist v√¶lges i modal.

Status vises som badge p√• card og i modal.

Tried count:

Hvis ‚ÄúPr√∏vet‚Äù v√¶lges, kan antal gange angives.

Vises som badge p√• card og i modal.

Pagination:

Maks. 12 stillinger pr. side.

Sidev√¶lger vises under cards.

Antal-stillinger:

Tekst i toppen: ‚ÄúDer er X stillinger til inspiration‚Äù.

Filterbar (desktop):

Kategori, familie og tags kan v√¶lges som multi-chips (flere p√• √©n gang).

Filter p√•virker cards live.

Mobilfilter:

‚ÄúFiltrer‚Äù-knap √•bner drawer med samme muligheder (kategori/familie/tags).

Resultattal vises f√∏r man trykker "Vis resultater".

Design:

Cards har flere badges, bedre padding, ens font, ikon p√• badges, og mere mobilvenligt layout.

Sidebar/menu:

Nyt hovedpunkt ‚ÄúIntimitet‚Äù med ‚ÄúFantasier‚Äù og ‚ÄúSex inspiration‚Äù (positions).

Parforhold-menuen viser nu ikke Fantasier og Sex inspiration.

Sidebar opdateret s√• hovedpunkter med underpunkter ikke l√¶ngere kan klikkes direkte.

Databasetabeller og felter
sex_positions

Felter: id, name, image_url, description, status, tried_count, category_id, effort, family_id

sex_position_categories

Felter: id, name

sex_position_families

Felter: id, name

sex_position_tags

Felter: id, name

sex_position_tag_links

Felter: sex_position_id, tag_id

xp_settings

Felter: id, role, action, effort, xp

Relevant ops√¶tning:

role = 'common'

action = 'sex_position'

effort = 'let' | 'middel' | 'sv√¶r'

XP kan s√¶ttes i /settings/points

Komponenter
/components/ui/badge.tsx
Genanvendt til alle badges (kategori, familie, status, effort, tags).
/components/ui/XpBadge.tsx

Nyt XP-badge p√• kort og i modal ‚Äì modtager xp og viser badge. Dette punkt virker ikke, og det er det vi skal arbejde p√• i n√¶ste gpt session.

## 2025-07-06 ##
Implementeret ny struktur for changelog med m√•nedlige filer i /changelog/-mappen for at sikre bedre overblik og undg√• for stor README-fil.

Aftalt workflow for vedh√¶ftning ved nye sessioner: altid seneste README.md + aktuel m√•neds changelog-fil.

Fastsat klare retningslinjer for, hvordan opdateringer dokumenteres:

README indeholder overordnet projektbeskrivelse, arkitektur og mappestruktur.

/changelog/changelog-√Ö√Ö√Ö√Ö-MM.md indeholder detaljerede ugentlige/dagslogs.

Retableret fungerende layout og styling uden global padding p√• .card i globals.css. Padding h√•ndteres nu lokalt i komponenterne.

Sikret, at drag-and-drop i FantasyBoard og modaler fungerer uden stylingkonflikter.

Checkin-systemet er implementeret med ugentlige behov, modpartsevaluering og XP-tildeling baseret p√• evalueringsstatus.

Opdateret XP-systemet til at hente point fra xp_settings med korrekt rolle- og effort-afh√¶ngighed.

Dokumenteret database-struktur og flow for fantasier, XP, gaver og adgangskontrol.

## Seneste opdateringer (2025-07-06) ##

1. Sexstillinger / Inspirationsunivers
Vi har oprettet en side /sex/positions som fungerer som et inspirationsunivers for sexstillinger.

Siden viser alle stillinger som kort, inkl. billede, beskrivelse, status ("ny", "pr√∏vet", "afvist") og hvor mange gange den er pr√∏vet (tried_count).

Modal til visning og redigering af hver stilling.

Mulighed for at oprette nye stillinger, inkl. upload af billede til Supabase Storage (bucket: sex-positions-images).

Mulighed for at redigere eksisterende stillinger samt slette dem.

Al upload og l√¶sning styres af RLS policies: (auth.role() = 'authenticated') AND (bucket_id = 'sex-positions-images') for alle fire rettigheder.

2. Check-in side /indtjekning/sex
Stilling-data p√• check-in siden tr√¶kkes nu direkte fra sex_positions-tabellen.

Der vises autocomplete-s√∏gning for stillinger samt chips for de 10 mest brugte.

Mulighed for at tilf√∏je ny stilling direkte fra check-in.

Hver stilling kan nu have billede, og antal gange den er brugt vises (hvis feltet er >0).

Fejl med manglende felter i tabellen l√∏st ved at sikre at b√•de tried_count og image_url findes.

3. Database / Supabase
sex_positions-tabellen er udvidet med kolonnerne:

image_url (text, nullable)

description (text, nullable)

status (text, nullable ‚Äì enum-lignende: 'ny', 'pr√∏vet', 'afvist')

tried_count (integer, default 0)

Storage bucket sex-positions-images oprettet med policies for authenticated access.

Policies for storage select, insert, update og delete sat ens.

4. Rettelser og fejlretning
Sikret at kode til b√•de /indtjekning/sex og /sex/positions aldrig strippes, men leveres komplet.

Fejl omkring properties som ikke findes (f.eks. tried_count) er l√∏st ved at sikre korrekt supabase select og types.

Alle visuelle og funktionelle √∏nsker til UI p√• begge sider indf√∏rt, inkl. kortvisning og modal.

N√¶ste skridt
Videreudvikling p√• /sex/positions

Mulighed for at filtrere/udv√¶lge stillinger baseret p√• status, tags eller hyppighed.

Mulighed for at afvise stillinger eller markere dem som pr√∏vet X gange direkte fra inspirationsuniverset.

Integrere gamification/XP med brug af stillinger.

Forbedre billedh√•ndtering, evt. st√∏tte for flere billeder pr. stilling.

Evt. kobling direkte fra inspirationsunivers til check-in (v√¶lg fra inspirationsunivers ved registrering).

## Opdatering 2025-07-04 ##

Bucketlist ‚Äì Redigering og sletning af delm√•l (timeline)
Nyt:
Det er nu muligt at redigere og slette delm√•l (subgoals) direkte i timeline-visningen p√• Bucketlist for Par.

Hver delm√•l har nu to knapper:

Rediger: Mulighed for at rette titel, deadline og ansvarlig direkte inline p√• listen. √Ündringer gemmes til Supabase.

Slet: Giver bekr√¶ftelse f√∏r sletning. Sletning opdaterer ogs√• Supabase og UI.

Teknisk
BucketContext er udvidet med updateSubgoal og deleteSubgoal metoder.

BucketTimeline.tsx bruger disse metoder til at h√•ndtere redigering/sletning, med tilstandsstyring for aktiv redigering/sletning per subgoal.

Mulighed for at annullere √¶ndringer eller fortryde sletning.

UI/UX
Knappen ‚ÄúRediger‚Äù √•bner inputfelter direkte p√• delm√•let.

Slet-knappen viser bekr√¶ftelsesfelt inden endelig handling.

Intet af den eksisterende kode til tilf√∏jelse/check af delm√•l er √¶ndret.

Alt er mobilvenligt og f√∏lger det eksisterende card-design.

√òvrige forbedringer
Badge-designet p√• BucketCard bruger nu global Badge-komponent fra /components/ui/badge.tsx til b√•de kategori, ansvarlig og deadline.

Progressbar og spacing p√• kort er tilpasset for et mere rent og moderne look.

Database

Ingen √¶ndringer i tabelstruktur ‚Äì alle √¶ndringer sker p√• data i feltet goals i bucketlist_couple.

## Opdatering 2. juli 2025 ##

Bucketlist-couple:
Projektet har f√•et opdateret arkitekturen omkring bucket-funktionalitet, s√• Next.js-kompatibilitet sikres, og alle React/context-fejl fjernes.

Overblik over √¶ndringer:

Opdeling af context og side:

Context-provider (BucketProvider + useBucket) ligger nu i /context/BucketContext.tsx med "use client" i toppen.

/app/bucketlist-couple/page.tsx indeholder kun rendering/visning og bruger altid export default function ....

Ingen context eller createContext i page.tsx ‚Äì alle Next.js ‚Äúdefault export is not a React Component‚Äù-fejl l√∏st.

Tilf√∏jelser og rettelser:

Al bucket CRUD h√•ndteres via addBucket, updateBucket, mm., med imageUrl som URL-streng (ikke filobjekt).

Brug af Supabase opdateret til at arbejde mod tabellen bucketlist_couple.

Underkomponenter (BucketlistCoupleContent) anbefales til visning og formularer.

Koden er nu robust over for Next.js 13/14/15 app-router regler.

Fejl omkring ‚ÄúcreateContext‚Äù og hooks l√∏st via tydelig ‚Äúuse client‚Äù-adskillelse.

Fejlh√•ndtering og debug:

Alle typiske build-fejl og import/eksport-problemer beskrevet og h√•ndteret.

Der er indf√∏rt stricte regler for, hvordan context importeres/bruges i projektet.





