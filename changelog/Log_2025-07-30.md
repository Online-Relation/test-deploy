## Changelog – 12. juli 2025 ##
Noter på Bucketlist:
Implementeret funktionalitet til at oprette, redigere og slette noter (historik) tilknyttet hvert bucket-mål via separat tabel bucket_history.
Noter vises nu direkte i modalboksen for det enkelte mål.

Visning af antal noter:
Der er arbejdet på at vise “Der er X noter” nederst på hvert bucket-kort på forsiden.
Funktionen er delvist implementeret, men ikke færdiggjort/aktiveret endnu.

Fejlfinding og integration:
Fejl i noteflow relateret til user-id, bucket-id og foreign key i Supabase identificeret og løst.
Test af insert direkte i SQL-editor for at sikre validitet af UUIDs og relationer.

Tilføjet/ændret:

Ny tabel: error_log

Kolonner:

id (uuid, primary key)

title (text)

description (text)

page (text, hovedside-navn)

subpage (text, underpunkt-navn, nullable)

category (text, værdier: 'Kritisk', 'Mindre fejl')

created_at (timestamp, default now())

Ny tabel: error_pages

Kolonner:

id (uuid, primary key)

name (text)

parent_id (uuid, nullable, reference til id i samme tabel for underpunkter)

created_at (timestamp, default now())

Tilføjet/ændret i idebanken:

Kolonnerne importance og created_at i idea_bank

Kolonnen parent_id i idea_pages (for at understøtte underpunkter)

Triggers (valgfrit):

Trigger oprettet, så nye sider/underpunkter tilføjet i idea_pages automatisk oprettes i error_pages (og omvendt, hvis valgt).

Indexes:

(valgfrit/kan anbefales) Indexes på page, subpage og category i både idea_bank og error_log for hurtigere søgninger og filtrering.

Tilføjelse af billedupload til Manifestation Board
Ny funktionalitet: Mulighed for at uploade et bannerbillede ved oprettelse af manifestation.

Redigeringsmodal: Tilføjet billeduploadfelt i redigeringsmodal, så man kan ændre/bytte billedet på eksisterende manifestationer.

Billedvisning: Bannerbilledet vises nu både i kortoversigten og i modalvisningen.

Uploadhåndtering: Upload af billeder gemmes i Supabase Storage under bucket manifestation-images.

Forbedret brugeroplevelse: Upload-knapper deaktiveres under billedupload, og der vises upload-status.

Fejlhåndtering: Visning af fejlbeskeder ved upload- eller opdateringsfejl.

Kodeforbedringer: Refaktoreret Modal-komponent til bedre state-håndtering af billedupload, titel og beskrivelse.

Status og Opdatering – Alkohol-sektion
Seneste ændringer:

Tilføjede felter og funktioner:
1. Stemning (Mood)
Viser fordelingen af daglige stemninger (frost, kølig, neutral, lun, hed) med doughnut-diagram.

Lister optælling for hver stemningstype.

2. Top følelser/tanker (Tags)
Bar chart viser de 12 mest brugte tags for følelser/tanker, sorteret efter hyppighed.

3. Udvikling over tid (Linje-diagram)
Viser månedlig udvikling i positive og negative tanker/følelser, baseret på valgte måneder (3, 6, 12, 24).

4. Blomster
Viser hvor mange dage siden, du sidst har givet blomster til din partner.

Viser besked hvis du aldrig har givet blomster, eller hvis det er gjort i dag.

5. Gaver
Viser hvor mange dage siden, du sidst har givet en gave.

Viser hvor mange gaver du samlet har givet, og total værdi i kroner.

Beregner gennemsnitlig udgift pr. dag siden fast startdato (11/7-2025).

6. Alkohol
Doughnut-diagram for fordeling mellem “Alkohol drukket” og “Ingen alkohol”.

Farver og labels matcher nu intentionen (grøn for alkohol, gul for ingen).

Optælling og forklaring i tekst under diagrammet.

7. Ærlighedssnak
Tæller antal registrerede ærlighedssamtaler (honesty_talk).

Viser liste over alle registrerede snakke med dato og evt. emne.

8. “Jeg elsker dig” – hvem sagde det først?
Doughnut-diagram og liste, som viser hvem der har sagt “jeg elsker dig” først/kun (mig, partneren, begge, ingen).

Viser også hvor mange dage siden, du/partneren/sidst har sagt det.

Viser hvis ingen nogensinde har sagt det.

Generelle forbedringer
Alle diagrammer og lister opdateres dynamisk baseret på periodevalg (antal måneder).

Alle felter og visualiseringer trækker på daglige checkins i Supabase.

Nye aggregationer og beregninger tilføjet for at få mere præcis statistik og brugerfeedback.

## Changelog – 11. juli 2025 Part 1 ##
Databaseændringer
Tilføjet tabel manifestation_points med kolonner:

id (unik identifikator)

title (titel på manifestpunkt)

content (HTML eller tekstindhold for manifestpunktet)

remind_me (boolean, om punktet skal vises i widget)

created_at (timestamp)

Funktionelle ændringer i Manifestation og Widget
Omdannet manifest-widget /components/widgets/ManifestReminderWidget.tsx til at:

Hente punkter fra manifestation_points i stedet for kun manifestations

Splitte content i flere afsnit baseret på nummerering og linjeskift

Vise ét tilfældigt manifestpunkt pr. dag, baseret på dag i året modulo antal punkter

Justeret eksisterende manifestation-funktionalitet, så data fra manifestation_points indgår korrekt i widget.

Widget understøtter nu visning af et enkelt manifestpunkt dagligt med titel og indhold.

Fremtidige planer (noter)
Udvikling af AI-genereret profiltekst baseret på udvalgte kolonner i bruger- og partnerprofiler.

Overvejelse af settings-side /settings/profileheadersuggestion til at vælge hvilke kolonner der skal inkluderes i AI-prompt.

Mulighed for dynamisk tilpasning af tekst baseret på brugerens og partnerens data.

Forventet proof-of-concept klar inden for 30-60 minutter, fuld implementering på 2-3 timer.

## Changelog – 10. juli 2025 Part 4 ##
Log over notifikationsprojektet – Status og problemstillinger
Hvad vi har lavet
Notifikationstyper (konfiguration)
Vi har defineret notificationsConfig.ts med klare typer, skabeloner, links og ikoner for notifikationer.

Funktion til oprettelse af notifikationer (createNotification)
En funktion i /lib/notifications.ts, som opretter notifikationer i databasen med korrekt tekst og link baseret på config.

Parsing af notifikationer (parseNotification)
Funktion der omdanner rå notifikationer til frontend-venligt format med tekst, link, ikon og type.

DashboardUserWidget-komponenten
En React-komponent der viser notifikationsikon, antal ulæste og en dropdown med parsed notifikationer.

NotificationSettingsPage-komponenten
En settings-side, hvor brugeren kan slå notifikationstyper til og fra. Denne gemmer indstillinger i notification_settings tabellen.

Filtrering af notifikationer i widget
Widgetten henter brugerens notification_settings og filtrerer notifikationer, så kun aktiverede typer vises.

RLS-politikker i Supabase
Vi har gennemgået nødvendigheden af RLS (Row Level Security) på både notifications og notification_settings tabellerne.

De væsentlige problemer og hvorfor det ikke virker
Notifikationer oprettes ikke som forventet

Problemer med createNotification kald i frontend (fx i bucket-oprettelse).

Mulige RLS regler i Supabase, som blokerer indsættelse uden fejlbesked.

Manglende eller ukorrekt oprettede rækker i notifications.

notification_settings opdateres ikke eller bruges ikke

Selvom tabellen eksisterer, bliver den ikke opdateret korrekt ved brugerens valg.

Upsert-kald i frontend kan fejle pga. ukorrekt onConflict eller manglende constraint.

Manglende synkronisering mellem notification_settings og filtrering af notifikationer.

Filtrering i widget fejler pga. manglende type i parsed notifikationer

parseNotification manglede at returnere type felt, så filterfunktionen fejlede.

Dette er nu rettet, men kan have påvirket tidligere test.

Filtypen og JSX-forvirring

Forkert brug af .ts vs .tsx filer skabte syntaksfejl og frustration.

createNotification skal være i .ts, React-komponenter i .tsx.

Manglende debug logs i kritiske funktioner

Vi har tilføjet flere console.log, men kan have overset at følge flowet helt til databaseindsættelse og RLS fejl.

Manglende klar separation mellem “notifikationer” og “notifikationsindstillinger”

Uklare forventninger til hvordan notification_settings skal bruges.

Ingen tydelig dokumentation eller eksisterende backend-logik, der forbinder indstillinger med filtrering.

Anbefaling til næste session
Gennemgå RLS-politikker i Supabase for begge tabeller grundigt
Sæt simple policies op til test med tilladelse til alle handlinger for din bruger, for at isolere om RLS blokerer.

Tilføj og test debug-logs helt nede i backend/API og Supabase-klientens insert/upsert-kald
Bekræft at kald når databasen, og log fejl.

Test manuel SQL-indsættelse i Supabase SQL-editor for både notifications og notification_settings
Bekræft at indsættelser ikke fejler.

Isoler frontend-kald
Prøv simple fetch/upsert uden UI-komponenter for at sikre at datahåndtering virker.

Dokumentér datamodellen
Saml alle tabelstrukturer, constraints, RLS-politikker og forventede felter i et dokument.

Byg trinvis: først sikre oprettelse af notifikationer, dernæst visning, til sidst filtrering.


## Changelog – 10. juli 2025 Part 3 ##
Changelog & Status for /app/indtjekning/sex/page.tsx
Hvad vi har lavet indtil nu
Hele sexlog-systemet:

Formular til at oprette og redigere sexlogs med felter: dato, tid, initiativ, type, "vi prøvede noget nyt", stillinger, placering, sted, tags.

Valgfelter og autocomplete på stillinger (positions), placeringer (locations), steder (places) og tags – alt synkroniseres til Supabase.

Mulighed for at tilføje nye stillinger, placeringer, steder og tags direkte fra UI.

Under “vi prøvede noget nyt” kan man vælge og gemme en stilling som blev prøvet for første gang.

Rediger-funktion: Man kan vælge en tidligere log og få alle værdier fyldt ud, klar til redigering.

Gem/redigér logik:

Hvis man opretter ny log, laves der INSERT i sexlife_logs, og tilhørende batch-inserts i relationstabellerne (positions, locations, places, tags).

Hvis man redigerer eksisterende log (via editingId), opdateres hovedloggen (UPDATE), og ALLE gamle relationer i de fire koblingstabeller slettes og genskabes med nye værdier.

Seneste logs vises i bunden:

Viser de fem nyeste registreringer, kan åbnes til redigering.

State resetter korrekt efter gem/annuller.

Hvad er problemet lige nu?
Kort version:

Når man redigerer en eksisterende sex-log og tilføjer/fjerner en stilling (position), så bliver den ikke korrekt opdateret i visningen (eller i databasen). Enten bliver koblingen ikke gemt, eller også vises den ikke efterfølgende i UI.

Det vi har prøvet:

Vi har sikret, at der:

Laves UPDATE på hovedtabellen.

SLETTES ALT i de fire koblingstabeller for den aktuelle log_id.

Herefter INSERTES de nye koblinger.

Vi har testet med console.log og set, at selectedPositions har de rigtige IDs ved gem.

Vi har sikret at fetchLogs kaldes, så UI henter seneste data.

Der er ingen SQL/JS errors i consollen.

State bliver nulstillet og loggen lukkes.

Men:

Efter redigering mangler de nye/ændrede stillinger i listen.

UI kan godt vise de gamle værdier, som om den ikke får den nye kobling med fra Supabase.

Det gælder især for “stillinger” – de andre felter lader til at virke.

Forslag til næste GPT/udvikler
Fokusér på koblingen mellem sexlife_logs og sexlife_log_positions:

Tjek om selectedPositions faktisk indeholder de rigtige IDs ved redigering og gem.

Tjek at de nye INSERTs i sexlife_log_positions faktisk bliver lavet i Supabase.

Tjek at fetchLogs virkelig får de nye koblinger med hjem fra Supabase – især at select-statementet matcher!

Tjek at der ikke er caching, race conditions, eller stale state der forhindrer ny visning.

Supabase join-syntax skal inkludere nested objekter: Måske mangler en dybere join/rel.

Eksempel på select-statement vi bruger nu (til logs og koblinger):

js
Kopiér
Rediger
supabase
  .from('sexlife_logs')
  .select('*, sexlife_log_positions(position_id), sexlife_log_locations(location_id), sexlife_log_places(place_id), sexlife_log_tags(tag_id)')
  .order('log_datetime', { ascending: false })
  .limit(5)
TL;DR:
Når man redigerer en sexlog og vælger nye stillinger, gemmes ændringen ikke synligt – eller også hentes den ikke korrekt hjem igen. Koblingen “stillinger” for en given log driller stadig.

## Changelog – 10. juli 2025 Part 2 ##
Changelog - Lykkehjul Funktion til Quiz Conversation Starter
1. Funktionalitet implementeret
Ny side /quiz/spin til lykkehjulsfunktionalitet efter quiz-gennemførsel.

Lykkehjul med 8 felter (alternativt "Stine" og "Mads") som spinner og tilfældigt vælger, hvem der skal starte samtalen.

Konfetti-animation ved afslutning af spin.

Knappen "Spin hjulet" forsvinder, når der er valgt en person.

Knappen "Se resultater" vises efter valg, og fører videre til quiz-resultatsiden.

Pil peger konstant nedad øverst over hjulet (ikke roterende).

Hjulet spinner flere hele omgange (4 ekstra spins) og lander på det valgte felt.

2. Integration med Supabase
Ny tabel oprettet i Supabase: quiz_conversation_starter_log

Kolonner:

id (UUID / auto increment)

user_id (UUID, reference til den bruger, der spinner)

quiz_key (string, reference til quizzen)

starter (string, navnet på den valgte person fra hjulet, fx "Stine" eller "Mads")

created_at (timestamp, automatisk genereret)

Når hjulet spinner færdigt, indsættes et nyt log-entry med quiz-key, den ansvarlige (starter) og bruger-id.

3. Routing / Navigation
Når quizzen er gennemført, redirectes brugeren til /quiz/spin?quizKey=[quizKey]&session=[sessionId].

Efter spinning kan brugeren klikke "Se resultater", som sender dem videre til /quiz/resultater/[quizKey]?session=[sessionId].

QuizSpin-komponenten modtager quizKey og sessionId som props for korrekt databaseindsættelse og routing.

4. Kodeændringer
Oprettet komponent QuizSpin i /app/quiz/spin/QuizSpin.tsx med lykkehjulslogik og visuel fremstilling.

Tilføjet side /app/quiz/spin/page.tsx, som håndterer parametre og renderer QuizSpin-komponenten.

Opdateret quiz-gennemførelsesflow til at redirecte til /quiz/spin efter quiz-afslutning (implementeres i quiz-side, fx /app/quiz/[quizKey]/page.tsx).

5. Forbedringer / ekstra
Brugerkontekst (useUserContext) anvendes for at hente bruger-id til databaseindsættelsen.

Error handling på databaseindsættelse med konsol-logs.

Konfetti-visualisering ved afslutning af spin.

Spinneranimation med CSS transitions og beregnet rotationsvinkel for realistisk spin.

Forhindring af gentagne spins, mens hjulet spinner.

Databaseændringer (Supabase SQL)
Hvis du ikke allerede har kørt denne, skal du køre:

sql
Kopiér
ALTER TABLE quiz_conversation_starter_log
ADD COLUMN IF NOT EXISTS quiz_key TEXT;

ALTER TABLE quiz_conversation_starter_log
ADD COLUMN IF NOT EXISTS starter TEXT;

ALTER TABLE quiz_conversation_starter_log
ADD COLUMN IF NOT EXISTS user_id UUID REFERENCES profiles(id);

ALTER TABLE quiz_conversation_starter_log
ALTER COLUMN created_at SET DEFAULT now();
Hvis tabellen ikke eksisterer, kan denne oprette den:

sql
Kopiér
CREATE TABLE IF NOT EXISTS quiz_conversation_starter_log (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES profiles(id),
  quiz_key TEXT NOT NULL,
  starter TEXT NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT now()
);
Opsummering
Lykkehjul er nu en integreret del af quiz-flowet og sikrer tilfældig samtalestarter.

Data om samtalestarter gemmes for hver quiz og bruger i Supabase.

Routing er sat op, så man kan bevæge sig naturligt i flowet: quiz → lykkehjul → resultater.

Visuelt og funktionelt er lykkehjulet optimeret med animation, konfetti og brugervenlighed.

## Changelog – 10. juli 2025 Part 1 ##
Aktivitetstracking & logging
Ny logik for aktivitetslogning:

Tilføjet /lib/logUserActivity.ts med central logik til at indsætte brugeraktivitet i Supabase.

Logging udføres kun for bruger-id: 5687c342-1a13-441c-86ca-f7e87e1edbd5 (Stine).

ClientLayout – logging & routing:

Oprettet ny komponent: /app/ClientLayout.tsx.

Denne komponent håndterer logging via useEffect og sikrer, at kun Stines aktivitet bliver logget uanset hvilken bruger der er logget ind.

Flyttet logningskaldet ud af layout.tsx og ind i ClientLayout for at undgå hydration-fejl og holde kodebasen ren.

ClientLayout wrappes rundt om main-content i layout.tsx.

Ændringer i UserContext:

UserContext i /context/UserContext.tsx er opdateret:

Bruger-id, display_name, partner_id m.m. hentes nu direkte fra Supabase-profilen.

Der bruges nu en mere robust useEffect og lytter til auth-state-changes for at sikre, at brugerinfo altid er opdateret i hele appen.

UserContext anvendes på tværs af sider til at levere brugerobjektet til logning, widgets m.m.

Supabase/database:

Oprettet/tilføjet:

Kolonnerne timestamp og created_at i user_activity_log.

Kolonnen email i profiles for nemmere profilopslag.

RPC-funktion get_top_visited_pages til at gruppere og tælle mest besøgte sider.

Fikset problemer med duplikerede/ambiguous feltnavne ved at bruge entydige kolonneopslag og tilføje nødvendige felter.

/settings/activity siden:

Side opdateret så den viser:

Brugerens navn, id, og email.

Seneste logins med klokkeslæt og dato.

Senest besøgte sider, også med klokkeslæt og dato.

Top 10 mest besøgte sider (hentes via ny RPC-funktion i Supabase).

Fejlrettelser & forbedringer
Rettet flere edge-cases og fejlmeddelelser i forbindelse med Supabase-queries og tomme resultater.

Korrigeret brugen af hooks i relation til Client vs Server Components.

Tilføjet fallback til at vise bruger-id hvis display_name mangler.

Alle fejl vises nu konsistent i konsollen for lettere debugging.

Sådan ser det ud i praksis:

Ny fil: /app/ClientLayout.tsx

Opdateret: /context/UserContext.tsx

Opdateret: /lib/logUserActivity.ts

Supabase: Strukturændringer og ny RPC

Ny/udvidet side: /settings/activity



## Changelog – [Dato: 2025-07-09] - part 2 ##
🚀 Overblik
Større refaktorering og opgradering af dashboard-widgets, XP-system, UI, og brugerens fleksibilitet. Fokus på visuel sammenhæng, UX og flere dynamiske muligheder for både Mads og Stine.

1. XP-system: Levels, Progress, Farveskift og Context
XP-context (/context/XpContext.tsx) er udvidet til at inkludere:

Dynamisk level length (kan ændres via settings/admin).

Beregning af XP pr. bruger (altså kun XP på den bruger der er logget ind).

XP-meter (/components/widgets/XpMeter.tsx):

Ny visning: Cirkulær progressbar, der tager hensyn til XP på det aktuelle level.

Level-badge nu placeret øverst til højre, ikke ovenpå cirklen.

Progressfarve ændrer sig: orange → gul → grøn, afhængigt af hvor tæt man er på næste level.

Dynamisk beregning af XP og level med korrekt visning (fixet fejl hvor level count var for højt).

Responsive og større cirkel, så den fylder ud til kanten af boksen på både mobil og desktop.

Visning følger nu design med “XP-meter” overskrift og badge.

2. Widgets: Adgang, Layout og Drag & Drop
Widget-adgang (/app/settings/widgets/page.tsx):

Bruger kan nu enable/disable widgets for hver profil.

Support for ny widget: “Tip til næste level”.

Fastsættelse af rækkefølge, bredde og højde pr. widget.

TODO: Drag & Drop support er foreslået, men ikke implementeret i denne session. (Planlæg evt. integration med dnd-kit).

Widget-layout (/app/settings/widgets/layout.tsx):

Brugeren kan vælge rækkefølge og størrelse på widgets.

Klar til fremtidig drag/drop.

WidgetRenderer er opdateret til at understøtte alle widgets, inkl. specialhåndtering af ChallengeCardWidget.

3. ChallengeCardWidget (Udfordringskort)
Ny styling med badge, mindre font på spørgsmål, og boksen fylder nu ud til samme bredde som XP-meter.

“Du har X dage til at besvare” vises under submit-knappen.

Partnerens svar vises kun når begge har svaret.

Responsive og elegant UI.

Fixet race conditions og blinking/flash ved indlæsning (loading state håndteres rent).

Al logik til XP-log er testet og fejlrettet.

4. LevelTipWidget – Ny Widget: “Tip til næste level”
Split fra XP-meter – tip vises nu i egen widget.

Widget finder automatisk den opgave (fra fantasies, bucketlist, checkin, tasks) som vil bringe brugeren nærmest til næste level.

UI: Farvet badge, større tekst, fed tip-boks med brug af shadow, rounded, gul nuance og icon.

Viser “opgave + XP + hvor meget man mangler til næste level”.

Viser fallback hvis ingen opgaver er mulige at løse.

Tilføjet til widget administration og dashboard, kan tændes/slukkes pr. bruger.

5. Visuelle & Komponentmæssige ændringer
Badges: Badge-komponent nu brugt konsistent i alle widgets og har fået forslag til farvevarianter (badge-success, badge-warning, badge-danger).

Buttons: btn-primary og btn-secondary opdateret i globals.css til at bruge Tailwind-farver og hover/focus states. Lagt op til yderligere udvidelser (fx btn-outline, btn-sm).

Responsivitet: Alle større widgets tilpasser nu layout og størrelse på mobil/desktop.

Code Cleanups: Fjernet gammel kode, tilføjet masser af loading/console-debug (fjern evt. debug før deploy).

6. Settings, Rewards og Level Length
Under “Rewards” kan admin nu definere hvor meget ét level er værd (level length), og dette ændrer sig live i XP-context.

Data-strukturen for rewards er udvidet så gave kan tildeles en bestemt bruger og XP-mål pr. gave.

Sikret at XP altid kun vises for den pågældende bruger.

7. Fejlrettelser
Level count: Level starter nu korrekt ved 1, og man rykker kun op når XP overstiger (level * levelLength).

XP-meter beregner progress korrekt baseret på nuværende level, ikke total XP.

Race conditions på visning af partnerens svar i ChallengeCardWidget håndteres bedre.

Fejlrettet: Nogle widgets forsvandt fra brugerens dashboard selvom de var enabled – supporteretWidgets array skal altid indeholde alle nøgler fra admin.

XP-log, xp_settings og rewards loader nu kun for den aktuelle bruger og rolle.

8. Refaktorering & Optimering
Alt XP-logik ud i context.

Beregning og suggestions til opgaver til næste level isoleret til LevelTipWidget.

Forberedt til yderligere modulopdeling og dnd-kit (drag & drop).

Brug af useCallback, useEffect cleanups og loading-states for hurtigere feel.

Test & TODO
Test at alle widgets vises/skjules korrekt ved ændring i settings (adgang og layout).

Test at XP for både Mads og Stine vises korrekt og følger individets handlinger.

Test at tip til næste level altid foreslår en reel opgave og ikke over/undervurderer XP.

Test visning/validering af badges og buttons på tværs af hele platformen.

TEST drag/drop prototype for widget-layout.

TEST edge cases hvor brugeren får XP fra flere opgaver på én gang.

Opsummering
En stor omgang, hvor især dashboardets visuelle udtryk og den gamificerede oplevelse er opgraderet, XP/level-logik er blevet robust og widgets nu styres og tilpasses helt fra settings/admin.

## Changelog – [Dato: 2025-07-09] ##
Nyt: Udfordringskort med gamification
Widget: Ny Udfordringskort-widget tilføjet på dashboard. Viser automatisk et nyt spørgsmål hver 14. dag, som begge parter skal besvare for at optjene XP.

Databasemodel:

Tilføjet tabel challenge_cards med kolonnerne id, title, question, category, active_from, active_to.

Tilføjet tabel challenge_answers til at gemme brugersvar, XP m.m.

Besvarelser & XP:

Point-system indført: Svar på kortet udløser XP. Mulighed for ekstra XP ved særligt ærlige eller hurtige svar.

Gamification & UX:

Badge-system og streaks: Brugere kan opnå badges for fx “5 svar i træk” eller “sårbarheds-mester”.

Progressbar: Visning af hvor mange kort, der er besvaret.

Automatisk “lås op for partnerens svar”, når begge har svaret på kortet.

Påmindelser/nudges, hvis man ikke har svaret inden for få dage.

Mulighed for anonym refleksion (privat svar).

Arkiv/historik over tidligere kort og besvarelser.

Admin:

Challenge cards kan nu administreres fra backend – med titel, spørgsmål, kategori og aktiv periode.

Cron-job eller scheduled function planlægges til at aktivere nyt kort hver 14. dag.

UI
Widget vises på dashboard.

Modal/side til besvarelse med XP-animation, feedback og badge-fejring.

“Afventer partner”-status indtil begge har svaret.

Historik-side (eller sektion på profil) med overblik over gamle svar og XP.

Note:

Husk at opdatere seed-data i challenge_cards med de nye spørgsmål inkl. titel.

Husk at synkronisere widgets under /settings/widgets og layout under /settings/widgets/layout med den nye widget.

## Changelog – [Dato: 2025-07-08]##

Tilføjet
Ny responsiv kalenderfunktion:

Kalenderen viser nu “Google Calendar”-lignende grid på desktop og Apple-lignende dagsliste på mobil.

Begivenheder kan tilføjes med enkeltklik/tap på dato – ikke længere dobbeltklik.

Kalenderen er opdelt i separate komponenter:

SharedCalendar.tsx: Wrapper, der automatisk vælger mobil- eller desktop-visning.

BigCalendarView.tsx: Desktop grid med react-big-calendar.

MobileCalendarView.tsx: Mobilvisning med react-calendar og dagsliste.

Dummy-events indtil integration med Supabase.

Ændret
Koden til kalenderen er nu delt op i separate komponenter i /components/calendar/

Bedre overblik, genbrug og vedligeholdelse.

Alle imports/exports er nu konsistente (named exports).

Rettet
Fejl med import/eksport er rettet – alle filer bruger nu enten named eller default eksport, så der ikke opstår importfejl i Next.js.

Date-fns imports bruger nu korrekt curly-brace-syntax.

Fjernet
Dobbeltklik som oprettelsesmetode på events er fjernet – nu kun enkeltklik/tap.

Kort opsummering
Hele kalenderfunktionen er nu responsiv, mere mobilvenlig, opdelt i rene komponenter og klar til videreudvikling med database-integration og custom UI.


## Sidste opdateret: 2025-07-07 ##

Nye funktioner og større ændringer
Sexstillinger univers:
Ny inspirationsside for sexstillinger på /sex/positions.

CRUD:
Opret, redigér, og slet sexstillinger via modal (inkl. billedupload).

Kategorier og familier:

Dynamisk mulighed for at vælge eller oprette kategori og familie for hver stilling.

Begge vælges i modal, vises som badges på cards.

Tags:

Opret og vælg flere tags pr. stilling.

Tags kan vælges fra eksisterende eller oprettes direkte i modal.

Tags vises i modal (ikke på card).

Effort/Sværhedsgrad:

Dropdown i modal: Let / Middel / Svær.

Hver effort-type tildeles XP dynamisk.

XP-opsætning kan redigeres under /settings/points via Supabase.

XP-badge:

Nyt badge på hvert card og i modal, der viser XP-optjening for effort.

XP hentes fra xp_settings hvor role = 'common' og action = 'sex_position'.

Status:

Ny, Prøvet, Afvist vælges i modal.

Status vises som badge på card og i modal.

Tried count:

Hvis “Prøvet” vælges, kan antal gange angives.

Vises som badge på card og i modal.

Pagination:

Maks. 12 stillinger pr. side.

Sidevælger vises under cards.

Antal-stillinger:

Tekst i toppen: “Der er X stillinger til inspiration”.

Filterbar (desktop):

Kategori, familie og tags kan vælges som multi-chips (flere på én gang).

Filter påvirker cards live.

Mobilfilter:

“Filtrer”-knap åbner drawer med samme muligheder (kategori/familie/tags).

Resultattal vises før man trykker "Vis resultater".

Design:

Cards har flere badges, bedre padding, ens font, ikon på badges, og mere mobilvenligt layout.

Sidebar/menu:

Nyt hovedpunkt “Intimitet” med “Fantasier” og “Sex inspiration” (positions).

Parforhold-menuen viser nu ikke Fantasier og Sex inspiration.

Sidebar opdateret så hovedpunkter med underpunkter ikke længere kan klikkes direkte.

Databasetabeller og felter
sex_positions

Felter: id, name, image_url, description, status, tried_count, category_id, effort, family_id

sex_position_categories

Felter: id, name

sex_position_families

Felter: id, name

sex_position_tags

Felter: id, name

sex_position_tag_links

Felter: sex_position_id, tag_id

xp_settings

Felter: id, role, action, effort, xp

Relevant opsætning:

role = 'common'

action = 'sex_position'

effort = 'let' | 'middel' | 'svær'

XP kan sættes i /settings/points

Komponenter
/components/ui/badge.tsx
Genanvendt til alle badges (kategori, familie, status, effort, tags).
/components/ui/XpBadge.tsx

Nyt XP-badge på kort og i modal – modtager xp og viser badge. Dette punkt virker ikke, og det er det vi skal arbejde på i næste gpt session.

## 2025-07-06 ##
Implementeret ny struktur for changelog med månedlige filer i /changelog/-mappen for at sikre bedre overblik og undgå for stor README-fil.

Aftalt workflow for vedhæftning ved nye sessioner: altid seneste README.md + aktuel måneds changelog-fil.

Fastsat klare retningslinjer for, hvordan opdateringer dokumenteres:

README indeholder overordnet projektbeskrivelse, arkitektur og mappestruktur.

/changelog/changelog-ÅÅÅÅ-MM.md indeholder detaljerede ugentlige/dagslogs.

Retableret fungerende layout og styling uden global padding på .card i globals.css. Padding håndteres nu lokalt i komponenterne.

Sikret, at drag-and-drop i FantasyBoard og modaler fungerer uden stylingkonflikter.

Checkin-systemet er implementeret med ugentlige behov, modpartsevaluering og XP-tildeling baseret på evalueringsstatus.

Opdateret XP-systemet til at hente point fra xp_settings med korrekt rolle- og effort-afhængighed.

Dokumenteret database-struktur og flow for fantasier, XP, gaver og adgangskontrol.

## Seneste opdateringer (2025-07-06) ##

1. Sexstillinger / Inspirationsunivers
Vi har oprettet en side /sex/positions som fungerer som et inspirationsunivers for sexstillinger.

Siden viser alle stillinger som kort, inkl. billede, beskrivelse, status ("ny", "prøvet", "afvist") og hvor mange gange den er prøvet (tried_count).

Modal til visning og redigering af hver stilling.

Mulighed for at oprette nye stillinger, inkl. upload af billede til Supabase Storage (bucket: sex-positions-images).

Mulighed for at redigere eksisterende stillinger samt slette dem.

Al upload og læsning styres af RLS policies: (auth.role() = 'authenticated') AND (bucket_id = 'sex-positions-images') for alle fire rettigheder.

2. Check-in side /indtjekning/sex
Stilling-data på check-in siden trækkes nu direkte fra sex_positions-tabellen.

Der vises autocomplete-søgning for stillinger samt chips for de 10 mest brugte.

Mulighed for at tilføje ny stilling direkte fra check-in.

Hver stilling kan nu have billede, og antal gange den er brugt vises (hvis feltet er >0).

Fejl med manglende felter i tabellen løst ved at sikre at både tried_count og image_url findes.

3. Database / Supabase
sex_positions-tabellen er udvidet med kolonnerne:

image_url (text, nullable)

description (text, nullable)

status (text, nullable – enum-lignende: 'ny', 'prøvet', 'afvist')

tried_count (integer, default 0)

Storage bucket sex-positions-images oprettet med policies for authenticated access.

Policies for storage select, insert, update og delete sat ens.

4. Rettelser og fejlretning
Sikret at kode til både /indtjekning/sex og /sex/positions aldrig strippes, men leveres komplet.

Fejl omkring properties som ikke findes (f.eks. tried_count) er løst ved at sikre korrekt supabase select og types.

Alle visuelle og funktionelle ønsker til UI på begge sider indført, inkl. kortvisning og modal.

Næste skridt
Videreudvikling på /sex/positions

Mulighed for at filtrere/udvælge stillinger baseret på status, tags eller hyppighed.

Mulighed for at afvise stillinger eller markere dem som prøvet X gange direkte fra inspirationsuniverset.

Integrere gamification/XP med brug af stillinger.

Forbedre billedhåndtering, evt. støtte for flere billeder pr. stilling.

Evt. kobling direkte fra inspirationsunivers til check-in (vælg fra inspirationsunivers ved registrering).

## Opdatering 2025-07-04 ##

Bucketlist – Redigering og sletning af delmål (timeline)
Nyt:
Det er nu muligt at redigere og slette delmål (subgoals) direkte i timeline-visningen på Bucketlist for Par.

Hver delmål har nu to knapper:

Rediger: Mulighed for at rette titel, deadline og ansvarlig direkte inline på listen. Ændringer gemmes til Supabase.

Slet: Giver bekræftelse før sletning. Sletning opdaterer også Supabase og UI.

Teknisk
BucketContext er udvidet med updateSubgoal og deleteSubgoal metoder.

BucketTimeline.tsx bruger disse metoder til at håndtere redigering/sletning, med tilstandsstyring for aktiv redigering/sletning per subgoal.

Mulighed for at annullere ændringer eller fortryde sletning.

UI/UX
Knappen “Rediger” åbner inputfelter direkte på delmålet.

Slet-knappen viser bekræftelsesfelt inden endelig handling.

Intet af den eksisterende kode til tilføjelse/check af delmål er ændret.

Alt er mobilvenligt og følger det eksisterende card-design.

Øvrige forbedringer
Badge-designet på BucketCard bruger nu global Badge-komponent fra /components/ui/badge.tsx til både kategori, ansvarlig og deadline.

Progressbar og spacing på kort er tilpasset for et mere rent og moderne look.

Database

Ingen ændringer i tabelstruktur – alle ændringer sker på data i feltet goals i bucketlist_couple.

## Opdatering 2. juli 2025 ##

Bucketlist-couple:
Projektet har fået opdateret arkitekturen omkring bucket-funktionalitet, så Next.js-kompatibilitet sikres, og alle React/context-fejl fjernes.

Overblik over ændringer:

Opdeling af context og side:

Context-provider (BucketProvider + useBucket) ligger nu i /context/BucketContext.tsx med "use client" i toppen.

/app/bucketlist-couple/page.tsx indeholder kun rendering/visning og bruger altid export default function ....

Ingen context eller createContext i page.tsx – alle Next.js “default export is not a React Component”-fejl løst.

Tilføjelser og rettelser:

Al bucket CRUD håndteres via addBucket, updateBucket, mm., med imageUrl som URL-streng (ikke filobjekt).

Brug af Supabase opdateret til at arbejde mod tabellen bucketlist_couple.

Underkomponenter (BucketlistCoupleContent) anbefales til visning og formularer.

Koden er nu robust over for Next.js 13/14/15 app-router regler.

Fejl omkring “createContext” og hooks løst via tydelig “use client”-adskillelse.

Fejlhåndtering og debug:

Alle typiske build-fejl og import/eksport-problemer beskrevet og håndteret.

Der er indført stricte regler for, hvordan context importeres/bruges i projektet.





