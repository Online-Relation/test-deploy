## Changelog - GPT session 2025-07-25 Part 3 ##
Tilføjet komplet visning og valgmuligheder for ydelser og tillægsydelser via DndKitWrapper.

Bruger kan markere hver ydelse med “Ja” eller “Nej” og gemme valget til Supabase.

Implementeret visning og redigering af personlige grænser (“NO-GO zoner”).

Tilføjet visning af samlet pris og tillægspris (gemmes i fantasy_menu_meta).

Redigeringsadgang (pencil ikon) vises kun for specifik editor-bruger (EDITOR_ID).

Alt data gemmes korrekt i fantasy_menu_items, fantasy_menu_meta og fantasy_menu_nogos.

Optimeret hook-håndtering for at sikre stabil og korrekt rendering uden hook-fejl.

## Changelog - GPT session 2025-07-25 Part 2 ##
✅ Status (2025-07-25)
Vi har arbejdet på siden:
/app/fantasy/menu-editor/naughty-profile/page.tsx

Formålet med denne side er at give brugeren mulighed for at:

Redigere og vælge seksuelle ydelser

Angive priser og tillægspriser

Angive no-go grænser

Drag-and-drop sortere ydelser

Uploade billeder og beskrivelser via komponenter

🔧 Seneste ændringer
Vi har tilføjet DndContext og SortableContext korrekt omkring options, og handleDragEnd er implementeret.

Vi bruger @dnd-kit/core og @dnd-kit/sortable med SortableItem-komponenter.

window is not defined-fejl blev løst ved at bruge dynamic import() og SSR-checks.

Vi indlæser heic2any via await import('heic2any') for at sikre client-only brug.

Komponenter som NaughtyServices, ProfileHeader, og GallerySection er opdateret til at bruge "use client" korrekt og lazy-imports hvor nødvendigt.

❌ Aktuel fejl
Ved deploy opstår følgende build-fejl:

javascript
Kopiér
Rediger
Error occurred prerendering page "/fantasy/menu-editor/naughty-profile".
ReferenceError: window is not defined
🧭 Fejlkilde
Fejlen opstår sandsynligvis fordi der et sted i koden bliver brugt window eller en client-only afhængighed uden check.

Dette kan være:

En afhængighed (fx heic2any, RichTextEditor, eller tredjeparts-modul) som implicit bruger window.

En komponent (fx SortableItem, useUserContext, etc.) der utilsigtet forsøger at tilgå window i SSR.

🎯 Næste skridt (anbefalinger til ny GPT-session)
Find og wrap det modul, der stadig kræver window, i et useEffect eller lazy import (dynamic/await import).

Check alle komponenter importeret på siden (page.tsx) for window, document, localStorage, osv. uden SSR-beskyttelse.

Brug dynamic(() => import(...), { ssr: false }) på mistænkte komponenter.

Hvis nødvendigt: split page.tsx i client/server-del og importér den kritiske del client-only.

Siden der skal arbejdes videre med er:
/app/fantasy/menu-editor/naughty-profile/page.tsx
Og fejl sker i SSR ved deploy.



## Changelog - GPT session 2025-07-25 Part 1 ##
📆 2025-07-25 – Bugfix: "Cannot read properties of undefined (reading 'length')" i NaughtyServices
Problem:
Ved indlæsning af siden /fantasy/menu-editor/naughty-profile kastede komponenten NaughtyServices en runtime-fejl:

TypeError: Cannot read properties of undefined (reading 'length')
Dette skete fordi services i NaughtyServices ikke nødvendigvis var defineret, når komponenten blev rendret, hvilket førte til fejl på linjer som:

const frækhedsProcent = Math.round((services.length / 30) * 100);
Årsag:
Selvom services blev initialiseret som en tom array i page.tsx, kunne der opstå tilfælde, hvor undefined blev sendt videre — f.eks. hvis datahentningen fejlede eller var forsinket, og services ikke blev sat inden komponenten rendrede.

Løsning:
Tilføjet defensiv kontrol i NaughtyServices.tsx, så der ikke længere antages at services er defineret:

const frækhedsProcent = Math.round(((services?.length || 0) / 30) * 100);
Samt:

<p className="text-sm text-gray-500">
  Baseret på {services?.length ?? 0} ud af 30 ydelser
</p>
Resultat:
Siden loader nu uden fejl, selv hvis services er undefined i en kort periode. Det gør appen mere robust overfor dataloading og reducerer risikoen for "500 Internal Server Error".

🛠️ 2025-07-25 – Forbedringer til fantasy-menu-editor
Tilføjet feltet addon_price til tabellen fantasy_menu_meta via SQL migration.

Prisen for tillægsydelser (addon_price) gemmes nu korrekt sammen med price og notes.

Når siden /fantasy/menu-select indlæses, hentes og vises addon_price korrekt.

extra_price vises nu i oversigten på siden /fantasy/menu-editor/naughty-profile ved tillægsydelser.

Opdateret NaughtyServices.tsx til også at vise pris for standardydelser baseret på price fra fantasy_menu_meta.

CTA til redigering af ydelser tilføjet nederst i NaughtyServices.



## Changelog - GPT session 2025-07-24 ##

🆕 Side oprettet: fantasy/menu-editor/page.tsx
Formål:
Denne side gør det muligt for brugeren (Stine) at vælge mellem en række fantasier og tillægsydelser, der vises i to adskilte lister med drag-and-drop-sortering (kun for redaktør). Hver mulighed kan vælges med Ja eller Nej. Brugeren kan:

Tilføje egne fantasier og tillægsydelser

Redigere og slette (hvis man er skaber eller redaktør)

Gemme sine valg, som gemmes i fantasy_menu_items og fantasy_menu_meta

Features inkluderer:

Dynamisk fetch og rendering af fantasier og tillægsydelser

Drag-and-drop sortering med @dnd-kit/core

Mulighed for at tilføje noter og pris for ydelser

Redaktør (hardcoded ID) kan redigere og sortere

🛠 Databaseændringer:
Ingen strukturelle ændringer i tabeller i dag, men følgende eksisterende tabeller anvendes aktivt:

fantasy_menu_options

Bruges til at hente og gemme fantasier og tillægsydelser

Kolonnen is_addon bruges til at adskille de to typer

Kolonnen sort_order bruges til drag-and-drop sortering

fantasy_menu_items

Bruges til at gemme individuelle valg (Ja/Nej) for hver bruger

fantasy_menu_meta

Bruges til at gemme overordnet metadata: pris, noter, bruger-ID

Det næste vi skal arbejde på er at lave en profilside til ovenstående side.

Changelog – GPT session 2025-07-24 (fortsat)
✅ Funktioner og rettelser:
🔐 Adgangslogik til Bestil-knappen:

Der er nu implementeret korrekt brugerlogik baseret på Supabase-session.

Kun brugeren med id 190a3151-97bc-43be-9daf-1f3b3062f97f (Mads) kan se “Bestil”-knappen.

Brugeren med id 5687c342-1a13-441c-86ca-f7e87e1edbd5 (Stine) får knappen skjult.

Der anvendes session.user.id til at identificere den aktuelle bruger.

⚙️ Brugerprofil-id hentes dynamisk:

myProfileId sættes direkte ud fra session.user.id

Stines profil hentes fra Supabase med .eq("username", "Stine")

🧪 Tilføjet omfattende console.log() til debugging

Log af myProfileId og pageProfileId for tydelig adfærd i browserkonsol.

🧼 Ryddet op i fejlkilder som:

Manglende user_id-kolonne

Forkert brug af nickname i queries

Forkert initialisering af session fra useSession()

🧭 Næste step:
➡️ Vi skal nu hente ydelser og no-go-liste fra Supabase og vise dem dynamisk i stedet for hardcoded arrays.

## Changelog - GPT session 2025-07-14 Part 2 ##
Changelog – Bet/Widget/Probability System
Dato: 2025-07-14

Nye features
Væddemålssystem tilføjet med mulighed for at oprette, gemme som skabelon og genbruge væddemål.

Intervalgæt på likes (guess_1_min/max og guess_2_min/max) tilføjet til bets.

Progress-tracking: Indtastning af antal likes pr. dag for hvert væddemål (bet_progress).

Automatisk sandsynlighedsberegning på hvem der vinder, vist som interaktiv bar.

Profilbilleder vises i widgets og probability-bar (hentes fra Supabase avatars).

LinkedIn-themed widget til aktivt væddemål (med LinkedIn farver og ikon).

Countdown på widget til slutdato.

Mulighed for at deaktivere et væddemål (sæt status til inactive).

Redigering af eksisterende væddemål.

Resultatvisning og automatisk vinderkåring når væddemål er slut.

Støtte for navne og avatar på deltagere gennem Bet-interface.

Opdaterede/ændrede filer
/components/widgets/ActiveBetWidget.tsx

Visning af aktivt væddemål med LinkedIn-design.

Indhenter navne og avatars på deltagere.

Viser countdown, præmier, og deltagerbokse.

Sender korrekte props til sandsynlighedsbar.

/components/BetProbabilityBar.tsx

Visuel slider/progress-bar for sandsynlighed.

Fjernet navne – nu kun avatar-billeder på slideren.

Procenter vises under slideren.

Props-typen udvidet med valgfri navn og avatar.

Bedre beregning af sandsynlighed.

/app/settings/bet/page.tsx

Oversigt over alle væddemål og skabeloner.

Mulighed for at gå til detaljeret bet-side.

/app/settings/bet/[betId]/page.tsx

Detaljevisning, inkl. mulighed for at redigere og deaktivere.

Viser alle relevante oplysninger om bet.

/app/components/CreateBetForm.tsx

Udvidet form med intervalgæt, valg af deltagere og præmier.

Mulighed for at gemme som skabelon inkl. skabelonnavn.

Type/interfaces:

Bet interface udvidet til at støtte navn og avatar som valgfri props.

Typedefinition opdateret alle steder for at undgå TS-fejl.

## Changelog - GPT session 2025-07-14 Part 1 ##
1. Global Modal opdatering med children og bedre struktur
Rettet GlobalModal.tsx til at bruge children fremfor content for indhold, så det er mere fleksibelt og kan håndtere alt slags JSX.

Tilføjet scrollbart indhold med maxHeight og overflow-y-auto for bedre mobiloptimering.

Sørget for at billede ikke følger med ved scroll, men ligger fast øverst i modal.

Justeret modal layout, så footer altid ligger i bunden med fast højde og skygge.

Implementeret en tydelig skillelinje (border-b) mellem brødtekst og kategori-badges.

2. Testside med Global Modal
Skrevet en testside test/page.tsx med en knap, der åbner global modal.

Modal indeholder billede, titel, brødtekst, og badges for kategorier.

Tilføjet footer med to knapper: “Rediger” og “Gem” i flexbox for pæn layout.

Sørget for at billeder, tekst og badges vises korrekt og i den rigtige rækkefølge.

3. Implementering af Rediger-funktionalitet (sparring)
Diskuteret at rediger-funktionalitet skal styres i test/page.tsx (eller side-komponenten) og ikke i selve GlobalModal.

Løst ved at lade side-komponent håndtere “edit mode” og ændre indhold dynamisk.

RichTextEditor-komponenten foreslået integreret i modal via children i rediger-tilstand.

4. Billedupload til DashboardBanner widget
DashboardBanner widget opdateret til at hente det nyeste bannerbillede for begge brugere (globalt, ikke kun pr bruger).

Tilføjet upload-funktion med EXIF-læsning og konvertering af HEIC til JPEG.

Integreret ImageCropModal til cropping og upload af bannerbillede til Supabase Storage.

Billede vises med upload-knap øverst til højre for nem ændring.

5. Implementering af inspirationscitater i DashboardBanner
Oprettet database-tabel banner_image_quotes til citater.

DashboardBanner loader alle citater fra Supabase og viser et aktivt citat under banneret.

Citat roteres automatisk hver dag kl. 01:00 med wrap-around.

Hvis alle citater er vist, vises fallback-tekst: “Er der virkelig ikke mere inspirations citater til flere oplevelser?”

6. Dynamisk overskrift med uploaderens navn over banner
Tilføjet tekst “Det her minde betød noget for {uploaderName}” øverst inde i widgetten.

uploaderName hentes dynamisk som den sidste bruger, der uploadede bannerbilledet.

Overskriften vises kun, hvis navn er tilgængeligt.

7. Samlet visuel boks for DashboardBanner-widget
Overskrift, bannerbillede og citat samlet i én fælles boks med hvid baggrund, rundede hjørner, og skygge.

Ensartet padding og margin mellem overskrift, billede og citat.

Aspect ratio på billedcontainer justeret til 3/1.5 for lidt højere banner.

Upload-knap, billede og overlays placeret pænt indenfor denne boks.

Citat-boksen er en del af samme container, så det visuelle udtryk bliver mere samlet og harmonisk.

8. Flere mindre visuelle og funktionelle forbedringer
Rettet padding og margin mellem overskrift og billede, så der er god luft.

Fjernet unødvendige mellemrum mellem citat og andre elementer.

Konsistent farve og font-styling til overskrift, citat og badges.

Sikret at upload-knappen har korrekt hover-effekt og placering.

Fremadrettede tanker / næste skridt
Implementere RichTextEditor som redigerbart felt i GlobalModal på test-side.

Mulighed for at markere citater som brugt og undgå gentagelse (mere avanceret cyklus).

Udvide DashboardBanner til også at kunne vise brugerens upload-tidspunkt og evt. metadata (geo, tidspunkt).

Forbedre caching og server-side rendering for citater og banner.

Mulighed for at sætte udløbsdato på citater eller brugertilpasning.

Problem: Stine kan ikke se billederne i mindegalleriet, mens Mads kan se sine billeder uden problemer.

Mulige årsager:

Det kan være, at den bruger-id, der bruges til at hente billederne, ikke matcher Stines bruger-id korrekt. Det vil sige, at Stine ikke er logget korrekt ind, eller at user.id i koden ikke er sat korrekt for hende.

Koden henter billeder ud fra en filter på user_id, hvilket betyder, at hver bruger kun kan se sine egne billeder. Hvis Stine ikke har uploadet billeder, vil hun ikke få vist noget.

Hvis formålet er, at både Mads og Stine skal kunne se de samme billeder (f.eks. fælles billeder i parret), så skal billedhentningen ikke filtrere på bruger-id, men fx på et fælles id, eller uden brugerfilter.

Anbefaling: Tjek hvilket bruger-id der er tilknyttet Stine i koden, og overvej om du skal ændre hentningen, så den viser billeder ud fra en fælles identifikation i stedet for kun brugerens eget id.

Problem: Stine kan ikke se billederne i mindegalleriet, mens Mads kan se sine billeder uden problemer.

Mulige årsager:

Det kan være, at den bruger-id, der bruges til at hente billederne, ikke matcher Stines bruger-id korrekt. Det vil sige, at Stine ikke er logget korrekt ind, eller at user.id i koden ikke er sat korrekt for hende.

Koden henter billeder ud fra en filter på user_id, hvilket betyder, at hver bruger kun kan se sine egne billeder. Hvis Stine ikke har uploadet billeder, vil hun ikke få vist noget.

Hvis formålet er, at både Mads og Stine skal kunne se de samme billeder (f.eks. fælles billeder i parret), så skal billedhentningen ikke filtrere på bruger-id, men fx på et fælles id, eller uden brugerfilter.

Anbefaling: Tjek hvilket bruger-id der er tilknyttet Stine i koden, og overvej om du skal ændre hentningen, så den viser billeder ud fra en fælles identifikation i stedet for kun brugerens eget id.



## Changelog – 14. juli 2025 ##
Generelt
Etableret en ny komponentstruktur for memories-funktionalitet:

Oprettet mappe /components/memories/ til håndtering af minder-relaterede komponenter.

Flyttet MoodboardGallery.tsx til /components/memories/MemoriesGallery.tsx for bedre organisering.

Implementeret callbackfunktionalitet for at håndtere klik på mindebilleder i MemoriesGallery.

Tilføjet modalvisning til mindegalleri med detaljer om valgt billede (dato, titel, geolokation osv.).

Global modal-komponent (GlobalModal.tsx) oprettet som central, genanvendelig modal med støtte til:

Titel

Billede

Dynamisk indhold (children)

Kategoribadges (array af strenge)

Footer med knapper eller andet indhold

Luk-knap (krydset) altid synligt og placeret uden overlap med billedet

Scrollbar i modalindhold, mobiloptimeret og med max højde (90vh)

Modal & UI-forbedringer
Rettet modalindhold til at være scrollable med fast billede og footer for bedre UX.

Indført visuel separation med klare streger:

Mellem brødtekst (children) og kategori-badges

Mellem kategori-badges og footer

Forbedret styling af luk-knap, så den aldrig overlapper billedet.

Tilføjet fleksibilitet i modal ved brug af children frem for statisk content prop.

Footer designet til at indeholde flere knapper side om side (fx Gem + Rediger).

Mulighed for at angive flere kategorier som array og vise dem som badges i modal.

Brugerdefineret CategoryBadge.tsx-komponent oprettet til styling og genbrug af kategori-badges globalt.

Fjernet hardcoding af kategori-badges i modal, nu dynamisk via categories prop.

Memories Gallery
Opdateret MoodboardGallery med eventprop onMemoryClick for at åbne modal med billedeinfo.

Galleriets modale visning bruger nu GlobalModal for konsistent UI.

Tilføjet håndtering af billede metadata (taken_at, location osv.) i modalindhold.

Sikret responsivt design og adgang til flere oplysninger om minder direkte i modal.

Billedhåndtering & EXIF-data
Integration af exifr til at læse EXIF-data ved upload.

Tilføjet understøttelse af HEIC-billeder via konvertering med heic2any.

Læsning og lagring af metadata (dato, geolokation) fra billeder i Supabase.

Implementeret fallback for dato, hvis EXIF-data ikke er tilgængelig.

Forbedret filupload og billedhåndtering med cropmodal og metadatainddragelse.

Testside & Demonstration
Oprettet /app/test/page.tsx som sandbox til test af GlobalModal.

Implementeret testindhold med billede, titel, tekst, og kategoribadges.

Tilføjet footer med Gem og Rediger knapper, inkl. fleksibel eventhåndtering.

Sikret mobilvenlig scroll på modalindhold.

Fjernet fejl i prop-typer (brug af children i stedet for content).

Forbedret struktur og styling i testmodal for bedre brugeroplevelse.

Samlet arkitektur & udviklingsproces
Besluttet at al kategori-badge styling og funktionalitet skal være i én separat komponent (CategoryBadge.tsx), for at sikre genbrug og nem vedligeholdelse.

Anbefaling om at holde modaler generelle og bruge children til indhold, så UI forbliver fleksibelt og ikke stivner i en bestemt struktur.

Diskussion og afklaring af hvilke funktionaliteter der skal ligge i modal og hvilke der skal håndteres på siden, fx redigeringslogik.

Fokus på brugervenlighed med klare visuelle adskillelser og tilgængelighed.

## Changelog – 13. juli 2025 ##
1. Sandhedens Time (Udfordringskort)
Introduktion af CTA:

Når en bruger har besvaret et udfordringskort, vises en CTA-knap "Redigér mit svar", som giver brugeren mulighed for at ændre deres svar, indtil de har afsløret det.

Når både brugeren og deres partner har besvaret, vises "Afslør mit svar"-knappen for at afsløre svarene for den anden part.

Når "Afslør mit svar"-knappen er trykket, forsvinder både knappen for at redigere og knappen for at afsløre, og det vises en ny CTA-knap med teksten "Fuldfør", som markerer kortet som afsluttet.

Visning af svar:

Efter afsløring af svar bliver brugernes svar synlige for partneren, og en etiket vises for at indikere, at svaret er blevet afsløret.

Funktionalitet for ny tekst hver 14. dag:

En ny tekst vises hver anden søndag kl. 5:00, som skal være motiverende og hjælpe brugeren med at arbejde på ærligheden i deres parforhold. Teksten hentes fra en database, og den skifter automatisk efter hver 14. dag.

Historik:

Når en bruger har afsluttet et kort, flyttes det til "Historik" sektionen, og tidligere svar bliver bevaret til fremtidig reference.

SQL og Database Integration:

Der er oprettet en tabel i databasen, som henter en ny tekst hver 14. dag og viser den under overskriften "Udfordringskort".

2. Udviklingskort
Tekstændringer og tilpasning af svar:

Funktionaliteten for redigering af svar er blevet optimeret, så brugeren kan opdatere deres svar, indtil de har afsløret dem.

Når begge parter har afsløret deres svar, bliver redigeringsmuligheden og afsløringsknappen fjernet, og der vises en ny "Fuldfør"-knap.

Visning af svar og afsløring:

Begge parter har nu mulighed for at afsløre deres svar for den anden person.

Når afsløringsknappen er trykket, vises partnerens svar. Hvis den ene part ikke har svaret endnu, forbliver deres svar skjult, indtil de har svaret.

Navigation og Brugervenlighed:

CTA-knapperne er placeret på en måde, så de er nemme at finde og bruge under interaktionen med kortet.

Den logik, der håndterer visning og opdatering af svar, sikrer, at brugeren altid kan navigere mellem deres svar og afsløringsmuligheder nemt.

Mobilvenlig:

Alle funktioner i sandhedens time og udviklingskortet er mobilvenlige og tilpasset for brug på mobile enheder.

3. Tekstdatabase og Motivationssystem
Ny tekst hver 14. dag:

Der er udviklet en funktion, som henter en ny tekst, hver gang en udfordring er afsluttet, og den bliver automatisk opdateret efter 14 dage.

Teksterne er designet til at være motiverende og åbne op for ærlige samtaler mellem parterne.

4. Fejlrettelser og Forbedringer
Fejlrettelser:

Vi har rettet flere fejl, hvor CTA-knapper ikke blev opdateret korrekt, når en bruger havde afsløret deres svar.

Logikken omkring visning af svar og håndtering af afsløringsknappen er blevet forbedret.

Forbedringer:

Brugervenligheden er blevet forbedret, så det er lettere at navigere mellem de forskellige interaktive elementer i sandhedens time.

Der er implementeret en logik, som automatisk håndterer de nødvendige opdateringer i grænsefladen (f.eks. når en knap forsvinder eller ændrer sig).


Ændringer på DateBoard og Modal:
Ny kategori-opsætning:

Opdateret Modal-komponenten til at bruge kun date-kategorier (ingen fantasy-kategorier længere).

Dropdown til kategorier opdateret til at hente og oprette nye date-categories direkte fra Modal.

Implementeret ny funktionalitet for at oprette kategori direkte i Modal (brugeren kan vælge eksisterende kategorier eller oprette en ny).

Opdateret useCategory-context til at kun indeholde dateCategories og opdateres via refreshCategories.

Databaseændringer:
Tabel for Date Ideas:

Oprettet en ny dates-tabel i Supabase for at håndtere alle Date Ideas.

Kolonner i dates-tabellen:

id: (Primary Key) Unik identifikator for hver date (UUID).

title: Titel på Date Idea (string).

description: Beskrivelse af Date Idea (text).

category: Kategori tilknyttet Date Idea (string).

image_url: URL til billede (string).

extra_images: Liste af URL’er til ekstra billeder (array of strings).

status: Status for Date Idea (string, værdier: 'idea', 'planned', 'fulfilled').

user_id: Bruger-ID for ejeren af Date Idea (string).

created_date: Dato og tid for oprettelse af Date Idea (timestamp).

planned_date: Dato og tid for planlagt Date Idea (timestamp).

fulfilled_date: Dato og tid for opfyldt Date Idea (timestamp, kan være null).

Tabellen date_categories håndterer nu kategorier relateret til Date Ideas.

Skift fra fantasy_categories til date_categories i relation til Date Board.

Funktionalitetsændringer:
DateModal opdateret til at bruge kun date-data:

Skiftet alle forekomster af fantasy til date for at reflektere, at nu er der kun Date Ideas.

Implementeret funktionalitet til at uploade og vise billeder direkte i Date Ideas (fx via supabase.storage).

Kategori-funktioner og logik er blevet fuldstændigt adskilt fra fantasy, og al datahåndtering sker nu på Date Ideas.

UI & Interaktivitet:
Date Ideas Grid:

Implementeret et drag-and-drop interface via DndContext for at kunne flytte Date Ideas mellem statusser (Ideer, Planlagt, Fuldført).

Status-system integreret for Date Ideas (Ideer, Planlagt, Opfyldt).

Fejlrettelser:
Kategorier i DateBoard:

Fjernet alle referencer til fantasy-kategorier i DateBoard og Modal.

Dropdown i Modal viser kun relevante Date Categories.

Andre opdateringer:
Supabase-struktur:

Tabellen fantasy_categories er blevet erstattet med date_categories for at håndtere kategorier til Date Ideas.

Alle API-kald relateret til kategorier på Date Board og Date Ideas er blevet opdateret til at pege på date_categories.

## Changelog – 12. juli 2025 ##
Implementering af visning af indlægstekst og forbedret UI
Tilføjelser og ændringer:
Visning af tekstuddrag for hvert indlæg:

Tidligere blev kun titlen vist.

Nu vises de første 300 tegn af entry.text under titlen som et tekstuddrag.

Teksten vises som ren tekst med HTML-tags fjernet for at undgå visning af rå HTML (<p>, <br> etc.).

Dette blev løst ved at implementere en funktion til stripping af HTML-tags (stripHtml), som konverterer RichTextEditor-HTML til almindelig tekst.

Redigeringsvisning af indlæg:

Når man redigerer et indlæg, vises RichTextEditor med fuld tekst.

Bannerbillede upload og fjern-knap vises i redigeringstilstand.

Visning af tags i sidepanelet:

Hvis der ingen tags er, vises teksten "Ingen tags tilgængelige" i kursiv og grå.

Tags vises med klikbare knapper, der tillader filtrering på tags.

Streak visning:

Antal dage i streak vises med en lilla baggrund i sidepanelet.

Forbedret mobilvenligt layout for filtreringspanel:

Sidepanelet blev ombygget til at kunne styles til stacked (top-baseret) layout på små skærme (responsivt).

Brug af Tailwind-klasser for at sikre, at filtreringssektionen er let tilgængelig på mobil (fx flex-wrap, gap, max-width mv.) — selvom du stadig ønskede at finpudse dette.

Fejlrettelse:

Undgik fejlen med dobbelt export default function TankerPage() ved at samle al logik i én komponent.

Fjernede forkert dobbeltdeklaration af state allTags.

Flyttede initialisering af Supabase client til toppen, som var korrekt før.

Rydning og strukturering:

Sorterede useState hooks i én samlet blok.

Samlede useEffect hooks for datahentning og lokal storage håndtering.

Upload af bannerbilleder:

Upload-funktionen til Supabase Storage blev bekræftet og integreret både ved oprettelse og redigering.

Visning af uploadet billede under inputfeltet.

Fjern-knap til bannerbillede vises ved redigering.

Filterfunktionalitet:

Filtrering på kategori og tags fungerer nu korrekt.

Søgning på titel, tekst og refleksion er implementeret og case-insensitiv.

Sikkerhed og performance:

Undgået at slice direkte i HTML for tekstuddrag for at forhindre brudt markup.

Strippe HTML-tags til præsentation for bedre brugeroplevelse.

Noter på Bucketlist:
Implementeret funktionalitet til at oprette, redigere og slette noter (historik) tilknyttet hvert bucket-mål via separat tabel bucket_history.
Noter vises nu direkte i modalboksen for det enkelte mål.

Visning af antal noter:
Der er arbejdet på at vise “Der er X noter” nederst på hvert bucket-kort på forsiden.
Funktionen er delvist implementeret, men ikke færdiggjort/aktiveret endnu.

Fejlfinding og integration:
Fejl i noteflow relateret til user-id, bucket-id og foreign key i Supabase identificeret og løst.
Test af insert direkte i SQL-editor for at sikre validitet af UUIDs og relationer.

Tilføjet/ændret:

Ny tabel: error_log

Kolonner:

id (uuid, primary key)

title (text)

description (text)

page (text, hovedside-navn)

subpage (text, underpunkt-navn, nullable)

category (text, værdier: 'Kritisk', 'Mindre fejl')

created_at (timestamp, default now())

Ny tabel: error_pages

Kolonner:

id (uuid, primary key)

name (text)

parent_id (uuid, nullable, reference til id i samme tabel for underpunkter)

created_at (timestamp, default now())

Tilføjet/ændret i idebanken:

Kolonnerne importance og created_at i idea_bank

Kolonnen parent_id i idea_pages (for at understøtte underpunkter)

Triggers (valgfrit):

Trigger oprettet, så nye sider/underpunkter tilføjet i idea_pages automatisk oprettes i error_pages (og omvendt, hvis valgt).

Indexes:

(valgfrit/kan anbefales) Indexes på page, subpage og category i både idea_bank og error_log for hurtigere søgninger og filtrering.

Tilføjelse af billedupload til Manifestation Board
Ny funktionalitet: Mulighed for at uploade et bannerbillede ved oprettelse af manifestation.

Redigeringsmodal: Tilføjet billeduploadfelt i redigeringsmodal, så man kan ændre/bytte billedet på eksisterende manifestationer.

Billedvisning: Bannerbilledet vises nu både i kortoversigten og i modalvisningen.

Uploadhåndtering: Upload af billeder gemmes i Supabase Storage under bucket manifestation-images.

Forbedret brugeroplevelse: Upload-knapper deaktiveres under billedupload, og der vises upload-status.

Fejlhåndtering: Visning af fejlbeskeder ved upload- eller opdateringsfejl.

Kodeforbedringer: Refaktoreret Modal-komponent til bedre state-håndtering af billedupload, titel og beskrivelse.

Status og Opdatering – Alkohol-sektion
Seneste ændringer:

Tilføjede felter og funktioner:
1. Stemning (Mood)
Viser fordelingen af daglige stemninger (frost, kølig, neutral, lun, hed) med doughnut-diagram.

Lister optælling for hver stemningstype.

2. Top følelser/tanker (Tags)
Bar chart viser de 12 mest brugte tags for følelser/tanker, sorteret efter hyppighed.

3. Udvikling over tid (Linje-diagram)
Viser månedlig udvikling i positive og negative tanker/følelser, baseret på valgte måneder (3, 6, 12, 24).

4. Blomster
Viser hvor mange dage siden, du sidst har givet blomster til din partner.

Viser besked hvis du aldrig har givet blomster, eller hvis det er gjort i dag.

5. Gaver
Viser hvor mange dage siden, du sidst har givet en gave.

Viser hvor mange gaver du samlet har givet, og total værdi i kroner.

Beregner gennemsnitlig udgift pr. dag siden fast startdato (11/7-2025).

6. Alkohol
Doughnut-diagram for fordeling mellem “Alkohol drukket” og “Ingen alkohol”.

Farver og labels matcher nu intentionen (grøn for alkohol, gul for ingen).

Optælling og forklaring i tekst under diagrammet.

7. Ærlighedssnak
Tæller antal registrerede ærlighedssamtaler (honesty_talk).

Viser liste over alle registrerede snakke med dato og evt. emne.

8. “Jeg elsker dig” – hvem sagde det først?
Doughnut-diagram og liste, som viser hvem der har sagt “jeg elsker dig” først/kun (mig, partneren, begge, ingen).

Viser også hvor mange dage siden, du/partneren/sidst har sagt det.

Viser hvis ingen nogensinde har sagt det.

Generelle forbedringer
Alle diagrammer og lister opdateres dynamisk baseret på periodevalg (antal måneder).

Alle felter og visualiseringer trækker på daglige checkins i Supabase.

Nye aggregationer og beregninger tilføjet for at få mere præcis statistik og brugerfeedback.

## Changelog – 11. juli 2025 Part 1 ##
Databaseændringer
Tilføjet tabel manifestation_points med kolonner:

id (unik identifikator)

title (titel på manifestpunkt)

content (HTML eller tekstindhold for manifestpunktet)

remind_me (boolean, om punktet skal vises i widget)

created_at (timestamp)

Funktionelle ændringer i Manifestation og Widget
Omdannet manifest-widget /components/widgets/ManifestReminderWidget.tsx til at:

Hente punkter fra manifestation_points i stedet for kun manifestations

Splitte content i flere afsnit baseret på nummerering og linjeskift

Vise ét tilfældigt manifestpunkt pr. dag, baseret på dag i året modulo antal punkter

Justeret eksisterende manifestation-funktionalitet, så data fra manifestation_points indgår korrekt i widget.

Widget understøtter nu visning af et enkelt manifestpunkt dagligt med titel og indhold.

Fremtidige planer (noter)
Udvikling af AI-genereret profiltekst baseret på udvalgte kolonner i bruger- og partnerprofiler.

Overvejelse af settings-side /settings/profileheadersuggestion til at vælge hvilke kolonner der skal inkluderes i AI-prompt.

Mulighed for dynamisk tilpasning af tekst baseret på brugerens og partnerens data.

Forventet proof-of-concept klar inden for 30-60 minutter, fuld implementering på 2-3 timer.

## Changelog – 10. juli 2025 Part 4 ##
Log over notifikationsprojektet – Status og problemstillinger
Hvad vi har lavet
Notifikationstyper (konfiguration)
Vi har defineret notificationsConfig.ts med klare typer, skabeloner, links og ikoner for notifikationer.

Funktion til oprettelse af notifikationer (createNotification)
En funktion i /lib/notifications.ts, som opretter notifikationer i databasen med korrekt tekst og link baseret på config.

Parsing af notifikationer (parseNotification)
Funktion der omdanner rå notifikationer til frontend-venligt format med tekst, link, ikon og type.

DashboardUserWidget-komponenten
En React-komponent der viser notifikationsikon, antal ulæste og en dropdown med parsed notifikationer.

NotificationSettingsPage-komponenten
En settings-side, hvor brugeren kan slå notifikationstyper til og fra. Denne gemmer indstillinger i notification_settings tabellen.

Filtrering af notifikationer i widget
Widgetten henter brugerens notification_settings og filtrerer notifikationer, så kun aktiverede typer vises.

RLS-politikker i Supabase
Vi har gennemgået nødvendigheden af RLS (Row Level Security) på både notifications og notification_settings tabellerne.

De væsentlige problemer og hvorfor det ikke virker
Notifikationer oprettes ikke som forventet

Problemer med createNotification kald i frontend (fx i bucket-oprettelse).

Mulige RLS regler i Supabase, som blokerer indsættelse uden fejlbesked.

Manglende eller ukorrekt oprettede rækker i notifications.

notification_settings opdateres ikke eller bruges ikke

Selvom tabellen eksisterer, bliver den ikke opdateret korrekt ved brugerens valg.

Upsert-kald i frontend kan fejle pga. ukorrekt onConflict eller manglende constraint.

Manglende synkronisering mellem notification_settings og filtrering af notifikationer.

Filtrering i widget fejler pga. manglende type i parsed notifikationer

parseNotification manglede at returnere type felt, så filterfunktionen fejlede.

Dette er nu rettet, men kan have påvirket tidligere test.

Filtypen og JSX-forvirring

Forkert brug af .ts vs .tsx filer skabte syntaksfejl og frustration.

createNotification skal være i .ts, React-komponenter i .tsx.

Manglende debug logs i kritiske funktioner

Vi har tilføjet flere console.log, men kan have overset at følge flowet helt til databaseindsættelse og RLS fejl.

Manglende klar separation mellem “notifikationer” og “notifikationsindstillinger”

Uklare forventninger til hvordan notification_settings skal bruges.

Ingen tydelig dokumentation eller eksisterende backend-logik, der forbinder indstillinger med filtrering.

Anbefaling til næste session
Gennemgå RLS-politikker i Supabase for begge tabeller grundigt
Sæt simple policies op til test med tilladelse til alle handlinger for din bruger, for at isolere om RLS blokerer.

Tilføj og test debug-logs helt nede i backend/API og Supabase-klientens insert/upsert-kald
Bekræft at kald når databasen, og log fejl.

Test manuel SQL-indsættelse i Supabase SQL-editor for både notifications og notification_settings
Bekræft at indsættelser ikke fejler.

Isoler frontend-kald
Prøv simple fetch/upsert uden UI-komponenter for at sikre at datahåndtering virker.

Dokumentér datamodellen
Saml alle tabelstrukturer, constraints, RLS-politikker og forventede felter i et dokument.

Byg trinvis: først sikre oprettelse af notifikationer, dernæst visning, til sidst filtrering.


## Changelog – 10. juli 2025 Part 3 ##
Changelog & Status for /app/indtjekning/sex/page.tsx
Hvad vi har lavet indtil nu
Hele sexlog-systemet:

Formular til at oprette og redigere sexlogs med felter: dato, tid, initiativ, type, "vi prøvede noget nyt", stillinger, placering, sted, tags.

Valgfelter og autocomplete på stillinger (positions), placeringer (locations), steder (places) og tags – alt synkroniseres til Supabase.

Mulighed for at tilføje nye stillinger, placeringer, steder og tags direkte fra UI.

Under “vi prøvede noget nyt” kan man vælge og gemme en stilling som blev prøvet for første gang.

Rediger-funktion: Man kan vælge en tidligere log og få alle værdier fyldt ud, klar til redigering.

Gem/redigér logik:

Hvis man opretter ny log, laves der INSERT i sexlife_logs, og tilhørende batch-inserts i relationstabellerne (positions, locations, places, tags).

Hvis man redigerer eksisterende log (via editingId), opdateres hovedloggen (UPDATE), og ALLE gamle relationer i de fire koblingstabeller slettes og genskabes med nye værdier.

Seneste logs vises i bunden:

Viser de fem nyeste registreringer, kan åbnes til redigering.

State resetter korrekt efter gem/annuller.

Hvad er problemet lige nu?
Kort version:

Når man redigerer en eksisterende sex-log og tilføjer/fjerner en stilling (position), så bliver den ikke korrekt opdateret i visningen (eller i databasen). Enten bliver koblingen ikke gemt, eller også vises den ikke efterfølgende i UI.

Det vi har prøvet:

Vi har sikret, at der:

Laves UPDATE på hovedtabellen.

SLETTES ALT i de fire koblingstabeller for den aktuelle log_id.

Herefter INSERTES de nye koblinger.

Vi har testet med console.log og set, at selectedPositions har de rigtige IDs ved gem.

Vi har sikret at fetchLogs kaldes, så UI henter seneste data.

Der er ingen SQL/JS errors i consollen.

State bliver nulstillet og loggen lukkes.

Men:

Efter redigering mangler de nye/ændrede stillinger i listen.

UI kan godt vise de gamle værdier, som om den ikke får den nye kobling med fra Supabase.

Det gælder især for “stillinger” – de andre felter lader til at virke.

Forslag til næste GPT/udvikler
Fokusér på koblingen mellem sexlife_logs og sexlife_log_positions:

Tjek om selectedPositions faktisk indeholder de rigtige IDs ved redigering og gem.

Tjek at de nye INSERTs i sexlife_log_positions faktisk bliver lavet i Supabase.

Tjek at fetchLogs virkelig får de nye koblinger med hjem fra Supabase – især at select-statementet matcher!

Tjek at der ikke er caching, race conditions, eller stale state der forhindrer ny visning.

Supabase join-syntax skal inkludere nested objekter: Måske mangler en dybere join/rel.

Eksempel på select-statement vi bruger nu (til logs og koblinger):

js
Kopiér
Rediger
supabase
  .from('sexlife_logs')
  .select('*, sexlife_log_positions(position_id), sexlife_log_locations(location_id), sexlife_log_places(place_id), sexlife_log_tags(tag_id)')
  .order('log_datetime', { ascending: false })
  .limit(5)
TL;DR:
Når man redigerer en sexlog og vælger nye stillinger, gemmes ændringen ikke synligt – eller også hentes den ikke korrekt hjem igen. Koblingen “stillinger” for en given log driller stadig.

## Changelog – 10. juli 2025 Part 2 ##
Changelog - Lykkehjul Funktion til Quiz Conversation Starter
1. Funktionalitet implementeret
Ny side /quiz/spin til lykkehjulsfunktionalitet efter quiz-gennemførsel.

Lykkehjul med 8 felter (alternativt "Stine" og "Mads") som spinner og tilfældigt vælger, hvem der skal starte samtalen.

Konfetti-animation ved afslutning af spin.

Knappen "Spin hjulet" forsvinder, når der er valgt en person.

Knappen "Se resultater" vises efter valg, og fører videre til quiz-resultatsiden.

Pil peger konstant nedad øverst over hjulet (ikke roterende).

Hjulet spinner flere hele omgange (4 ekstra spins) og lander på det valgte felt.

2. Integration med Supabase
Ny tabel oprettet i Supabase: quiz_conversation_starter_log

Kolonner:

id (UUID / auto increment)

user_id (UUID, reference til den bruger, der spinner)

quiz_key (string, reference til quizzen)

starter (string, navnet på den valgte person fra hjulet, fx "Stine" eller "Mads")

created_at (timestamp, automatisk genereret)

Når hjulet spinner færdigt, indsættes et nyt log-entry med quiz-key, den ansvarlige (starter) og bruger-id.

3. Routing / Navigation
Når quizzen er gennemført, redirectes brugeren til /quiz/spin?quizKey=[quizKey]&session=[sessionId].

Efter spinning kan brugeren klikke "Se resultater", som sender dem videre til /quiz/resultater/[quizKey]?session=[sessionId].

QuizSpin-komponenten modtager quizKey og sessionId som props for korrekt databaseindsættelse og routing.

4. Kodeændringer
Oprettet komponent QuizSpin i /app/quiz/spin/QuizSpin.tsx med lykkehjulslogik og visuel fremstilling.

Tilføjet side /app/quiz/spin/page.tsx, som håndterer parametre og renderer QuizSpin-komponenten.

Opdateret quiz-gennemførelsesflow til at redirecte til /quiz/spin efter quiz-afslutning (implementeres i quiz-side, fx /app/quiz/[quizKey]/page.tsx).

5. Forbedringer / ekstra
Brugerkontekst (useUserContext) anvendes for at hente bruger-id til databaseindsættelsen.

Error handling på databaseindsættelse med konsol-logs.

Konfetti-visualisering ved afslutning af spin.

Spinneranimation med CSS transitions og beregnet rotationsvinkel for realistisk spin.

Forhindring af gentagne spins, mens hjulet spinner.

Databaseændringer (Supabase SQL)
Hvis du ikke allerede har kørt denne, skal du køre:

sql
Kopiér
ALTER TABLE quiz_conversation_starter_log
ADD COLUMN IF NOT EXISTS quiz_key TEXT;

ALTER TABLE quiz_conversation_starter_log
ADD COLUMN IF NOT EXISTS starter TEXT;

ALTER TABLE quiz_conversation_starter_log
ADD COLUMN IF NOT EXISTS user_id UUID REFERENCES profiles(id);

ALTER TABLE quiz_conversation_starter_log
ALTER COLUMN created_at SET DEFAULT now();
Hvis tabellen ikke eksisterer, kan denne oprette den:

sql
Kopiér
CREATE TABLE IF NOT EXISTS quiz_conversation_starter_log (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES profiles(id),
  quiz_key TEXT NOT NULL,
  starter TEXT NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT now()
);
Opsummering
Lykkehjul er nu en integreret del af quiz-flowet og sikrer tilfældig samtalestarter.

Data om samtalestarter gemmes for hver quiz og bruger i Supabase.

Routing er sat op, så man kan bevæge sig naturligt i flowet: quiz → lykkehjul → resultater.

Visuelt og funktionelt er lykkehjulet optimeret med animation, konfetti og brugervenlighed.

## Changelog – 10. juli 2025 Part 1 ##
Aktivitetstracking & logging
Ny logik for aktivitetslogning:

Tilføjet /lib/logUserActivity.ts med central logik til at indsætte brugeraktivitet i Supabase.

Logging udføres kun for bruger-id: 5687c342-1a13-441c-86ca-f7e87e1edbd5 (Stine).

ClientLayout – logging & routing:

Oprettet ny komponent: /app/ClientLayout.tsx.

Denne komponent håndterer logging via useEffect og sikrer, at kun Stines aktivitet bliver logget uanset hvilken bruger der er logget ind.

Flyttet logningskaldet ud af layout.tsx og ind i ClientLayout for at undgå hydration-fejl og holde kodebasen ren.

ClientLayout wrappes rundt om main-content i layout.tsx.

Ændringer i UserContext:

UserContext i /context/UserContext.tsx er opdateret:

Bruger-id, display_name, partner_id m.m. hentes nu direkte fra Supabase-profilen.

Der bruges nu en mere robust useEffect og lytter til auth-state-changes for at sikre, at brugerinfo altid er opdateret i hele appen.

UserContext anvendes på tværs af sider til at levere brugerobjektet til logning, widgets m.m.

Supabase/database:

Oprettet/tilføjet:

Kolonnerne timestamp og created_at i user_activity_log.

Kolonnen email i profiles for nemmere profilopslag.

RPC-funktion get_top_visited_pages til at gruppere og tælle mest besøgte sider.

Fikset problemer med duplikerede/ambiguous feltnavne ved at bruge entydige kolonneopslag og tilføje nødvendige felter.

/settings/activity siden:

Side opdateret så den viser:

Brugerens navn, id, og email.

Seneste logins med klokkeslæt og dato.

Senest besøgte sider, også med klokkeslæt og dato.

Top 10 mest besøgte sider (hentes via ny RPC-funktion i Supabase).

Fejlrettelser & forbedringer
Rettet flere edge-cases og fejlmeddelelser i forbindelse med Supabase-queries og tomme resultater.

Korrigeret brugen af hooks i relation til Client vs Server Components.

Tilføjet fallback til at vise bruger-id hvis display_name mangler.

Alle fejl vises nu konsistent i konsollen for lettere debugging.

Sådan ser det ud i praksis:

Ny fil: /app/ClientLayout.tsx

Opdateret: /context/UserContext.tsx

Opdateret: /lib/logUserActivity.ts

Supabase: Strukturændringer og ny RPC

Ny/udvidet side: /settings/activity



## Changelog – [Dato: 2025-07-09] - part 2 ##
🚀 Overblik
Større refaktorering og opgradering af dashboard-widgets, XP-system, UI, og brugerens fleksibilitet. Fokus på visuel sammenhæng, UX og flere dynamiske muligheder for både Mads og Stine.

1. XP-system: Levels, Progress, Farveskift og Context
XP-context (/context/XpContext.tsx) er udvidet til at inkludere:

Dynamisk level length (kan ændres via settings/admin).

Beregning af XP pr. bruger (altså kun XP på den bruger der er logget ind).

XP-meter (/components/widgets/XpMeter.tsx):

Ny visning: Cirkulær progressbar, der tager hensyn til XP på det aktuelle level.

Level-badge nu placeret øverst til højre, ikke ovenpå cirklen.

Progressfarve ændrer sig: orange → gul → grøn, afhængigt af hvor tæt man er på næste level.

Dynamisk beregning af XP og level med korrekt visning (fixet fejl hvor level count var for højt).

Responsive og større cirkel, så den fylder ud til kanten af boksen på både mobil og desktop.

Visning følger nu design med “XP-meter” overskrift og badge.

2. Widgets: Adgang, Layout og Drag & Drop
Widget-adgang (/app/settings/widgets/page.tsx):

Bruger kan nu enable/disable widgets for hver profil.

Support for ny widget: “Tip til næste level”.

Fastsættelse af rækkefølge, bredde og højde pr. widget.

TODO: Drag & Drop support er foreslået, men ikke implementeret i denne session. (Planlæg evt. integration med dnd-kit).

Widget-layout (/app/settings/widgets/layout.tsx):

Brugeren kan vælge rækkefølge og størrelse på widgets.

Klar til fremtidig drag/drop.

WidgetRenderer er opdateret til at understøtte alle widgets, inkl. specialhåndtering af ChallengeCardWidget.

3. ChallengeCardWidget (Udfordringskort)
Ny styling med badge, mindre font på spørgsmål, og boksen fylder nu ud til samme bredde som XP-meter.

“Du har X dage til at besvare” vises under submit-knappen.

Partnerens svar vises kun når begge har svaret.

Responsive og elegant UI.

Fixet race conditions og blinking/flash ved indlæsning (loading state håndteres rent).

Al logik til XP-log er testet og fejlrettet.

4. LevelTipWidget – Ny Widget: “Tip til næste level”
Split fra XP-meter – tip vises nu i egen widget.

Widget finder automatisk den opgave (fra fantasies, bucketlist, checkin, tasks) som vil bringe brugeren nærmest til næste level.

UI: Farvet badge, større tekst, fed tip-boks med brug af shadow, rounded, gul nuance og icon.

Viser “opgave + XP + hvor meget man mangler til næste level”.

Viser fallback hvis ingen opgaver er mulige at løse.

Tilføjet til widget administration og dashboard, kan tændes/slukkes pr. bruger.

5. Visuelle & Komponentmæssige ændringer
Badges: Badge-komponent nu brugt konsistent i alle widgets og har fået forslag til farvevarianter (badge-success, badge-warning, badge-danger).

Buttons: btn-primary og btn-secondary opdateret i globals.css til at bruge Tailwind-farver og hover/focus states. Lagt op til yderligere udvidelser (fx btn-outline, btn-sm).

Responsivitet: Alle større widgets tilpasser nu layout og størrelse på mobil/desktop.

Code Cleanups: Fjernet gammel kode, tilføjet masser af loading/console-debug (fjern evt. debug før deploy).

6. Settings, Rewards og Level Length
Under “Rewards” kan admin nu definere hvor meget ét level er værd (level length), og dette ændrer sig live i XP-context.

Data-strukturen for rewards er udvidet så gave kan tildeles en bestemt bruger og XP-mål pr. gave.

Sikret at XP altid kun vises for den pågældende bruger.

7. Fejlrettelser
Level count: Level starter nu korrekt ved 1, og man rykker kun op når XP overstiger (level * levelLength).

XP-meter beregner progress korrekt baseret på nuværende level, ikke total XP.

Race conditions på visning af partnerens svar i ChallengeCardWidget håndteres bedre.

Fejlrettet: Nogle widgets forsvandt fra brugerens dashboard selvom de var enabled – supporteretWidgets array skal altid indeholde alle nøgler fra admin.

XP-log, xp_settings og rewards loader nu kun for den aktuelle bruger og rolle.

8. Refaktorering & Optimering
Alt XP-logik ud i context.

Beregning og suggestions til opgaver til næste level isoleret til LevelTipWidget.

Forberedt til yderligere modulopdeling og dnd-kit (drag & drop).

Brug af useCallback, useEffect cleanups og loading-states for hurtigere feel.

Test & TODO
Test at alle widgets vises/skjules korrekt ved ændring i settings (adgang og layout).

Test at XP for både Mads og Stine vises korrekt og følger individets handlinger.

Test at tip til næste level altid foreslår en reel opgave og ikke over/undervurderer XP.

Test visning/validering af badges og buttons på tværs af hele platformen.

TEST drag/drop prototype for widget-layout.

TEST edge cases hvor brugeren får XP fra flere opgaver på én gang.

Opsummering
En stor omgang, hvor især dashboardets visuelle udtryk og den gamificerede oplevelse er opgraderet, XP/level-logik er blevet robust og widgets nu styres og tilpasses helt fra settings/admin.

## Changelog – [Dato: 2025-07-09] ##
Nyt: Udfordringskort med gamification
Widget: Ny Udfordringskort-widget tilføjet på dashboard. Viser automatisk et nyt spørgsmål hver 14. dag, som begge parter skal besvare for at optjene XP.

Databasemodel:

Tilføjet tabel challenge_cards med kolonnerne id, title, question, category, active_from, active_to.

Tilføjet tabel challenge_answers til at gemme brugersvar, XP m.m.

Besvarelser & XP:

Point-system indført: Svar på kortet udløser XP. Mulighed for ekstra XP ved særligt ærlige eller hurtige svar.

Gamification & UX:

Badge-system og streaks: Brugere kan opnå badges for fx “5 svar i træk” eller “sårbarheds-mester”.

Progressbar: Visning af hvor mange kort, der er besvaret.

Automatisk “lås op for partnerens svar”, når begge har svaret på kortet.

Påmindelser/nudges, hvis man ikke har svaret inden for få dage.

Mulighed for anonym refleksion (privat svar).

Arkiv/historik over tidligere kort og besvarelser.

Admin:

Challenge cards kan nu administreres fra backend – med titel, spørgsmål, kategori og aktiv periode.

Cron-job eller scheduled function planlægges til at aktivere nyt kort hver 14. dag.

UI
Widget vises på dashboard.

Modal/side til besvarelse med XP-animation, feedback og badge-fejring.

“Afventer partner”-status indtil begge har svaret.

Historik-side (eller sektion på profil) med overblik over gamle svar og XP.

Note:

Husk at opdatere seed-data i challenge_cards med de nye spørgsmål inkl. titel.

Husk at synkronisere widgets under /settings/widgets og layout under /settings/widgets/layout med den nye widget.

## Changelog – [Dato: 2025-07-08]##

Tilføjet
Ny responsiv kalenderfunktion:

Kalenderen viser nu “Google Calendar”-lignende grid på desktop og Apple-lignende dagsliste på mobil.

Begivenheder kan tilføjes med enkeltklik/tap på dato – ikke længere dobbeltklik.

Kalenderen er opdelt i separate komponenter:

SharedCalendar.tsx: Wrapper, der automatisk vælger mobil- eller desktop-visning.

BigCalendarView.tsx: Desktop grid med react-big-calendar.

MobileCalendarView.tsx: Mobilvisning med react-calendar og dagsliste.

Dummy-events indtil integration med Supabase.

Ændret
Koden til kalenderen er nu delt op i separate komponenter i /components/calendar/

Bedre overblik, genbrug og vedligeholdelse.

Alle imports/exports er nu konsistente (named exports).

Rettet
Fejl med import/eksport er rettet – alle filer bruger nu enten named eller default eksport, så der ikke opstår importfejl i Next.js.

Date-fns imports bruger nu korrekt curly-brace-syntax.

Fjernet
Dobbeltklik som oprettelsesmetode på events er fjernet – nu kun enkeltklik/tap.

Kort opsummering
Hele kalenderfunktionen er nu responsiv, mere mobilvenlig, opdelt i rene komponenter og klar til videreudvikling med database-integration og custom UI.


## Sidste opdateret: 2025-07-07 ##

Nye funktioner og større ændringer
Sexstillinger univers:
Ny inspirationsside for sexstillinger på /sex/positions.

CRUD:
Opret, redigér, og slet sexstillinger via modal (inkl. billedupload).

Kategorier og familier:

Dynamisk mulighed for at vælge eller oprette kategori og familie for hver stilling.

Begge vælges i modal, vises som badges på cards.

Tags:

Opret og vælg flere tags pr. stilling.

Tags kan vælges fra eksisterende eller oprettes direkte i modal.

Tags vises i modal (ikke på card).

Effort/Sværhedsgrad:

Dropdown i modal: Let / Middel / Svær.

Hver effort-type tildeles XP dynamisk.

XP-opsætning kan redigeres under /settings/points via Supabase.

XP-badge:

Nyt badge på hvert card og i modal, der viser XP-optjening for effort.

XP hentes fra xp_settings hvor role = 'common' og action = 'sex_position'.

Status:

Ny, Prøvet, Afvist vælges i modal.

Status vises som badge på card og i modal.

Tried count:

Hvis “Prøvet” vælges, kan antal gange angives.

Vises som badge på card og i modal.

Pagination:

Maks. 12 stillinger pr. side.

Sidevælger vises under cards.

Antal-stillinger:

Tekst i toppen: “Der er X stillinger til inspiration”.

Filterbar (desktop):

Kategori, familie og tags kan vælges som multi-chips (flere på én gang).

Filter påvirker cards live.

Mobilfilter:

“Filtrer”-knap åbner drawer med samme muligheder (kategori/familie/tags).

Resultattal vises før man trykker "Vis resultater".

Design:

Cards har flere badges, bedre padding, ens font, ikon på badges, og mere mobilvenligt layout.

Sidebar/menu:

Nyt hovedpunkt “Intimitet” med “Fantasier” og “Sex inspiration” (positions).

Parforhold-menuen viser nu ikke Fantasier og Sex inspiration.

Sidebar opdateret så hovedpunkter med underpunkter ikke længere kan klikkes direkte.

Databasetabeller og felter
sex_positions

Felter: id, name, image_url, description, status, tried_count, category_id, effort, family_id

sex_position_categories

Felter: id, name

sex_position_families

Felter: id, name

sex_position_tags

Felter: id, name

sex_position_tag_links

Felter: sex_position_id, tag_id

xp_settings

Felter: id, role, action, effort, xp

Relevant opsætning:

role = 'common'

action = 'sex_position'

effort = 'let' | 'middel' | 'svær'

XP kan sættes i /settings/points

Komponenter
/components/ui/badge.tsx
Genanvendt til alle badges (kategori, familie, status, effort, tags).
/components/ui/XpBadge.tsx

Nyt XP-badge på kort og i modal – modtager xp og viser badge. Dette punkt virker ikke, og det er det vi skal arbejde på i næste gpt session.

## 2025-07-06 ##
Implementeret ny struktur for changelog med månedlige filer i /changelog/-mappen for at sikre bedre overblik og undgå for stor README-fil.

Aftalt workflow for vedhæftning ved nye sessioner: altid seneste README.md + aktuel måneds changelog-fil.

Fastsat klare retningslinjer for, hvordan opdateringer dokumenteres:

README indeholder overordnet projektbeskrivelse, arkitektur og mappestruktur.

/changelog/changelog-ÅÅÅÅ-MM.md indeholder detaljerede ugentlige/dagslogs.

Retableret fungerende layout og styling uden global padding på .card i globals.css. Padding håndteres nu lokalt i komponenterne.

Sikret, at drag-and-drop i FantasyBoard og modaler fungerer uden stylingkonflikter.

Checkin-systemet er implementeret med ugentlige behov, modpartsevaluering og XP-tildeling baseret på evalueringsstatus.

Opdateret XP-systemet til at hente point fra xp_settings med korrekt rolle- og effort-afhængighed.

Dokumenteret database-struktur og flow for fantasier, XP, gaver og adgangskontrol.

## Seneste opdateringer (2025-07-06) ##

1. Sexstillinger / Inspirationsunivers
Vi har oprettet en side /sex/positions som fungerer som et inspirationsunivers for sexstillinger.

Siden viser alle stillinger som kort, inkl. billede, beskrivelse, status ("ny", "prøvet", "afvist") og hvor mange gange den er prøvet (tried_count).

Modal til visning og redigering af hver stilling.

Mulighed for at oprette nye stillinger, inkl. upload af billede til Supabase Storage (bucket: sex-positions-images).

Mulighed for at redigere eksisterende stillinger samt slette dem.

Al upload og læsning styres af RLS policies: (auth.role() = 'authenticated') AND (bucket_id = 'sex-positions-images') for alle fire rettigheder.

2. Check-in side /indtjekning/sex
Stilling-data på check-in siden trækkes nu direkte fra sex_positions-tabellen.

Der vises autocomplete-søgning for stillinger samt chips for de 10 mest brugte.

Mulighed for at tilføje ny stilling direkte fra check-in.

Hver stilling kan nu have billede, og antal gange den er brugt vises (hvis feltet er >0).

Fejl med manglende felter i tabellen løst ved at sikre at både tried_count og image_url findes.

3. Database / Supabase
sex_positions-tabellen er udvidet med kolonnerne:

image_url (text, nullable)

description (text, nullable)

status (text, nullable – enum-lignende: 'ny', 'prøvet', 'afvist')

tried_count (integer, default 0)

Storage bucket sex-positions-images oprettet med policies for authenticated access.

Policies for storage select, insert, update og delete sat ens.

4. Rettelser og fejlretning
Sikret at kode til både /indtjekning/sex og /sex/positions aldrig strippes, men leveres komplet.

Fejl omkring properties som ikke findes (f.eks. tried_count) er løst ved at sikre korrekt supabase select og types.

Alle visuelle og funktionelle ønsker til UI på begge sider indført, inkl. kortvisning og modal.

Næste skridt
Videreudvikling på /sex/positions

Mulighed for at filtrere/udvælge stillinger baseret på status, tags eller hyppighed.

Mulighed for at afvise stillinger eller markere dem som prøvet X gange direkte fra inspirationsuniverset.

Integrere gamification/XP med brug af stillinger.

Forbedre billedhåndtering, evt. støtte for flere billeder pr. stilling.

Evt. kobling direkte fra inspirationsunivers til check-in (vælg fra inspirationsunivers ved registrering).

## Opdatering 2025-07-04 ##

Bucketlist – Redigering og sletning af delmål (timeline)
Nyt:
Det er nu muligt at redigere og slette delmål (subgoals) direkte i timeline-visningen på Bucketlist for Par.

Hver delmål har nu to knapper:

Rediger: Mulighed for at rette titel, deadline og ansvarlig direkte inline på listen. Ændringer gemmes til Supabase.

Slet: Giver bekræftelse før sletning. Sletning opdaterer også Supabase og UI.

Teknisk
BucketContext er udvidet med updateSubgoal og deleteSubgoal metoder.

BucketTimeline.tsx bruger disse metoder til at håndtere redigering/sletning, med tilstandsstyring for aktiv redigering/sletning per subgoal.

Mulighed for at annullere ændringer eller fortryde sletning.

UI/UX
Knappen “Rediger” åbner inputfelter direkte på delmålet.

Slet-knappen viser bekræftelsesfelt inden endelig handling.

Intet af den eksisterende kode til tilføjelse/check af delmål er ændret.

Alt er mobilvenligt og følger det eksisterende card-design.

Øvrige forbedringer
Badge-designet på BucketCard bruger nu global Badge-komponent fra /components/ui/badge.tsx til både kategori, ansvarlig og deadline.

Progressbar og spacing på kort er tilpasset for et mere rent og moderne look.

Database

Ingen ændringer i tabelstruktur – alle ændringer sker på data i feltet goals i bucketlist_couple.

## Opdatering 2. juli 2025 ##

Bucketlist-couple:
Projektet har fået opdateret arkitekturen omkring bucket-funktionalitet, så Next.js-kompatibilitet sikres, og alle React/context-fejl fjernes.

Overblik over ændringer:

Opdeling af context og side:

Context-provider (BucketProvider + useBucket) ligger nu i /context/BucketContext.tsx med "use client" i toppen.

/app/bucketlist-couple/page.tsx indeholder kun rendering/visning og bruger altid export default function ....

Ingen context eller createContext i page.tsx – alle Next.js “default export is not a React Component”-fejl løst.

Tilføjelser og rettelser:

Al bucket CRUD håndteres via addBucket, updateBucket, mm., med imageUrl som URL-streng (ikke filobjekt).

Brug af Supabase opdateret til at arbejde mod tabellen bucketlist_couple.

Underkomponenter (BucketlistCoupleContent) anbefales til visning og formularer.

Koden er nu robust over for Next.js 13/14/15 app-router regler.

Fejl omkring “createContext” og hooks løst via tydelig “use client”-adskillelse.

Fejlhåndtering og debug:

Alle typiske build-fejl og import/eksport-problemer beskrevet og håndteret.

Der er indført stricte regler for, hvordan context importeres/bruges i projektet.





