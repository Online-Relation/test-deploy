## Changelog ‚Äì [Dato: 2025-07-09] - part 2 ##
üöÄ Overblik
St√∏rre refaktorering og opgradering af dashboard-widgets, XP-system, UI, og brugerens fleksibilitet. Fokus p√• visuel sammenh√¶ng, UX og flere dynamiske muligheder for b√•de Mads og Stine.

1. XP-system: Levels, Progress, Farveskift og Context
XP-context (/context/XpContext.tsx) er udvidet til at inkludere:

Dynamisk level length (kan √¶ndres via settings/admin).

Beregning af XP pr. bruger (alts√• kun XP p√• den bruger der er logget ind).

XP-meter (/components/widgets/XpMeter.tsx):

Ny visning: Cirkul√¶r progressbar, der tager hensyn til XP p√• det aktuelle level.

Level-badge nu placeret √∏verst til h√∏jre, ikke ovenp√• cirklen.

Progressfarve √¶ndrer sig: orange ‚Üí gul ‚Üí gr√∏n, afh√¶ngigt af hvor t√¶t man er p√• n√¶ste level.

Dynamisk beregning af XP og level med korrekt visning (fixet fejl hvor level count var for h√∏jt).

Responsive og st√∏rre cirkel, s√• den fylder ud til kanten af boksen p√• b√•de mobil og desktop.

Visning f√∏lger nu design med ‚ÄúXP-meter‚Äù overskrift og badge.

2. Widgets: Adgang, Layout og Drag & Drop
Widget-adgang (/app/settings/widgets/page.tsx):

Bruger kan nu enable/disable widgets for hver profil.

Support for ny widget: ‚ÄúTip til n√¶ste level‚Äù.

Fasts√¶ttelse af r√¶kkef√∏lge, bredde og h√∏jde pr. widget.

TODO: Drag & Drop support er foresl√•et, men ikke implementeret i denne session. (Planl√¶g evt. integration med dnd-kit).

Widget-layout (/app/settings/widgets/layout.tsx):

Brugeren kan v√¶lge r√¶kkef√∏lge og st√∏rrelse p√• widgets.

Klar til fremtidig drag/drop.

WidgetRenderer er opdateret til at underst√∏tte alle widgets, inkl. specialh√•ndtering af ChallengeCardWidget.

3. ChallengeCardWidget (Udfordringskort)
Ny styling med badge, mindre font p√• sp√∏rgsm√•l, og boksen fylder nu ud til samme bredde som XP-meter.

‚ÄúDu har X dage til at besvare‚Äù vises under submit-knappen.

Partnerens svar vises kun n√•r begge har svaret.

Responsive og elegant UI.

Fixet race conditions og blinking/flash ved indl√¶sning (loading state h√•ndteres rent).

Al logik til XP-log er testet og fejlrettet.

4. LevelTipWidget ‚Äì Ny Widget: ‚ÄúTip til n√¶ste level‚Äù
Split fra XP-meter ‚Äì tip vises nu i egen widget.

Widget finder automatisk den opgave (fra fantasies, bucketlist, checkin, tasks) som vil bringe brugeren n√¶rmest til n√¶ste level.

UI: Farvet badge, st√∏rre tekst, fed tip-boks med brug af shadow, rounded, gul nuance og icon.

Viser ‚Äúopgave + XP + hvor meget man mangler til n√¶ste level‚Äù.

Viser fallback hvis ingen opgaver er mulige at l√∏se.

Tilf√∏jet til widget administration og dashboard, kan t√¶ndes/slukkes pr. bruger.

5. Visuelle & Komponentm√¶ssige √¶ndringer
Badges: Badge-komponent nu brugt konsistent i alle widgets og har f√•et forslag til farvevarianter (badge-success, badge-warning, badge-danger).

Buttons: btn-primary og btn-secondary opdateret i globals.css til at bruge Tailwind-farver og hover/focus states. Lagt op til yderligere udvidelser (fx btn-outline, btn-sm).

Responsivitet: Alle st√∏rre widgets tilpasser nu layout og st√∏rrelse p√• mobil/desktop.

Code Cleanups: Fjernet gammel kode, tilf√∏jet masser af loading/console-debug (fjern evt. debug f√∏r deploy).

6. Settings, Rewards og Level Length
Under ‚ÄúRewards‚Äù kan admin nu definere hvor meget √©t level er v√¶rd (level length), og dette √¶ndrer sig live i XP-context.

Data-strukturen for rewards er udvidet s√• gave kan tildeles en bestemt bruger og XP-m√•l pr. gave.

Sikret at XP altid kun vises for den p√•g√¶ldende bruger.

7. Fejlrettelser
Level count: Level starter nu korrekt ved 1, og man rykker kun op n√•r XP overstiger (level * levelLength).

XP-meter beregner progress korrekt baseret p√• nuv√¶rende level, ikke total XP.

Race conditions p√• visning af partnerens svar i ChallengeCardWidget h√•ndteres bedre.

Fejlrettet: Nogle widgets forsvandt fra brugerens dashboard selvom de var enabled ‚Äì supporteretWidgets array skal altid indeholde alle n√∏gler fra admin.

XP-log, xp_settings og rewards loader nu kun for den aktuelle bruger og rolle.

8. Refaktorering & Optimering
Alt XP-logik ud i context.

Beregning og suggestions til opgaver til n√¶ste level isoleret til LevelTipWidget.

Forberedt til yderligere modulopdeling og dnd-kit (drag & drop).

Brug af useCallback, useEffect cleanups og loading-states for hurtigere feel.

Test & TODO
Test at alle widgets vises/skjules korrekt ved √¶ndring i settings (adgang og layout).

Test at XP for b√•de Mads og Stine vises korrekt og f√∏lger individets handlinger.

Test at tip til n√¶ste level altid foresl√•r en reel opgave og ikke over/undervurderer XP.

Test visning/validering af badges og buttons p√• tv√¶rs af hele platformen.

TEST drag/drop prototype for widget-layout.

TEST edge cases hvor brugeren f√•r XP fra flere opgaver p√• √©n gang.

Opsummering
En stor omgang, hvor is√¶r dashboardets visuelle udtryk og den gamificerede oplevelse er opgraderet, XP/level-logik er blevet robust og widgets nu styres og tilpasses helt fra settings/admin.

## Changelog ‚Äì [Dato: 2025-07-09] ##
Nyt: Udfordringskort med gamification
Widget: Ny Udfordringskort-widget tilf√∏jet p√• dashboard. Viser automatisk et nyt sp√∏rgsm√•l hver 14. dag, som begge parter skal besvare for at optjene XP.

Databasemodel:

Tilf√∏jet tabel challenge_cards med kolonnerne id, title, question, category, active_from, active_to.

Tilf√∏jet tabel challenge_answers til at gemme brugersvar, XP m.m.

Besvarelser & XP:

Point-system indf√∏rt: Svar p√• kortet udl√∏ser XP. Mulighed for ekstra XP ved s√¶rligt √¶rlige eller hurtige svar.

Gamification & UX:

Badge-system og streaks: Brugere kan opn√• badges for fx ‚Äú5 svar i tr√¶k‚Äù eller ‚Äús√•rbarheds-mester‚Äù.

Progressbar: Visning af hvor mange kort, der er besvaret.

Automatisk ‚Äúl√•s op for partnerens svar‚Äù, n√•r begge har svaret p√• kortet.

P√•mindelser/nudges, hvis man ikke har svaret inden for f√• dage.

Mulighed for anonym refleksion (privat svar).

Arkiv/historik over tidligere kort og besvarelser.

Admin:

Challenge cards kan nu administreres fra backend ‚Äì med titel, sp√∏rgsm√•l, kategori og aktiv periode.

Cron-job eller scheduled function planl√¶gges til at aktivere nyt kort hver 14. dag.

UI
Widget vises p√• dashboard.

Modal/side til besvarelse med XP-animation, feedback og badge-fejring.

‚ÄúAfventer partner‚Äù-status indtil begge har svaret.

Historik-side (eller sektion p√• profil) med overblik over gamle svar og XP.

Note:

Husk at opdatere seed-data i challenge_cards med de nye sp√∏rgsm√•l inkl. titel.

Husk at synkronisere widgets under /settings/widgets og layout under /settings/widgets/layout med den nye widget.

## Changelog ‚Äì [Dato: 2025-07-08]##

Tilf√∏jet
Ny responsiv kalenderfunktion:

Kalenderen viser nu ‚ÄúGoogle Calendar‚Äù-lignende grid p√• desktop og Apple-lignende dagsliste p√• mobil.

Begivenheder kan tilf√∏jes med enkeltklik/tap p√• dato ‚Äì ikke l√¶ngere dobbeltklik.

Kalenderen er opdelt i separate komponenter:

SharedCalendar.tsx: Wrapper, der automatisk v√¶lger mobil- eller desktop-visning.

BigCalendarView.tsx: Desktop grid med react-big-calendar.

MobileCalendarView.tsx: Mobilvisning med react-calendar og dagsliste.

Dummy-events indtil integration med Supabase.

√Ündret
Koden til kalenderen er nu delt op i separate komponenter i /components/calendar/

Bedre overblik, genbrug og vedligeholdelse.

Alle imports/exports er nu konsistente (named exports).

Rettet
Fejl med import/eksport er rettet ‚Äì alle filer bruger nu enten named eller default eksport, s√• der ikke opst√•r importfejl i Next.js.

Date-fns imports bruger nu korrekt curly-brace-syntax.

Fjernet
Dobbeltklik som oprettelsesmetode p√• events er fjernet ‚Äì nu kun enkeltklik/tap.

Kort opsummering
Hele kalenderfunktionen er nu responsiv, mere mobilvenlig, opdelt i rene komponenter og klar til videreudvikling med database-integration og custom UI.


## Sidste opdateret: 2025-07-07 ##

Nye funktioner og st√∏rre √¶ndringer
Sexstillinger univers:
Ny inspirationsside for sexstillinger p√• /sex/positions.

CRUD:
Opret, redig√©r, og slet sexstillinger via modal (inkl. billedupload).

Kategorier og familier:

Dynamisk mulighed for at v√¶lge eller oprette kategori og familie for hver stilling.

Begge v√¶lges i modal, vises som badges p√• cards.

Tags:

Opret og v√¶lg flere tags pr. stilling.

Tags kan v√¶lges fra eksisterende eller oprettes direkte i modal.

Tags vises i modal (ikke p√• card).

Effort/Sv√¶rhedsgrad:

Dropdown i modal: Let / Middel / Sv√¶r.

Hver effort-type tildeles XP dynamisk.

XP-ops√¶tning kan redigeres under /settings/points via Supabase.

XP-badge:

Nyt badge p√• hvert card og i modal, der viser XP-optjening for effort.

XP hentes fra xp_settings hvor role = 'common' og action = 'sex_position'.

Status:

Ny, Pr√∏vet, Afvist v√¶lges i modal.

Status vises som badge p√• card og i modal.

Tried count:

Hvis ‚ÄúPr√∏vet‚Äù v√¶lges, kan antal gange angives.

Vises som badge p√• card og i modal.

Pagination:

Maks. 12 stillinger pr. side.

Sidev√¶lger vises under cards.

Antal-stillinger:

Tekst i toppen: ‚ÄúDer er X stillinger til inspiration‚Äù.

Filterbar (desktop):

Kategori, familie og tags kan v√¶lges som multi-chips (flere p√• √©n gang).

Filter p√•virker cards live.

Mobilfilter:

‚ÄúFiltrer‚Äù-knap √•bner drawer med samme muligheder (kategori/familie/tags).

Resultattal vises f√∏r man trykker "Vis resultater".

Design:

Cards har flere badges, bedre padding, ens font, ikon p√• badges, og mere mobilvenligt layout.

Sidebar/menu:

Nyt hovedpunkt ‚ÄúIntimitet‚Äù med ‚ÄúFantasier‚Äù og ‚ÄúSex inspiration‚Äù (positions).

Parforhold-menuen viser nu ikke Fantasier og Sex inspiration.

Sidebar opdateret s√• hovedpunkter med underpunkter ikke l√¶ngere kan klikkes direkte.

Databasetabeller og felter
sex_positions

Felter: id, name, image_url, description, status, tried_count, category_id, effort, family_id

sex_position_categories

Felter: id, name

sex_position_families

Felter: id, name

sex_position_tags

Felter: id, name

sex_position_tag_links

Felter: sex_position_id, tag_id

xp_settings

Felter: id, role, action, effort, xp

Relevant ops√¶tning:

role = 'common'

action = 'sex_position'

effort = 'let' | 'middel' | 'sv√¶r'

XP kan s√¶ttes i /settings/points

Komponenter
/components/ui/badge.tsx
Genanvendt til alle badges (kategori, familie, status, effort, tags).
/components/ui/XpBadge.tsx

Nyt XP-badge p√• kort og i modal ‚Äì modtager xp og viser badge. Dette punkt virker ikke, og det er det vi skal arbejde p√• i n√¶ste gpt session.

## 2025-07-06 ##
Implementeret ny struktur for changelog med m√•nedlige filer i /changelog/-mappen for at sikre bedre overblik og undg√• for stor README-fil.

Aftalt workflow for vedh√¶ftning ved nye sessioner: altid seneste README.md + aktuel m√•neds changelog-fil.

Fastsat klare retningslinjer for, hvordan opdateringer dokumenteres:

README indeholder overordnet projektbeskrivelse, arkitektur og mappestruktur.

/changelog/changelog-√Ö√Ö√Ö√Ö-MM.md indeholder detaljerede ugentlige/dagslogs.

Retableret fungerende layout og styling uden global padding p√• .card i globals.css. Padding h√•ndteres nu lokalt i komponenterne.

Sikret, at drag-and-drop i FantasyBoard og modaler fungerer uden stylingkonflikter.

Checkin-systemet er implementeret med ugentlige behov, modpartsevaluering og XP-tildeling baseret p√• evalueringsstatus.

Opdateret XP-systemet til at hente point fra xp_settings med korrekt rolle- og effort-afh√¶ngighed.

Dokumenteret database-struktur og flow for fantasier, XP, gaver og adgangskontrol.

## Seneste opdateringer (2025-07-06) ##

1. Sexstillinger / Inspirationsunivers
Vi har oprettet en side /sex/positions som fungerer som et inspirationsunivers for sexstillinger.

Siden viser alle stillinger som kort, inkl. billede, beskrivelse, status ("ny", "pr√∏vet", "afvist") og hvor mange gange den er pr√∏vet (tried_count).

Modal til visning og redigering af hver stilling.

Mulighed for at oprette nye stillinger, inkl. upload af billede til Supabase Storage (bucket: sex-positions-images).

Mulighed for at redigere eksisterende stillinger samt slette dem.

Al upload og l√¶sning styres af RLS policies: (auth.role() = 'authenticated') AND (bucket_id = 'sex-positions-images') for alle fire rettigheder.

2. Check-in side /indtjekning/sex
Stilling-data p√• check-in siden tr√¶kkes nu direkte fra sex_positions-tabellen.

Der vises autocomplete-s√∏gning for stillinger samt chips for de 10 mest brugte.

Mulighed for at tilf√∏je ny stilling direkte fra check-in.

Hver stilling kan nu have billede, og antal gange den er brugt vises (hvis feltet er >0).

Fejl med manglende felter i tabellen l√∏st ved at sikre at b√•de tried_count og image_url findes.

3. Database / Supabase
sex_positions-tabellen er udvidet med kolonnerne:

image_url (text, nullable)

description (text, nullable)

status (text, nullable ‚Äì enum-lignende: 'ny', 'pr√∏vet', 'afvist')

tried_count (integer, default 0)

Storage bucket sex-positions-images oprettet med policies for authenticated access.

Policies for storage select, insert, update og delete sat ens.

4. Rettelser og fejlretning
Sikret at kode til b√•de /indtjekning/sex og /sex/positions aldrig strippes, men leveres komplet.

Fejl omkring properties som ikke findes (f.eks. tried_count) er l√∏st ved at sikre korrekt supabase select og types.

Alle visuelle og funktionelle √∏nsker til UI p√• begge sider indf√∏rt, inkl. kortvisning og modal.

N√¶ste skridt
Videreudvikling p√• /sex/positions

Mulighed for at filtrere/udv√¶lge stillinger baseret p√• status, tags eller hyppighed.

Mulighed for at afvise stillinger eller markere dem som pr√∏vet X gange direkte fra inspirationsuniverset.

Integrere gamification/XP med brug af stillinger.

Forbedre billedh√•ndtering, evt. st√∏tte for flere billeder pr. stilling.

Evt. kobling direkte fra inspirationsunivers til check-in (v√¶lg fra inspirationsunivers ved registrering).

## Opdatering 2025-07-04 ##

Bucketlist ‚Äì Redigering og sletning af delm√•l (timeline)
Nyt:
Det er nu muligt at redigere og slette delm√•l (subgoals) direkte i timeline-visningen p√• Bucketlist for Par.

Hver delm√•l har nu to knapper:

Rediger: Mulighed for at rette titel, deadline og ansvarlig direkte inline p√• listen. √Ündringer gemmes til Supabase.

Slet: Giver bekr√¶ftelse f√∏r sletning. Sletning opdaterer ogs√• Supabase og UI.

Teknisk
BucketContext er udvidet med updateSubgoal og deleteSubgoal metoder.

BucketTimeline.tsx bruger disse metoder til at h√•ndtere redigering/sletning, med tilstandsstyring for aktiv redigering/sletning per subgoal.

Mulighed for at annullere √¶ndringer eller fortryde sletning.

UI/UX
Knappen ‚ÄúRediger‚Äù √•bner inputfelter direkte p√• delm√•let.

Slet-knappen viser bekr√¶ftelsesfelt inden endelig handling.

Intet af den eksisterende kode til tilf√∏jelse/check af delm√•l er √¶ndret.

Alt er mobilvenligt og f√∏lger det eksisterende card-design.

√òvrige forbedringer
Badge-designet p√• BucketCard bruger nu global Badge-komponent fra /components/ui/badge.tsx til b√•de kategori, ansvarlig og deadline.

Progressbar og spacing p√• kort er tilpasset for et mere rent og moderne look.

Database

Ingen √¶ndringer i tabelstruktur ‚Äì alle √¶ndringer sker p√• data i feltet goals i bucketlist_couple.

## Opdatering 2. juli 2025 ##

Bucketlist-couple:
Projektet har f√•et opdateret arkitekturen omkring bucket-funktionalitet, s√• Next.js-kompatibilitet sikres, og alle React/context-fejl fjernes.

Overblik over √¶ndringer:

Opdeling af context og side:

Context-provider (BucketProvider + useBucket) ligger nu i /context/BucketContext.tsx med "use client" i toppen.

/app/bucketlist-couple/page.tsx indeholder kun rendering/visning og bruger altid export default function ....

Ingen context eller createContext i page.tsx ‚Äì alle Next.js ‚Äúdefault export is not a React Component‚Äù-fejl l√∏st.

Tilf√∏jelser og rettelser:

Al bucket CRUD h√•ndteres via addBucket, updateBucket, mm., med imageUrl som URL-streng (ikke filobjekt).

Brug af Supabase opdateret til at arbejde mod tabellen bucketlist_couple.

Underkomponenter (BucketlistCoupleContent) anbefales til visning og formularer.

Koden er nu robust over for Next.js 13/14/15 app-router regler.

Fejl omkring ‚ÄúcreateContext‚Äù og hooks l√∏st via tydelig ‚Äúuse client‚Äù-adskillelse.

Fejlh√•ndtering og debug:

Alle typiske build-fejl og import/eksport-problemer beskrevet og h√•ndteret.

Der er indf√∏rt stricte regler for, hvordan context importeres/bruges i projektet.





