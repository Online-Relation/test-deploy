## Changelog – [Dato: 2025-07-09] - part 2 ##
🚀 Overblik
Større refaktorering og opgradering af dashboard-widgets, XP-system, UI, og brugerens fleksibilitet. Fokus på visuel sammenhæng, UX og flere dynamiske muligheder for både Mads og Stine.

1. XP-system: Levels, Progress, Farveskift og Context
XP-context (/context/XpContext.tsx) er udvidet til at inkludere:

Dynamisk level length (kan ændres via settings/admin).

Beregning af XP pr. bruger (altså kun XP på den bruger der er logget ind).

XP-meter (/components/widgets/XpMeter.tsx):

Ny visning: Cirkulær progressbar, der tager hensyn til XP på det aktuelle level.

Level-badge nu placeret øverst til højre, ikke ovenpå cirklen.

Progressfarve ændrer sig: orange → gul → grøn, afhængigt af hvor tæt man er på næste level.

Dynamisk beregning af XP og level med korrekt visning (fixet fejl hvor level count var for højt).

Responsive og større cirkel, så den fylder ud til kanten af boksen på både mobil og desktop.

Visning følger nu design med “XP-meter” overskrift og badge.

2. Widgets: Adgang, Layout og Drag & Drop
Widget-adgang (/app/settings/widgets/page.tsx):

Bruger kan nu enable/disable widgets for hver profil.

Support for ny widget: “Tip til næste level”.

Fastsættelse af rækkefølge, bredde og højde pr. widget.

TODO: Drag & Drop support er foreslået, men ikke implementeret i denne session. (Planlæg evt. integration med dnd-kit).

Widget-layout (/app/settings/widgets/layout.tsx):

Brugeren kan vælge rækkefølge og størrelse på widgets.

Klar til fremtidig drag/drop.

WidgetRenderer er opdateret til at understøtte alle widgets, inkl. specialhåndtering af ChallengeCardWidget.

3. ChallengeCardWidget (Udfordringskort)
Ny styling med badge, mindre font på spørgsmål, og boksen fylder nu ud til samme bredde som XP-meter.

“Du har X dage til at besvare” vises under submit-knappen.

Partnerens svar vises kun når begge har svaret.

Responsive og elegant UI.

Fixet race conditions og blinking/flash ved indlæsning (loading state håndteres rent).

Al logik til XP-log er testet og fejlrettet.

4. LevelTipWidget – Ny Widget: “Tip til næste level”
Split fra XP-meter – tip vises nu i egen widget.

Widget finder automatisk den opgave (fra fantasies, bucketlist, checkin, tasks) som vil bringe brugeren nærmest til næste level.

UI: Farvet badge, større tekst, fed tip-boks med brug af shadow, rounded, gul nuance og icon.

Viser “opgave + XP + hvor meget man mangler til næste level”.

Viser fallback hvis ingen opgaver er mulige at løse.

Tilføjet til widget administration og dashboard, kan tændes/slukkes pr. bruger.

5. Visuelle & Komponentmæssige ændringer
Badges: Badge-komponent nu brugt konsistent i alle widgets og har fået forslag til farvevarianter (badge-success, badge-warning, badge-danger).

Buttons: btn-primary og btn-secondary opdateret i globals.css til at bruge Tailwind-farver og hover/focus states. Lagt op til yderligere udvidelser (fx btn-outline, btn-sm).

Responsivitet: Alle større widgets tilpasser nu layout og størrelse på mobil/desktop.

Code Cleanups: Fjernet gammel kode, tilføjet masser af loading/console-debug (fjern evt. debug før deploy).

6. Settings, Rewards og Level Length
Under “Rewards” kan admin nu definere hvor meget ét level er værd (level length), og dette ændrer sig live i XP-context.

Data-strukturen for rewards er udvidet så gave kan tildeles en bestemt bruger og XP-mål pr. gave.

Sikret at XP altid kun vises for den pågældende bruger.

7. Fejlrettelser
Level count: Level starter nu korrekt ved 1, og man rykker kun op når XP overstiger (level * levelLength).

XP-meter beregner progress korrekt baseret på nuværende level, ikke total XP.

Race conditions på visning af partnerens svar i ChallengeCardWidget håndteres bedre.

Fejlrettet: Nogle widgets forsvandt fra brugerens dashboard selvom de var enabled – supporteretWidgets array skal altid indeholde alle nøgler fra admin.

XP-log, xp_settings og rewards loader nu kun for den aktuelle bruger og rolle.

8. Refaktorering & Optimering
Alt XP-logik ud i context.

Beregning og suggestions til opgaver til næste level isoleret til LevelTipWidget.

Forberedt til yderligere modulopdeling og dnd-kit (drag & drop).

Brug af useCallback, useEffect cleanups og loading-states for hurtigere feel.

Test & TODO
Test at alle widgets vises/skjules korrekt ved ændring i settings (adgang og layout).

Test at XP for både Mads og Stine vises korrekt og følger individets handlinger.

Test at tip til næste level altid foreslår en reel opgave og ikke over/undervurderer XP.

Test visning/validering af badges og buttons på tværs af hele platformen.

TEST drag/drop prototype for widget-layout.

TEST edge cases hvor brugeren får XP fra flere opgaver på én gang.

Opsummering
En stor omgang, hvor især dashboardets visuelle udtryk og den gamificerede oplevelse er opgraderet, XP/level-logik er blevet robust og widgets nu styres og tilpasses helt fra settings/admin.

## Changelog – [Dato: 2025-07-09] ##
Nyt: Udfordringskort med gamification
Widget: Ny Udfordringskort-widget tilføjet på dashboard. Viser automatisk et nyt spørgsmål hver 14. dag, som begge parter skal besvare for at optjene XP.

Databasemodel:

Tilføjet tabel challenge_cards med kolonnerne id, title, question, category, active_from, active_to.

Tilføjet tabel challenge_answers til at gemme brugersvar, XP m.m.

Besvarelser & XP:

Point-system indført: Svar på kortet udløser XP. Mulighed for ekstra XP ved særligt ærlige eller hurtige svar.

Gamification & UX:

Badge-system og streaks: Brugere kan opnå badges for fx “5 svar i træk” eller “sårbarheds-mester”.

Progressbar: Visning af hvor mange kort, der er besvaret.

Automatisk “lås op for partnerens svar”, når begge har svaret på kortet.

Påmindelser/nudges, hvis man ikke har svaret inden for få dage.

Mulighed for anonym refleksion (privat svar).

Arkiv/historik over tidligere kort og besvarelser.

Admin:

Challenge cards kan nu administreres fra backend – med titel, spørgsmål, kategori og aktiv periode.

Cron-job eller scheduled function planlægges til at aktivere nyt kort hver 14. dag.

UI
Widget vises på dashboard.

Modal/side til besvarelse med XP-animation, feedback og badge-fejring.

“Afventer partner”-status indtil begge har svaret.

Historik-side (eller sektion på profil) med overblik over gamle svar og XP.

Note:

Husk at opdatere seed-data i challenge_cards med de nye spørgsmål inkl. titel.

Husk at synkronisere widgets under /settings/widgets og layout under /settings/widgets/layout med den nye widget.

## Changelog – [Dato: 2025-07-08]##

Tilføjet
Ny responsiv kalenderfunktion:

Kalenderen viser nu “Google Calendar”-lignende grid på desktop og Apple-lignende dagsliste på mobil.

Begivenheder kan tilføjes med enkeltklik/tap på dato – ikke længere dobbeltklik.

Kalenderen er opdelt i separate komponenter:

SharedCalendar.tsx: Wrapper, der automatisk vælger mobil- eller desktop-visning.

BigCalendarView.tsx: Desktop grid med react-big-calendar.

MobileCalendarView.tsx: Mobilvisning med react-calendar og dagsliste.

Dummy-events indtil integration med Supabase.

Ændret
Koden til kalenderen er nu delt op i separate komponenter i /components/calendar/

Bedre overblik, genbrug og vedligeholdelse.

Alle imports/exports er nu konsistente (named exports).

Rettet
Fejl med import/eksport er rettet – alle filer bruger nu enten named eller default eksport, så der ikke opstår importfejl i Next.js.

Date-fns imports bruger nu korrekt curly-brace-syntax.

Fjernet
Dobbeltklik som oprettelsesmetode på events er fjernet – nu kun enkeltklik/tap.

Kort opsummering
Hele kalenderfunktionen er nu responsiv, mere mobilvenlig, opdelt i rene komponenter og klar til videreudvikling med database-integration og custom UI.


## Sidste opdateret: 2025-07-07 ##

Nye funktioner og større ændringer
Sexstillinger univers:
Ny inspirationsside for sexstillinger på /sex/positions.

CRUD:
Opret, redigér, og slet sexstillinger via modal (inkl. billedupload).

Kategorier og familier:

Dynamisk mulighed for at vælge eller oprette kategori og familie for hver stilling.

Begge vælges i modal, vises som badges på cards.

Tags:

Opret og vælg flere tags pr. stilling.

Tags kan vælges fra eksisterende eller oprettes direkte i modal.

Tags vises i modal (ikke på card).

Effort/Sværhedsgrad:

Dropdown i modal: Let / Middel / Svær.

Hver effort-type tildeles XP dynamisk.

XP-opsætning kan redigeres under /settings/points via Supabase.

XP-badge:

Nyt badge på hvert card og i modal, der viser XP-optjening for effort.

XP hentes fra xp_settings hvor role = 'common' og action = 'sex_position'.

Status:

Ny, Prøvet, Afvist vælges i modal.

Status vises som badge på card og i modal.

Tried count:

Hvis “Prøvet” vælges, kan antal gange angives.

Vises som badge på card og i modal.

Pagination:

Maks. 12 stillinger pr. side.

Sidevælger vises under cards.

Antal-stillinger:

Tekst i toppen: “Der er X stillinger til inspiration”.

Filterbar (desktop):

Kategori, familie og tags kan vælges som multi-chips (flere på én gang).

Filter påvirker cards live.

Mobilfilter:

“Filtrer”-knap åbner drawer med samme muligheder (kategori/familie/tags).

Resultattal vises før man trykker "Vis resultater".

Design:

Cards har flere badges, bedre padding, ens font, ikon på badges, og mere mobilvenligt layout.

Sidebar/menu:

Nyt hovedpunkt “Intimitet” med “Fantasier” og “Sex inspiration” (positions).

Parforhold-menuen viser nu ikke Fantasier og Sex inspiration.

Sidebar opdateret så hovedpunkter med underpunkter ikke længere kan klikkes direkte.

Databasetabeller og felter
sex_positions

Felter: id, name, image_url, description, status, tried_count, category_id, effort, family_id

sex_position_categories

Felter: id, name

sex_position_families

Felter: id, name

sex_position_tags

Felter: id, name

sex_position_tag_links

Felter: sex_position_id, tag_id

xp_settings

Felter: id, role, action, effort, xp

Relevant opsætning:

role = 'common'

action = 'sex_position'

effort = 'let' | 'middel' | 'svær'

XP kan sættes i /settings/points

Komponenter
/components/ui/badge.tsx
Genanvendt til alle badges (kategori, familie, status, effort, tags).
/components/ui/XpBadge.tsx

Nyt XP-badge på kort og i modal – modtager xp og viser badge. Dette punkt virker ikke, og det er det vi skal arbejde på i næste gpt session.

## 2025-07-06 ##
Implementeret ny struktur for changelog med månedlige filer i /changelog/-mappen for at sikre bedre overblik og undgå for stor README-fil.

Aftalt workflow for vedhæftning ved nye sessioner: altid seneste README.md + aktuel måneds changelog-fil.

Fastsat klare retningslinjer for, hvordan opdateringer dokumenteres:

README indeholder overordnet projektbeskrivelse, arkitektur og mappestruktur.

/changelog/changelog-ÅÅÅÅ-MM.md indeholder detaljerede ugentlige/dagslogs.

Retableret fungerende layout og styling uden global padding på .card i globals.css. Padding håndteres nu lokalt i komponenterne.

Sikret, at drag-and-drop i FantasyBoard og modaler fungerer uden stylingkonflikter.

Checkin-systemet er implementeret med ugentlige behov, modpartsevaluering og XP-tildeling baseret på evalueringsstatus.

Opdateret XP-systemet til at hente point fra xp_settings med korrekt rolle- og effort-afhængighed.

Dokumenteret database-struktur og flow for fantasier, XP, gaver og adgangskontrol.

## Seneste opdateringer (2025-07-06) ##

1. Sexstillinger / Inspirationsunivers
Vi har oprettet en side /sex/positions som fungerer som et inspirationsunivers for sexstillinger.

Siden viser alle stillinger som kort, inkl. billede, beskrivelse, status ("ny", "prøvet", "afvist") og hvor mange gange den er prøvet (tried_count).

Modal til visning og redigering af hver stilling.

Mulighed for at oprette nye stillinger, inkl. upload af billede til Supabase Storage (bucket: sex-positions-images).

Mulighed for at redigere eksisterende stillinger samt slette dem.

Al upload og læsning styres af RLS policies: (auth.role() = 'authenticated') AND (bucket_id = 'sex-positions-images') for alle fire rettigheder.

2. Check-in side /indtjekning/sex
Stilling-data på check-in siden trækkes nu direkte fra sex_positions-tabellen.

Der vises autocomplete-søgning for stillinger samt chips for de 10 mest brugte.

Mulighed for at tilføje ny stilling direkte fra check-in.

Hver stilling kan nu have billede, og antal gange den er brugt vises (hvis feltet er >0).

Fejl med manglende felter i tabellen løst ved at sikre at både tried_count og image_url findes.

3. Database / Supabase
sex_positions-tabellen er udvidet med kolonnerne:

image_url (text, nullable)

description (text, nullable)

status (text, nullable – enum-lignende: 'ny', 'prøvet', 'afvist')

tried_count (integer, default 0)

Storage bucket sex-positions-images oprettet med policies for authenticated access.

Policies for storage select, insert, update og delete sat ens.

4. Rettelser og fejlretning
Sikret at kode til både /indtjekning/sex og /sex/positions aldrig strippes, men leveres komplet.

Fejl omkring properties som ikke findes (f.eks. tried_count) er løst ved at sikre korrekt supabase select og types.

Alle visuelle og funktionelle ønsker til UI på begge sider indført, inkl. kortvisning og modal.

Næste skridt
Videreudvikling på /sex/positions

Mulighed for at filtrere/udvælge stillinger baseret på status, tags eller hyppighed.

Mulighed for at afvise stillinger eller markere dem som prøvet X gange direkte fra inspirationsuniverset.

Integrere gamification/XP med brug af stillinger.

Forbedre billedhåndtering, evt. støtte for flere billeder pr. stilling.

Evt. kobling direkte fra inspirationsunivers til check-in (vælg fra inspirationsunivers ved registrering).

## Opdatering 2025-07-04 ##

Bucketlist – Redigering og sletning af delmål (timeline)
Nyt:
Det er nu muligt at redigere og slette delmål (subgoals) direkte i timeline-visningen på Bucketlist for Par.

Hver delmål har nu to knapper:

Rediger: Mulighed for at rette titel, deadline og ansvarlig direkte inline på listen. Ændringer gemmes til Supabase.

Slet: Giver bekræftelse før sletning. Sletning opdaterer også Supabase og UI.

Teknisk
BucketContext er udvidet med updateSubgoal og deleteSubgoal metoder.

BucketTimeline.tsx bruger disse metoder til at håndtere redigering/sletning, med tilstandsstyring for aktiv redigering/sletning per subgoal.

Mulighed for at annullere ændringer eller fortryde sletning.

UI/UX
Knappen “Rediger” åbner inputfelter direkte på delmålet.

Slet-knappen viser bekræftelsesfelt inden endelig handling.

Intet af den eksisterende kode til tilføjelse/check af delmål er ændret.

Alt er mobilvenligt og følger det eksisterende card-design.

Øvrige forbedringer
Badge-designet på BucketCard bruger nu global Badge-komponent fra /components/ui/badge.tsx til både kategori, ansvarlig og deadline.

Progressbar og spacing på kort er tilpasset for et mere rent og moderne look.

Database

Ingen ændringer i tabelstruktur – alle ændringer sker på data i feltet goals i bucketlist_couple.

## Opdatering 2. juli 2025 ##

Bucketlist-couple:
Projektet har fået opdateret arkitekturen omkring bucket-funktionalitet, så Next.js-kompatibilitet sikres, og alle React/context-fejl fjernes.

Overblik over ændringer:

Opdeling af context og side:

Context-provider (BucketProvider + useBucket) ligger nu i /context/BucketContext.tsx med "use client" i toppen.

/app/bucketlist-couple/page.tsx indeholder kun rendering/visning og bruger altid export default function ....

Ingen context eller createContext i page.tsx – alle Next.js “default export is not a React Component”-fejl løst.

Tilføjelser og rettelser:

Al bucket CRUD håndteres via addBucket, updateBucket, mm., med imageUrl som URL-streng (ikke filobjekt).

Brug af Supabase opdateret til at arbejde mod tabellen bucketlist_couple.

Underkomponenter (BucketlistCoupleContent) anbefales til visning og formularer.

Koden er nu robust over for Next.js 13/14/15 app-router regler.

Fejl omkring “createContext” og hooks løst via tydelig “use client”-adskillelse.

Fejlhåndtering og debug:

Alle typiske build-fejl og import/eksport-problemer beskrevet og håndteret.

Der er indført stricte regler for, hvordan context importeres/bruges i projektet.





