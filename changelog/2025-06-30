Udviklingslog d.4/6 - 2025
1. XP-systemet forenklet:

Vi har fjernet feltet xp_cost og bruger nu kun required_xp til at styre, hvornÃ¥r en gave kan indlÃ¸ses.

Det gÃ¸r XP-Ã¸konomien mere overskuelig og minimerer kompleksiteten i bÃ¥de visning og indlÃ¸sning.

2. Oprettelse af gaver:

PÃ¥ siden /settings/rewards kan man nu oprette gaver med fÃ¸lgende felter:

Titel og beskrivelse

XP-krav (required_xp)

Modtager (assigned_to: Mads eller Stine)

Kategori (category: fantasy eller todo)

Type (type: ting, oplevelse eller tjeneste)

Alt gemmes i Supabase, og listen opdateres automatisk efter indsendelse.

3. Dynamisk oprettelse af kategorier og typer:

Vi har lavet en side, hvor man kan tilfÃ¸je og slette bÃ¥de fantasikategorier og fantasityper direkte fra frontend.

Kategorier gemmes i tabellen fantasy_categories, og typer i fantasy_types.

Opdatering d.4/6 - 2025:
README â€“ XP-baseret Dashboard for Par

Dette projekt er et interaktivt React-dashboard bygget med Supabase, hvor to brugere â€“ Mads og Stine â€“ kan optjene og bruge XP-point gennem "fantasier" og gaver. Systemet er designet med fokus pÃ¥ gamification og relationsudvikling.

Funktioner

1. Fantasier

Fantasier kan tilfÃ¸jes af begge brugere.

Har felter som titel, beskrivelse, billede, kategori, effort (Low, Medium, High) og status (idea, planned, fulfilled).

TrÃ¦k-og-slip mellem kolonner med dnd-kit.

XP gives baseret pÃ¥ handling og effort-niveau:

Add fantasy â†’ XP til den der tilfÃ¸jer

Plan fantasy â†’ XP til modparten

Complete fantasy â†’ XP til modparten

XP gemmes i xp_log-tabellen.

Hvis en fantasi slettes, fjernes ogsÃ¥ den tilhÃ¸rende add_fantasy XP-entry fra xp_log.

2. Dashboard / Forside

Viser total XP som cirkeldiagram.

Viser nÃ¦ste gave, som er oprettet til brugeren og ikke er indlÃ¸st endnu.

Knap til at indlÃ¸se gaven (aktiveres nÃ¥r XP er nok).

IndlÃ¸sning trÃ¦kker XP og markerer gaven som "redeemed".

Viser hvor mange fantasier der er klar til opfyldelse og det samlede XP-potentiale.

3. Gaver (Rewards)

Gaver kan oprettes af brugeren via /settings/rewards.

Gaven tildeles til enten Mads eller Stine via assigned_to + user_id.

Har felter: titel, beskrivelse, required_xp, kategori, type.

Gaver vises i en liste over uindlÃ¸ste gaver pÃ¥ siden.

Mulighed for at redigere eller slette gaver.

IndlÃ¸ste gaver vises i bunden.

4. XP-system (Context)

XpContext giver adgang til nuvÃ¦rende XP og funktioner til at hente/opdatere det.

Automatisk opdatering nÃ¥r bruger logger ind eller point tildeles/fratrÃ¦kkes.

Teknologi

React + TypeScript

Supabase (auth, database)

dnd-kit (drag & drop fantasier)

react-circular-progressbar (XP-visualisering)

TailwindCSS til styling

Mappestruktur

app/
  â”œâ”€ dates/
  â”œâ”€ fantasy/
  â”œâ”€ login/
  â”œâ”€ manifestation/
  â”œâ”€ profile/
  â”œâ”€ settings/
  â”œâ”€ todo/
  â”œâ”€ layout.tsx
  â”œâ”€ page.tsx
  â”œâ”€ checkin.tsx

components/
  â”œâ”€ ui/
  â”‚   â”œâ”€ badge.tsx
  â”‚   â”œâ”€ button.tsx
  â”‚   â”œâ”€ card.tsx
  â”‚   â”œâ”€ input.tsx
  â”‚   â”œâ”€ label.tsx
  â”‚   â”œâ”€ modal.tsx
  â”‚   â”œâ”€ progress.tsx
  â”‚   â”œâ”€ RichTextEditor.tsx
  â”‚   â”œâ”€ tabs.tsx
  â”‚   â””â”€ tiptap.css
  â”œâ”€ AppShell.tsx
  â”œâ”€ BucketBoard.tsx
  â”œâ”€ ClientSidebarWrapper.tsx
  â”œâ”€ DateIdeasBoard.tsx
  â”œâ”€ FantasyBoard.tsx
  â”œâ”€ RewardClaim.tsx
  â”œâ”€ SettingsPage.tsx
  â”œâ”€ Sidebar.tsx
  â””â”€ UserStatus.tsx

context/
  â”œâ”€ CategoryContext.tsx
  â”œâ”€ UserContext.tsx
  â””â”€ XpContext.tsx

hooks/
  â””â”€ useHasMounted.ts

lib/
  â”œâ”€ db.ts
  â”œâ”€ getXpSettings.ts
  â”œâ”€ navItems.tsx
  â”œâ”€ supabaseClient.ts
  â””â”€ utils.ts

Database-tabeller

fantasies: Alle fantasier med status og effort

xp_log: Logger alle XP-tildelinger og fratrÃ¦k

xp_settings: OpsÃ¦tning af XP pr. rolle, handling og effort

profiles: Indeholder brugerinfo, rolle og display_name

rewards: Gaver med required XP og redeem-status

gift_categories + fantasy_types: Brugt som dropdown-options til oprettelse

Vigtige regler

XP for fantasier gives kun Ã©n gang pr. handling

XP fjernes automatisk, hvis en fantasien slettes (kun for add_fantasy)

Gaver knyttes til en bestemt bruger og bliver kun synlige for denne

En bruger kan kun indlÃ¸se gave hvis XP >= required_xp

Forfatter

Udviklet i samarbejde med ChatGPT og brugeren, med fokus pÃ¥ at bygge et motiverende og sjovt gamification-system for parforhold.

Videreudvikling

Badges og niveauer

Historik og statistik-visning

Skema over indlÃ¸ste fantasier og prÃ¦mier

Notifikationer og XP-animationer

Mobiloptimering

Klar til overlevering. NÃ¦ste udvikler kan nu sÃ¦tte sig ind i hele systemets struktur, arkitektur og funktioner.

## Check-in system (5 juni 2025)

- Oprettet side: `/checkin` til ugentligt check-in mellem Mads og Stine
- Hver person kan angive op til 3 behov per uge
- Den anden part evaluerer behovene sÃ¸ndag (âœ… Opfyldt, âš–ï¸ Middel, âŒ Ikke opfyldt)
- Point tildeles: âœ… = 30 XP, âš–ï¸ = 20 XP, âŒ = 10 XP â€“ logges i `xp_log`
- Evaluering er kun tilladt pÃ¥ modpartens behov
- Evaluationsknapper vises kun for modparten og fjernes helt for Ã©n selv
- Historik vises opdelt for Mads og Stine, kun for tidligere uger
- Brugerrolle fastlÃ¦gges via `supabase.auth.getSession()`

## DatabaseÃ¦ndringer
- Ny tabel: `checkin`
  - Felter: `id`, `user_id`, `need_text`, `week_number`, `year`, `status`, `xp_awarded`, `evaluator_id`
- Tabel: `xp_log`
  - Nye entries logges med rolle og beskrivelse af evaluering (f.eks. "Check-in behov: fulfilled")

âœ… Check-in funktion (opdatering)
Beskrivelse
Checkin-siden giver Mads og Stine mulighed for at indtaste op til 3 behov hver uge. Den anden part evaluerer behovene, og tildeler XP via knapper med tre vurderingsmuligheder: godkendt, middel, eller ikke godkendt.

Funktioner implementeret
Inputfelter til ugentlige behov for Mads og Stine

Gem-funktion, der indsÃ¦tter behov i checkin-tabellen med status pending

Visning af aktive behov for indevÃ¦rende uge

Evalueringsknapper vises kun for den anden person (ikke ens egne behov)

Ved evaluering:

XP tildeles baseret pÃ¥ handlingstype (trukket fra xp_settings)

En rÃ¦kke tilfÃ¸jes i xp_log tabellen

Status og XP opdateres i checkin-tabellen

Historik vises med farver og point for tidligere evaluerede behov

Alt data vises pr. bruger

Database-tabeller opdateret
xp_settings

TilfÃ¸jet tre handlingstyper til rollen common:

evaluate_fulfilled

evaluate_partial

evaluate_rejected

## Opdatering 5/6 - 2025

âœ… Mads tilfÃ¸jer fantasi â†’ fÃ¥r 1 XP

âœ… Stine fÃ¥r korrekt XP afhÃ¦ngigt af effort ved planlÃ¦gning (idea og planned) og fuldfÃ¸relse (planned â†’ fulfilled)

âœ… Potentielle XP vises korrekt baseret pÃ¥ fantasier og behov

âœ… XP for fantasier lÃ¦ses fra xp_settings afhÃ¦ngigt af rolle, action og effort

âœ… XP for checkins afhÃ¦nger af evaluator_id og handlingstype (evaluate_*)

âœ… Checkins tildeles automatisk til modparten ved oprettelse

âœ… Admin kan redigere XP-vÃ¦rdier pr. handling og effort via /settings/points

ğŸ“¦ Supabase Features Bruges

Auth (login/session)

Realtime disabled

insert, select, update, eq, maybeSingle, in, or

Custom tabeller: xp_log, xp_settings, fantasies, checkin, access_control

RLS er deaktiveret (admin only)

ğŸ“Š DatabaseÃ¦ndringer (opdateret 5. juni 2025)

Tabel xp_settings:

XP pr. rolle (mads, stine) + action (plan_fantasy, evaluate_partial, etc.) + effort (low/medium/high/null)

DobbeltopfÃ¸rte eller forkerte vÃ¦rdier ryddet ud for at sikre korrekt xpMap

Tabel checkin:

TilfÃ¸jet evaluator_id for at kende hvem der skal evaluere behovet

Evaluering foretages kun af modpart

XP for behov beregnes pÃ¥ dashboardet ud fra forventet handlingstype (evaluate_partial_)

Tabel fantasies:

Fantasier kan tilfÃ¸jes af Mads eller Stine

XP gives kun til Stine for plan_fantasy og complete_fantasy

Status bruges til at beregne potentiel XP pÃ¥ forsiden

ğŸ“Œ Logik i dashboardet (page.tsx)

Henter brugerens profil og rolle

Henter relevante fantasier og checkins for begge parter

Henter XP-settings for brugerens rolle

Beregner potentielle point:

Checkin XP = antal pending behov * evaluate_partial_

Fantasy XP:

Hvis rolle = stine:

Alle fantasier i status idea og planned â†’ plan_fantasy_{effort}

Hvis planned og xp_granted !== true â†’ complete_fantasy_{effort}

XP vises som cirkeldiagram + nÃ¦ste gave

IndlÃ¸sning trÃ¦kker XP og markerer reward som redeemed

âœ… Afsluttet

Projektet afspejler nu korrekt gamification-logik:

Rigtig XP-beregning

Tydelig rollefordeling

Korrekt potentielle point pÃ¥ forsiden

Administrerbare XP-indstillinger

Klar til udvidelse med niveauer, statistik og historik

## Dagsrapport d.6/6 - 2025
Hvad vi har lavet i dag
TilbagefÃ¸rt til fungerende version af layout og styling uden global padding (p-6) pÃ¥ .card i globals.css.

Klart skel mellem global styling og lokal padding for cards â€” padding styres nu lokalt i komponenter som FantasyBoard eller Card.

Gennemgang og fastlÃ¦ggelse af farver og tekstfarver i globals.css med CSS-variabler for let global farvestyring.

Justering af tailwind.config.js med farver og typografi som tidligere, uden at pÃ¥virke layoutet.

GenindfÃ¸rt korrekt brug af card-klassen uden global padding i globals.css.

Sikret at padding til cards hÃ¥ndteres via komponenternes egne className og ikke globalt.

BekrÃ¦ftet, at FantasyBoard og Card komponenter nu bruger de rette klasser uden at Ã¸delÃ¦gge layout.

Fjernet forsÃ¸g pÃ¥ global padding i globals.css som gav layoutproblemer.

Enig om, at global styling skal hÃ¥ndtere farver, typografi og rammer, mens spacing/padding hÃ¥ndteres lokalt for fleksibilitet.

Besluttet at tage en pause pÃ¥ dette stadie for at undgÃ¥ yderligere forvirring og Ã¸delÃ¦ggelser.

Database
Ingen Ã¦ndringer i database eller tabeller i denne session.

Implementerede funktioner
Funktionelle drag & drop kort i FantasyBoard med lokal styling.

Modal til oprettelse og redigering fungerer som tidligere, uden globale stylingkonflikter.

Brug af Tailwind CSS variabler til farver og tekst i globale styles.

## Opdateret: 7. juni 2025


Oprettet mapper for Check-in undersider i app/checkin:

app/checkin/oversigt

app/checkin/mine-behov

app/checkin/historik

app/checkin/evaluering

TilfÃ¸jet tilhÃ¸rende sider page.tsx i hver mappe

Opdateret adgangskontrol for de nye undersider i UserContext.tsx og Sidebar.tsx

Opdateret: 6. juni 2025

Added access control integration in UserContext and Sidebar, ensuring per-user menu visibility.

Refactored Sidebar.tsx to use hierarchical accessHierarchy for main and submenus.

Updated UserContext.tsx to reliably fetch profiles and access_control, converting undefined fields to null.

Documented changes under relevant sections for clarity.

Oversigt

Dette projekt er et personligt dashboard til administration af diverse aktiviteter, blandt andet:

Fantasymodulet (Parforhold)

Check-in (ugentlige behov)

To-Do-liste, Date Ideas, Manifestation, Karriere, Bucketlist

IndstillingsÂ­sider til XPâ€‘opsÃ¦tning, Rewards, Kategorier og Adgangskontroller

#### Opdateret: 9. juni 2025
Projektoversigt

Vi har udviklet en ny side /bucketlist-couple i vores Next.js-app, hvor par kan oprette, redigere og fÃ¸lge deres fÃ¦lles bucket list.

NÃ¸glefunktioner

Board- og Timeline-visning

Skift mellem oversigt som grid af kort (Board) og en tidslinje (Timeline).

Bucket CRUD

Opret nye buckets med titel, beskrivelse og kategori.

RedigÃ©r eksisterende buckets og gem Ã¦ndringer.

Kategori-funktionalitet

Dropdown-menu i modal for at vÃ¦lge kategori.

Badge pÃ¥ hvert kort viser kategori-navn.

DelmÃ¥l (Subgoals)

TilfÃ¸j, marker som fÃ¦rdige og track delmÃ¥l pr. bucket.

Billedupload til delmÃ¥l

Upload billede per delmÃ¥l og vis i kortene.

Responsivt design

Grid justeres til mobile, tablet og desktop.

Styling

Globale Tailwind-klasser via globals.css, komponenter med btn, btn-primary osv.

Databaseopdateringer

Vi har oprettet og Ã¦ndret fÃ¸lgende tabeller i Supabase:

bucketlist_couple

TilfÃ¸jede kolonner:

title (text)

description (text)

category (uuid) â†’ fremmednÃ¸gle til bucket_categories.id

goals (jsonb) â†’ array af delmÃ¥l

created_at (timestamptz)

RLS-policies:

SELECT for alle brugere

INSERT for authenticated users

UPDATE for authenticated users

Constraints:

Foreign key category â†’ bucket_categories(id)

(Optionelt) category sat til NOT NULL efter migrering af eksisterende data.

bucket_categories

PrimÃ¦rnÃ¸gle id (uuid)

name (text) â†’ kategori-navn (fx "Rejser", "Parforhold")

Hvad er nÃ¦ste skridt

Fjerne midlertidige default-kategorier, nÃ¥r alle eksisterende buckets er migreret.

Test og QA af billedupload.

Implementere filtrering pr. tidsperiode i Timeline.

TilfÃ¸je bruger-feedback (notifikation ved fÃ¦rdigt delmÃ¥l).

## 2025-06-09

- **BucketContext**: Added support for deadlines on buckets and subgoals, plus subgoal owner assignment; updated state and methods in `context/BucketContext.tsx`.
- **Bucketlist Couple Page** (`app/bucketlist-couple/page.tsx`): Integrated deadline and owner fields in create/edit modal; default view set to Board; fetched `profiles.display_name` for owner dropdown.
- **BucketTimeline** (`components/BucketTimeline.tsx`): Enhanced timeline to show bucket deadlines, subgoal deadlines, and owner avatars (initials); styling aligned with board cards.
- **Database**:
  - `bucketlist_couple`: Added `deadline` column; updated JSON `goals` objects to include `dueDate` and `owner` fields.
  - `profiles`: Utilizing `display_name` for dropdown.
  - `bucket_categories`: unchanged.

## 2025-06-09
Bucketlist: billedupload og redigering
TilfÃ¸jet billedupload til bÃ¥de oprettelse og redigering af mÃ¥l i bucketlist_couple.

Billeder uploades til Supabase Storage under bucket bucket-images.

Den offentlige billed-URL gemmes i feltet image_url pÃ¥ den enkelte bucket.

updateBucket-funktionen i BucketContext er udvidet med imageUrl som parameter.

addBucket og updateBucket hÃ¥ndterer begge nu valgfrit billede og gemmer det korrekt i databasen.

FejlhÃ¥ndtering ved upload er tilfÃ¸jet, og fetchBuckets() kaldes ved success for at sikre UI-opdatering.

## Opdatering 10/6 - 2025 ##

âœ… 
ğŸª£ Bucketlist for Par â€“ Udvidet funktionalitet
Vi har implementeret en komplet bucketlist-funktion til par med fÃ¸lgende features:

Funktionalitet
Brugere (Mads og Stine) kan oprette bucket goals direkte via UI.

Hvert mÃ¥l kan have et billede, en deadline, en beskrivelse og en kategori.

Brugeren kan tilfÃ¸je delmÃ¥l (subgoals) med ejer og eventuel deadline.

DelmÃ¥l kan markeres som fuldfÃ¸rt, og XP tildeles til den ansvarlige â€“ uanset hvem der trykker.

Billeder kan uploades til hvert delmÃ¥l og vises visuelt.

Data gemmes i Supabase i tabellen bucketlist_couple.

Billeder gemmes i Supabase Storage under bucket bucketlist-couple.

UI-komponenter og filer
/app/bucketlist-couple/page.tsx â€“ visning og oprettelse af mÃ¥l og delmÃ¥l.

/context/BucketContext.tsx â€“ styring af buckets, delmÃ¥l, billeder og XP-logik.

/components/BucketCard.tsx â€“ visning af individuelle bucket mÃ¥l.

Dashboard-integration
DelmÃ¥l tÃ¦lles med i det potentielle XP pÃ¥ forsiden.

Dashboardet tjekker mÃ¥l der ikke er fuldfÃ¸rt, og som har nuvÃ¦rende bruger som owner.

XP beregnes dynamisk ud fra xp_settings, baseret pÃ¥ rollen og handlingen complete_subgoal.

ğŸ“Š DatabaseÃ¦ndringer
bucketlist_couple
Nye felter og struktur:

image_url â€“ billede for hovedmÃ¥l (bucket)

goals â€“ array af delmÃ¥l med fÃ¸lgende felter:

id (UUID)

title

done (boolean)

dueDate (valgfri)

owner (user_id fra profiles)

image_url (link til billede)

xp_log
NÃ¥r et delmÃ¥l markeres som done, tilfÃ¸jes en rÃ¦kke til xp_log:

change, description, user_id, role

xp_settings
Handling complete_subgoal skal vÃ¦re defineret for bÃ¥de mads og stine med XP-vÃ¦rdi.

ğŸ“ Supabase Storage
Billeder gemmes i:

bash
KopiÃ©r
Rediger
bucketlist-couple/bucket-images/{bucketId}_{subgoalId}.jpg
Ved upload konverteres filen til en public URL via getPublicUrl().

Public URL indsÃ¦ttes i goals.image_url.

ğŸ§  Ekstra funktioner
XP bliver ikke givet til den som klikker, men til den som er ejer (owner) af delmÃ¥let.

Billeder vises forskelligt afhÃ¦ngigt af profil â€“ men tilgÃ¦ngelige hvis public URL er sat korrekt.

Bug fix: billeder blev tidligere ikke gemt korrekt, fordi image_url ikke blev sendt med i addBucket. Dette er nu lÃ¸st.

## Opdatering 10/6 - 2025 ##
Ny tabel: compliment_logs

Felter: id (UUID), compliment_id (integer, FK â†’ compliments.id), given_date (date), created_at (timestamptz)

Migreret med justeret type pÃ¥ compliment_id for at matche compliments.id (integer)

Udvidelse af sexlife_logs

TilfÃ¸jet kolonner: had_sex (boolean), notes (text), log_date (date), created_at (timestamptz)

Oprettet sexlife_log_tags join-tabel: id, log_id (FK â†’ sexlife_logs.id), tag_id (FK â†’ tags.id), created_at

Ny tabel: tags

Felter: id (UUID), name (text), created_at (timestamptz)

Ny tabel: sexlife_log_tags

Bindetabel til tags: log_id, tag_id (begge UUID)

Ny tabel: wishes

Felter: id (UUID), user_id (UUID, FK â†’ profiles.id), description (text), created_at (timestamptz)

Opdatering af profiles

TilfÃ¸jet kolonne buksedragt (text) til tÃ¸jstÃ¸rrelser

## Opdatering d. 10/6 - 2025 ##
Funktionalitet implementeret
Fantasier â€“ Billeder og tilfÃ¸jelser

Nyt felt hasExtras tilfÃ¸jet i fantasies-tabellen for at markere fantasier med ekstra tilfÃ¸jelser.

extra_images array understÃ¸ttes nu i bÃ¥de database og modal.

Modal har fÃ¥et et nyt felt (checkbox) til at aktivere ekstra upload.

UnderstÃ¸ttelse af multiple image upload, som gemmes i Supabase Storage under fantasies/extras/.

Ved visning i modal:

Hvis extra_images er til stede, vises billedekarusel med pile til at navigere mellem billederne.

Hvis kun image_url findes, vises dette som fallback.

Alle funktioner fra tidligere version (titel, beskrivelse, kategori, effort, redigering, sletning) er bevaret og ikke strippet.

Rettelser og stabilisering
Forhindrede stripning af funktioner i Modal.tsx ved bevidst bevaring af eksisterende funktioner under tilfÃ¸jelse af billedekarusel.

Rollehentning for XP og adgang kontrolleres fortsat via profiles.

Opdatering pr. 2025-06-10
Hvad vi har lavet i denne session
FantasyBoard komponenten

Genoprettet og rettet supabase-import og kald, sÃ¥ alle funktioner nu virker korrekt.

TilfÃ¸jet hÃ¥ndtering af XP, filtrering, kategorier og drag-and-drop (DND-kit).

Rettet bug, sÃ¥ kort kan flyttes korrekt pÃ¥ desktop (drag-and-drop).

Sikret korrekt visning af billeder, beskrivelse og badges pÃ¥ kort.

TilfÃ¸jet visning af oprettelsesdato og planlagt dato pÃ¥ kortene.

Implementeret lÃ¦se- og redigeringsmodal med RichTextEditor og billedupload (inkl. galleri).

Implementeret luk-knap og korrekt hÃ¥ndtering af ekstra billeder i modal.

Mobiltilpasning med dropdown til status (idea, planned, fulfilled).

Rettet hÃ¥ndtering af opdatering og sletning af fantasier via modal.

useFantasyBoardLogic hook

Udvidet data med created_date og planned_date felter.

HÃ¥ndtering af opdatering af datoer ved oprettelse og flytning mellem statusser.

Ryddet op og sikret supabase-kald til fetch, update, delete, og XP-log.

Modal komponenten

GenindfÃ¸rt RichTextEditor til beskrivelse med fuld funktionalitet inkl. formatering.

TilfÃ¸jet understÃ¸ttelse af ekstra billedupload og visning i galleri.

Implementeret luk-knap (krydset Ã¸verst).

Sikret mobilvenlig status-dropdown.

Rydelig visning af badges i modal (kategori, indsats).

DatabaseÃ¦ndringer
fantasies tabellen er udvidet med fÃ¸lgende nye kolonner:

created_date (date) â€” dato for oprettelse af fantasi


Opdatering 2025-06-11
Nye funktioner og rettelser
FantasyBoard forbedringer:

Implementeret dato for oprettelse (created_date) og planlagt dato (planned_date) pÃ¥ fantasier.

Udvidet database og frontend til at hÃ¥ndtere og vise disse datoer.

Rettet fejl ved drag & drop, sÃ¥ statusopdatering sker korrekt pÃ¥ desktop og mobil.

TilfÃ¸jet mobil dropdown til statusÃ¦ndring af fantasier.

Optimeret modal med RichTextEditor i stedet for textarea til beskrivelse.

LÃ¸st issue med ekstra billeder: Galleri vises korrekt i modal og antal billeder vises som badge pÃ¥ kort.

Implementeret luk-kryds i modal og forbedret scroll i modal.

Sexlife-registrering:

Implementeret funktion til at registrere sexlivsdage med tilknyttede tags.

TilfÃ¸jet beregning af gennemsnitligt antal dage med sex pr. uge over de seneste 4 uger.

Rettet fejl i gennemsnitsberegning, sÃ¥ unikke dage tÃ¦lles korrekt per uge.

Opdateret frontend pÃ¥ sex-side til at vise gennemsnitlig sex-dage pr. uge.

Komplimenter:

Genskabt funktionalitet til at hente dagens kompliment fra databasen.

TilfÃ¸jet lokal lagring for at sikre, at dagens kompliment ikke skifter i lÃ¸bet af dagen.

Visualiserer registreringer af komplimenter pr. mÃ¥ned i et sÃ¸jlediagram.

Generelle forbedringer og fejlrettelser:

Fuld integration af Supabase-klient i alle relevante filer for at undgÃ¥ Cannot find name 'supabase'-fejl.

Sikret korrekt opdatering og vedligeholdelse af ekstra billeder i fantasier.

Optimeret hÃ¥ndtering af tilstand i modaler med klar separation mellem visning og redigering.

Fjernet hydration mismatch fejl ved at undgÃ¥ dynamiske vÃ¦rdier i server-side rendering.

Databaseopdateringer
TilfÃ¸jet kolonner i fantasies tabellen:

created_date (DATE)

planned_date (DATE)

TilfÃ¸jet kolonne i compliments tabellen:

created_at (TIMESTAMP WITH TIME ZONE, default now())

TilfÃ¸jet nye records i sexlife_logs tabellen til registrering af sex-dage med dato og tags.

ğŸ›  Opdatering 11. juni 2025
âœ… Opgaveside til par
Ny side: /tasks-couple

Funktioner:

TilfÃ¸j opgave med titel, beskrivelse, deadline og ansvarlig (dropdown: Mads eller Stine)

Visning af aktive og fuldfÃ¸rte opgaver i kort

MarkÃ©r som fuldfÃ¸rt â†’ tildeler XP til den ansvarlige (via xp_settings)

Mulighed for at redigere og slette opgaver

Formular vises nederst og fylder mindre (max-w-md)

Database:

Ny tabel tasks_couple

XP hentes ud fra complete_task entry i xp_settings

Fil: /app/tasks-couple/page.tsx

âš™ï¸ Sidebar opdateret
Nyt menupunkt: â€œOpgaverâ€ (tasks-couple) med ListTodo ikon

â€œSexâ€ under parforhold har nu ikon (Heart)

accessHierarchy og iconMap opdateret tilsvarende

ğŸ” Adgangsside opdateret
/settings/access viser nu hele det opdaterede menuhierarki:

Inkluderer alle punkter fra sidebar, inkl. tasks-couple, fantasy/sex, bucketlist-couple

Alle funktioner til valg, visning og opdatering af adgang er bevaret

Dropdown med brugere og checkboxes per menu entry

Opdatering sker via upsert til access_control

## Opdatering â€“ 2025-06-11 ##
Funktionalitet tilfÃ¸jet i /app/spil/sellerk/page.tsx
Brugerbaseret tracking af brugte kort

NÃ¥r en spiller (Mads eller Stine) trÃ¦kker og fuldfÃ¸rer et kort, gemmes det i truth_dare_log.

Systemet sikrer, at hver spiller skal besvare samme kort, men kort aldrig gentages for en spiller.

usedCardIdsForTurn holder styr pÃ¥ hvilke kort den aktuelle spiller har brugt.

Wildcards hver 20. kort

Et wildcard aktiveres automatisk for hver 20. tur med specialbesked og tvungen valg af type.

Visning af hvor mange kort der er tilbage

Viser hvor mange truth og dare kort den aktive spiller har tilbage inden for det valgte tema.

Antallet opdateres automatisk og vises under profilbilledet for aktiv spiller.

Glidende animation af kort-tilgÃ¦ngelighedsboksen

NÃ¥r turen skifter, vises/hides boksen med glidende animation under profilbillederne.

Forbedret layout og responsivt design

StÃ¸rre profilbilleder (w-24 h-24)

CTA'er (Sandhed, Konsekvens, Jeg fuldfÃ¸rte det) har nu pÃ¦nere animation ved visning.

Mindre afstande mellem komponenter for mobiloptimering.

Temafarver og chips

Nye temaer glow, sol, romantik har fÃ¥et farveindstillinger (baggrund, kortkant, knapfarve).

Aktiv chip vises tydeligere med scale, farvet baggrund og border.

Inaktive chips er lidt nedtonede (opacity-80) og har hover-effekt.

Default chip-funktionalitet

Hvis man spiller med temaet default, vÃ¦lges kort tilfÃ¦ldigt uanset kategori.

Viser samlet antal tilbagevÃ¦rende truth og dare kort i hele databasen for den aktive spiller.

Ã†ndringer i databasen (Supabase)
Ny tabel: truth_dare_log

Kolonner: user_id, card_id

Logger hvilke kort hver spiller har haft, sÃ¥ de ikke fÃ¥r dem igen.

Indhold i truth_dare_cards

+300 kort importeret med category sat til fx "FrÃ¦kkeste".

CSV'er opdateret til at have store begyndelsesbogstaver pÃ¥ kategorier.

Indhold i game_themes

Nye rÃ¦kker tilfÃ¸jet:

glow: gule farver

sol: lysegul/solskin

romantik: lyserÃ¸d/romantisk

âœ… 2025-06-12 â€“ Drag & Drop fejl og opdateringer
Det er lavet i dag:

Vi har gennemgÃ¥et og genindsat hele koden til /app/components/FantasyBoard.tsx uden at fjerne funktioner.

Vi har tilfÃ¸jet sensors med PointerSensor, rectIntersection som collisionDetection, samt DragOverlay og activeFantasyId for at understÃ¸tte korrekt drag state.

handleDragEnd og handleDragStart er blevet korrekt koblet til.

XP-logik og status-opdatering ved drag mellem kolonner virker som forventet.

Vi har tilfÃ¸jet visuel feedback nÃ¥r man trÃ¦kker kort.

Men:

Drag & drop fungerer stadig ikke â€“ kort hopper tilbage til deres oprindelige kolonne, og handleDragEnd kaldes korrekt, men Ã¦ndringer slÃ¥r ikke igennem visuelt.

Vi mistÃ¦nker, at useFantasyBoardLogic ikke opdaterer fantasies hurtigt nok eller korrekt efter statusÃ¦ndring.

Plan fremad:

Tjek om fetchFantasies() bliver kaldt rigtigt efter update.

UndersÃ¸g om setFantasies kaldes, og om state opdateres synligt.

Overvej at anvende sortable fra @dnd-kit/sortable hvis nuvÃ¦rende lÃ¸sning bliver for ustabil.

## âœ… Opdatering: Profilside (2025-06-13) ##
Vi har udvidet og redesignet /app/profile/page.tsx med fokus pÃ¥ visuel lÃ¦kkerhed, personlighed og gamification.

ğŸ¯ Funktioner
Faner (Tabs): TÃ¸jstÃ¸rrelser, Ã˜nskeliste og KÃ¦rlighed

Avatar-upload til Supabase Storage

TÃ¸jstÃ¸rrelser: Formular til bh, trusser, jeans osv.

Ã˜nskeliste: Dynamisk liste der gemmes i wishes-tabellen

KÃ¦rlighedsfanen indeholder:

5 kÃ¦rlighedssprog (dropdowns)

Dopamin-triggers (drag & drop, chips, gemmes i profiles.dopamine_triggers som JSON)

Overraskelser (tekstfelt gemt i profiles.surprise_ideas)

ğŸ§± DatabaseÃ¦ndringer
Tabel: profiles

TilfÃ¸jede kolonner:
love_language_1 text,
love_language_2 text,
love_language_3 text,
love_language_4 text,
love_language_5 text,
dopamine_triggers text,
surprise_ideas text

ğŸ“¦ Supabase Features Bruges
from('profiles').update(...)

Storage: upload af avatar

wishes-insert og delete

JSON-stringifikation og parsing af dopamin-liste

## Opdatering 13/6 - 2025 ##
âœ… Parquizzen integreret som spilfunktion

Ny side: /spil/quizzen

SpÃ¸rgsmÃ¥l hentes dynamisk fra Supabase-tabel couple_quiz_questions (kun aktive)

To svar-knapper: "GÃ¦ttede rigtigt" og "GÃ¦ttede forkert"

NÃ¥r en knap trykkes:

XP logges til xp_log baseret pÃ¥ action quiz_correct eller quiz_wrong og brugerens rolle

NÃ¦ste spÃ¸rgsmÃ¥l vises automatisk

âœ… XP-systemet udvidet med quiz-points

Ny kategori i /settings/points:

Handlingstyper: quiz_correct, quiz_wrong

Kan justeres individuelt for mads og stine

XP tildeles ved hjÃ¦lp af eksisterende XpContext og xp_settings

âœ… Fejlrettelser og forbedringer

TilfÃ¸jet manglende kolonner action og user_id til xp_log

Fejl 400 ved POST til xp_log lÃ¸st

Fjernet global padding-konflikter

XP-opdatering fejlede pga. manglende action-kolonne i schema â€” nu rettet

Spil: Parquizzen

Implementeret XP-feedback med animation:

ğŸ‰ Konfettiregn ved korrekt svar

ğŸ’¥ RÃ¸d eksplosion + shake-effekt ved forkert svar

TilfÃ¸jet hop-animation pÃ¥ point-beskeder via framer-motion

TilfÃ¸jet visning af:

Antal spÃ¸rgsmÃ¥l tilbage til den aktive svarer

Bar-graf med rigtige og forkerte svar for bÃ¥de Mads og Stine

Statistik vises altid for begge par â€“ uanset hvem der har tur

Responsivt layout til mobil og desktop (flex og auto-wrap)

## âœ… Dags dato: 2025-06-14 â€” Opdatering af funktioner, database og struktur ##

ğŸ”§ Nye funktioner
Funktion	Beskrivelse
Anbefalingssider pr. quiz	Dynamisk side under /fantasy/anbefalinger/[quizKey] som viser resultater, grafer og anbefalinger.
ChatGPT-integration	Genererer anbefalinger baseret pÃ¥ jeres svar og baggrundsbeskrivelse.
Visualisering med Chart.js	Doughnut + Bar charts med svarfordeling og enighedsniveau.
Caching af anbefalinger	Anbefalinger gemmes i quiz_meta og genbruges ved reload.
Redigerbar baggrundstekst	Ny side under /settings/couple-background med textarea til personlig historik, som tages med i ChatGPT-prompt.
UI-forbedringer	BlÃ¸dere visning, brug af Card, farvekoder, profilbilleder og tabs til visningstyper.

ğŸ—ƒï¸ Nye tabeller og kolonner i Supabase
Tabelnavn	Kolonner	Beskrivelse
quiz_meta	quiz_key, intro, published, background, recommendations	Indeholder quiz-info, baggrundstekst og genererede anbefalinger.
couple_background (tidligere foreslÃ¥et separat, nu samlet i quiz_meta)	Se ovenfor	Gemmer parrets historie som Ã©n tekst.
quiz_questions	id, question, type, order, quiz_key	SpÃ¸rgsmÃ¥l pr. quiz. Bruges til vurdering af enighed.
quiz_responses	question_id, answer, user_id, quiz_key	Brugersvar som matcher op mod spÃ¸rgsmÃ¥l.
profiles (eksisterende)	id, display_name, avatar_url	Bruges til visning og statistik.
(Ã¦ndring)	access_control	Ingen Ã¦ndringer, men system udvidet med adgang til anbefalingssiden.

ğŸ—‚ï¸ Nye og opdaterede filer
Fil / Mappe	Beskrivelse
/app/fantasy/anbefalinger/[quizKey]/page.tsx	Hovedsiden for visning af quizresultater, grafer og anbefalinger.
/app/api/recommendations/route.ts	Serverless route med POST-request til OpenAI, genererer anbefalinger baseret pÃ¥ svar og baggrund.
/app/settings/couple-background/page.tsx	Ny settings-side til at skrive/redigere baggrundshistorie for parret.
/lib/openaiClient.ts	Wrapper med hardcoded API-nÃ¸gle (provisorisk, bÃ¸r flyttes til .env.local).
/components/ui/textarea.tsx	Simpel Tailwind-baseret Textarea-komponent.
/components/ui/card.tsx	Bruges til at indkapsle visning af spÃ¸rgsmÃ¥l og anbefalinger.
/components/ui/button.tsx	Brugt til tab-visning og navigation.
/fantasy/anbefalinger/page.tsx	Oversigtsside med links til de forskellige quiz-anbefalinger.

ğŸ¤– Prompt og anbefalinger
Systemet genererer anbefalinger ud fra:

Enighedsniveau i svar (grÃ¸n, gul, rÃ¸d)

SpÃ¸rgsmÃ¥lenes ordlyd

Baggrundshistorie skrevet i quiz_meta.background

Brugeren kan tilfÃ¸je "mÃ¥ ikke nÃ¦vnes"-ord (som f.eks. "utroskab") i baggrunden

Anbefalinger cacheâ€™s fÃ¸rste gang og vises hurtigt nÃ¦ste gang

/**
 * README OPDATERING - Widget System (15. juni 2025)
 *
 * âœ… Funktion:
 * Vi har bygget et fleksibelt widget-system til dashboardet. Hver bruger kan have egne widgets,
 * vÃ¦lge rÃ¦kkefÃ¸lge, bredde (layout) og hÃ¸jde â€“ alt styret via Supabase-tabellen `dashboard_widgets`.
 *
 * âœ… Database-struktur (`dashboard_widgets`):
 * - `user_id` (UUID)
 * - `widget_key` (text)
 * - `enabled` (boolean)
 * - `layout` ('small' | 'medium' | 'large')
 * - `height` ('auto' | 'medium' | 'large')
 * - `order` (int)
 *
 * âœ… Frontend struktur:
 * - /app/dashboard/page.tsx henter widgets for den aktive bruger og sorterer dem efter `order`
 * - Kun `supportedWidgets` vises (validering mod eksisterende komponenter)
 * - Hver widget-render placeres med Tailwind-klasse baseret pÃ¥ `layout` og `height`
 * - Alle visuelle wrappers (border, shadow) sker i denne fil â€“ ikke i den enkelte komponent
 *
 * âœ… Opdateringssider:
 * - /settings/widgets: VÃ¦lg hvilke widgets der er synlige for hver bruger
 * - /settings/widgets/layout: VÃ¦lg rÃ¦kkefÃ¸lge, bredde og hÃ¸jde pr. bruger pr. widget
 *
 * ğŸ”’ BemÃ¦rk:
 * - Widget-komponenter mÃ¥ ikke selv have `Card`, `shadow`, `border`, `bg-white` â€“ det gives herfra
 * - Manglende komponenter vises som "Ukendt widget" eller skjules via `supportedWidgets`
 */

 ## Seneste opdatering: 2025-06-15 ##

### Overblik
Denne README dokumenterer de nyeste Ã¦ndringer og funktioner implementeret i dashboard-projektet.

---

### ğŸ”§ Funktionelle Ã¦ndringer

#### Widgets og layout
- Alle widgets understÃ¸tter nu bÃ¥de hÃ¸jde (`height`) og bredde (`layout`), som styres via Supabase-tabellen `dashboard_widgets`.
- Implementeret tre nye komponenter:
  - `/components/widgets/XpMeter.tsx`
  - `/components/widgets/TaskSummary.tsx`
  - `/components/widgets/RewardProgress.tsx`
- Alle widgets respekterer nu bÃ¥de hÃ¸jde og bredde ift. visning.
- `WidgetRenderer` opdateret til at sende `height` korrekt videre til komponenterne.

#### Widget administration
- Ny side: `/settings/widgets/layout` giver mulighed for at administrere layout, rÃ¦kkefÃ¸lge og hÃ¸jde pr. widget pr. bruger.
- Eksisterende side `/settings/widgets` opdateret til at automatisk oprette alle widgets ved manglende entries i `dashboard_widgets`.

#### Mobilvenligt layout
- Widget-kort vises nu i `col-span-12` pÃ¥ mobil for at udnytte hele bredden.

---

### ğŸ§­ Navigation & Sidebar
- Sidebar opdateret:
  - Alle adgangskontroller er fastholdt.
  - Dashboard-link vises nu altid.
  - Dropdowns virker igen, inkl. `personlighed`, som tidligere manglede toggling.
  - `onClick`-handlers opdateret til ogsÃ¥ at inkludere `personlighed`.
- Mobilnavigation fungerer nu korrekt â€“ inkl. dropdowns og link til â€œâœ¨ Mit Dashboardâ€.

---

### Supabase
**Opdateringer til tabeller:**
- `dashboard_widgets`: tilfÃ¸jet og anvendt felter `layout`, `height`, `order`, `enabled`.

---

### Design & UI
- Widgets vokser nu responsivt med stÃ¸rre `height` og `layout`.
- UI forbedret til bÃ¥de desktop og mobil.

---

### NÃ¦ste skridt
- Test af point og tilskrivelse pÃ¥ forside widget

---


## Dags dato: 2025-06-16 â€” Opdatering af quiz-funktioner, anbefalinger og database ##

| Funktion                   | Beskrivelse                                                                                                                |
| -------------------------- | -------------------------------------------------------------------------------------------------------------------------- |
| Pause og genoptag quiz     | Brugere kan nu forlade en quiz og vende tilbage senere â€“ svar gemmes lÃ¸bende i databasen.                                  |
| Quiz-overblik              | Oversigtsside viser alle quizzer med antal spÃ¸rgsmÃ¥l og status (pÃ¥begyndt / fuldfÃ¸rt).                                     |
| Genoptag-knap              | Hvis en quiz er startet men ikke fÃ¦rdiggjort, vises â€œFortsÃ¦t â€“ X spÃ¸rgsmÃ¥l tilbageâ€ i stedet for â€œStart quizâ€.             |
| Overordnet anbefaling      | Implementeret sÃ¦rskilt anbefalingsside: `/fantasy/anbefalinger/generel`. Viser senest genererede anbefaling samt historik. |
| Knap-feedback              | NÃ¥r anbefaling genereres, skifter knaptekst fra â€œGenerer nyâ€ til â€œKlarâ€, og resettes ved reload.                           |
| Bedre `Tilbage`-navigation | â€œTilbageâ€-knap i quiz fungerer korrekt og er nu aktiv pÃ¥ side 2+.                                                          |

ğŸ—ƒï¸ Nye og Ã¦ndrede database-tabeller

| Tabel            | Kolonner                                                                        | Ã†ndring                                                                   |
| ---------------- | ------------------------------------------------------------------------------- | ------------------------------------------------------------------------- |
| `quiz_questions` | id, quiz\_key, question, type                                                   | Bruges til quiz-afvikling og overblik.                                    |
| `quiz_responses` | id, question\_id, user\_id, answer, session\_id, quiz\_key, status, created\_at | Udvidet med `session_id` og `status` for at kunne gemme ufÃ¦rdige quizzer. |
| `overall_meta`   | id, user\_id, recommendation, generated\_at                                     | Ny tabel til lagring af overordnede anbefalinger.                         |

ğŸ—‚ï¸ Opdaterede og nye filer
| Fil / Mappe                                  | Beskrivelse                                                               |
| -------------------------------------------- | ------------------------------------------------------------------------- |
| `/app/quiz/[quiz_key]/page.tsx`              | Quizside med autosave, pagination og visning af tidligere svar.           |
| `/app/parforhold/anbefalinger/page.tsx`      | Oversigt over quiz-anbefalinger + â€œGenerÃ©r nyâ€ for overordnet anbefaling. |
| `/app/fantasy/anbefalinger/generel/page.tsx` | Ny side som viser overordnet anbefaling + historik.                       |
| `/app/quiz/resultater/[quiz_key]/page.tsx`   | Resultatside efter fÃ¦rdiggÃ¸relse af quiz.                                 |
| `/components/ui/card.tsx`                    | Bruges til layout af quiz og anbefalinger.                                |
| `/lib/supabaseClient.ts`                     | Supabase-forbindelse.                                                     |
| `/app/api/overall-recommendation/route.ts`   | Serverless API der genererer anbefaling via OpenAI.                       |


ğŸ§  Forbedringer i UI
Quiz-knapper skifter til â€œFortsÃ¦tâ€ eller â€œSe resultatâ€ afhÃ¦ngigt af hvor langt brugeren er.

Progress-bar og antal viste spÃ¸rgsmÃ¥l er opdateret live.

Responsivt layout til mobil.

Tilbage-knap virker fra side 2 og frem.

Anbefaling skjules pÃ¥ oversigtssiden â€“ vises kun pÃ¥ detaljeside.

Knap skifter dynamisk fra â€œHenterâ€¦â€ â†’ â€œKlarâ€ â†’ â€œGenerer nyâ€ afhÃ¦ngig af status.

ğŸ’¾ Andet
Brug af upsert i Supabase for at gemme svar med mulighed for redigering.

Brug af session_id til at gruppere individuelle quizbesvarelser.

Alle kald til Supabase via await supabase.from(...).select().eq(...).in(...).order(...).

ğŸ¤– OpenAI-anbefaling baseret pÃ¥ flere datakilder
Vi har implementeret en AI-baseret anbefaling, der genereres ud fra brugerens samlede parforholdsdata. Den overordnede anbefaling genereres med OpenAI (GPT-4) og prÃ¦senteres pÃ¥ siden:
/fantasy/anbefalinger/generel

ğŸ§  Hvordan det virker
NÃ¥r brugeren klikker â€œGenerer nyâ€, kaldes et API-endpoint:
POST /api/overall-recommendation

Serverkoden henter data fra flere Supabase-tabeller (valgt dynamisk):

const { data: sources } = await supabase
  .from("recommendation_sources")
  .select("table_name")
  .eq("enabled", true)

Tabellen recommendation_sources bruges til at styre hvilke datakilder AIâ€™en skal bruge â€“ uden at Ã¦ndre kode.

ğŸ“Š FÃ¸lgende tabeller er (aktuelt) i brug:
| Tabelnavn           | FormÃ¥l                                |
| ------------------- | ------------------------------------- |
| `couple_background` | Bruges som baggrundstekst i prompt    |
| `checkin`           | Behovsindmeldinger og evalueringer    |
| `sexlife_logs`      | Registrering af seksuelle aktiviteter |
| `quiz_responses`    | Svar fra parquiz                      |
| `quiz_questions`    | Kontekst til quiz-responsanalyse      |
| `tasks_couple`      | FÃ¦lles opgaver og planlÃ¦gning         |
| `bucketlist_couple` | FÃ¦lles drÃ¸mme og mÃ¥l                  |

ğŸ“ OpenAI Prompt-struktur
Prompten der sendes til GPT-4 indeholder:

Baggrundstekst fra couple_background

JSON-dump af data fra de udvalgte tabeller

Instruktion: Du er parterapeut. Giv en samlet, personlig anbefaling...

ğŸ“¦ Output og lagring
Svaret fra OpenAI gemmes i tabellen overall_meta:

recommendation

generated_at

user_id

Den nyeste anbefaling vises pÃ¥ siden /fantasy/anbefalinger/generel, og tidligere anbefalinger vises som historik.

âš™ï¸ Fordel ved denne opsÃ¦tning
Let at tilfÃ¸je nye tabeller via frontend (Indstillinger > Tabeller)

Ingen kodeÃ¦ndringer krÃ¦ves for at medtage nye datakilder

Brugeren fÃ¥r Ã©n samlet, overskuelig anbefaling

## Dags dato: 2025-06-16 â€” Opdatering ##

ğŸ“‹ Quiz Admin (parquiz) â€“ opdatering
Vi har nu et komplet system til at administrere parquiz under /settings/game. Funktionerne inkluderer:

Funktioner i interface:
Quiz nÃ¸gle: Opret eller vÃ¦lg eksisterende quiz via quiz_key.

Beskrivelse: Rediger og gem beskrivelse for quizzen.

SvÃ¦rhedsgrad: VÃ¦lg mellem easy, medium og hard. Gemmes som effort i quiz_meta.

TilfÃ¸j spÃ¸rgsmÃ¥l: Med type boolean (ja/nej) eller scale (4 valgmuligheder).

Rediger og slet spÃ¸rgsmÃ¥l.

Drag & drop sortering af spÃ¸rgsmÃ¥l.

Udgiv quiz med en knap der sÃ¦tter published: true i quiz_meta.

Slet quiz fjerner alt fra bÃ¥de quiz_meta og quiz_questions.

DatabaseÃ¦ndringer:
quiz_meta har fÃ¥et tilfÃ¸jet kolonnen effort (varchar).

xp_settings har fÃ¥et nye rÃ¦kker til complete_parquiz for bÃ¥de stine og mads med effort-niveauerne:

easy

medium

hard

Integration med XP-system:
xp_settings-visningen under /settings/points er opdateret, sÃ¥ complete_parquiz nu vises under sektionen â€œForhold â€“ Parquizâ€ med effort-angivelse og mulighed for at redigere point.

ğŸ’¡ NÃ¦ste step: Implementere XP-logik nÃ¥r en quiz bliver gennemfÃ¸rt under /parforhold/parquiz.


âœ… Quiz Admin (/settings/game)
Oprettet mulighed for at redigere quizbeskrivelse og vÃ¦lge svÃ¦rhedsgrad (effort)

"Opdater quiz"-knappen vises nu kun hvis quiz er udgivet (published)

"Udgiv quiz"-knappen vises kun hvis quiz ikke er udgivet

"Slet quiz"-knappen er flyttet nederst og stÃ¥r nu side om side med "Opdater quiz"

NÃ¥r man klikker pÃ¥ "Opdater quiz", bliver man automatisk redirectet til /quiz/parquiz

âœ… Quizoversigt (/quiz/parquiz)
TilfÃ¸jet ny sektion "GennemfÃ¸rt quiz" nederst

Viser alle quizzer hvor status er submitted

Viser dato for gennemfÃ¸relse (fra quiz_responses.created_at)

TilfÃ¸jet "Se resultat"-knap for hver gennemfÃ¸rt quiz

ğŸ”„ Resultatside â€“ klargjort
Vi har identificeret at resultatvisning skal hente svar for begge brugere

Forberedt nÃ¦ste skridt: at vise spÃ¸rgsmÃ¥l + sammenlignende svar for Mads og Stine

Resultatvisning vil kobles med eksisterende OpenAI-anbefalinger

ğŸ§  GPT-anbefaling â€“ gennemgang
BekrÃ¦ftet at recommendation_sources bruges til at vÃ¦lge hvilke tabeller der skal inkluderes

GennemgÃ¥et struktur for hvordan man dynamisk inkluderer flere tabeller

Vi afventer implementering af promptforbedring pga. mavefornemmelse

## Dags dato: 2025-06-16 â€” Opdatering ##

ğŸ”¨ Hvad vi har implementeret og lÃ¸st:
1. Genopbygget hele quiz-resultatvisningen:
Viser begge brugeres svar

Viser spÃ¸rgsmÃ¥l grupperet i:

âœ… Enige (grÃ¸n)

ğŸŸ¡ SmÃ¥ forskelle (gul)

ğŸ”´ Store forskelle (rÃ¸d)

2. Visuelt:
Viser avatars og navne fra profiles

Dynamisk farvekodede kort

Doughnut- og bar-graf via Chart.js (visual fanen)

3. Anbefalinger:
Dynamisk hentet via /api/recommendations

Vises pÃ¥ egen fane

4. Tekniske forbedringer og debugging:
quizKey bliver korrekt decodeURIComponent() behandlet

TilfÃ¸jet console.log() for at debugge questions, answers, profiles

Supabase-kaldsfejl blev hÃ¥ndteret med console.error()

Vi fandt ud af at spÃ¸rgsmÃ¥l og svar returnerede tomt pga. %20 i quizKey

5. Frontend fix:
Fjernet spÃ¸rgsmÃ¥ls-tekst fra svarkort (bruger Ã¸nskede ikke at vise q.question)

Alt vises nu uden spÃ¸rgsmÃ¥lsfelt â€“ kun brugersvar

ğŸ” Kendte tabeller involveret:
quiz_questions â†’ for quiz_key, question, type, order

quiz_responses â†’ for quiz_key, session_id, question_id, user_id, answer

profiles â†’ for id, display_name, avatar_url

âœ… Nu virker:
Visning fungerer 100 % som tidligere

Svar vises med korrekt logik

Visuelle grafer og anbefalinger er aktive

Data loades dynamisk for hver quizKey

## Opdatering 2025-06-16 ##

Hvad vi har arbejdet pÃ¥
Implementering og fejlsÃ¸gning af quiz-resultatvisning i frontend (/app/components/result-component.tsx), der viser spÃ¸rgsmÃ¥l, svar, brugernes profiler, og en kategorisering af svarenes grad af enighed (grÃ¸n, gul, rÃ¸d).

TilfÃ¸jet visualisering af svarfordeling via Chart.js (Doughnut og Bar diagrammer).

Implementeret et API-kald til /api/recommendations for at hente personlig anbefaling fra OpenAI baseret pÃ¥ quiz-svar og supplerende data.

Optimeret hÃ¥ndtering af API-respons i frontend med loading state og fejlhÃ¥ndtering.

Opdateret backend-endpoint /api/recommendations/route.ts med dynamisk hÃ¥ndtering af quizKey og grupperede spÃ¸rgsmÃ¥l som del af prompt til OpenAI.

Bedre fejl- og statuslogning i bÃ¥de frontend og backend for at kunne debugge problemer med anbefalings-APIâ€™et.

Forbedret stabilitet i fetch-requests og tilpasning af svarformat mellem frontend og backend.

NuvÃ¦rende problematikker
Backend-API /api/recommendations returnerer stadig 500 fejl ved kald, hvilket betyder at anbefalingerne ikke bliver genereret korrekt.

Frontend modtager tomme eller fejlbehÃ¦ftede anbefalingsresultater og viser derfor fejl eller tomme anbefalinger.

Der arbejdes pÃ¥ at sikre at data til OpenAI-prompten er korrekte og fyldestgÃ¸rende for at fÃ¥ relevante anbefalinger.

Vi har fjernet flere fejl ved at tilfÃ¸je mere robust fejlhÃ¥ndtering og kontrol af input/output i API-kald.

Det er essentielt at verificere, at OpenAI API-nÃ¸glen er korrekt og at Supabase-tabeller og data indeholder valid information.

NÃ¦ste skridt
Debugge og lÃ¸se backend 500-fejlen i /api/recommendations/route.ts.

Teste at OpenAI prompt konstrueres korrekt med alle nÃ¸dvendige data.

Sikre at frontend korrekt hÃ¥ndterer og viser anbefalinger, herunder hÃ¥ndtering af tilfÃ¦lde hvor ingen anbefalinger returneres.

FortsÃ¦tte med at forbedre UX omkring visning af anbefalinger, loading, og fejl.

## Opdatering 2025-06-17 ##


Implementerede funktioner og forbedringer
Anbefalingssystem baseret pÃ¥ OpenAI:
Vi har bygget et dynamisk API, der henter data fra aktive tabeller i recommendation_sources, samler svar fra quizzer og bruger OpenAI GPT-4 til at generere personlige anbefalinger til par baseret pÃ¥ deres svar og Ã¸vrige data.
Anbefalingerne gemmes i tabellen overall_meta for caching, sÃ¥ vi undgÃ¥r unÃ¸dvendige API-kald til OpenAI ved gentagne forespÃ¸rgsler.

Visning af anbefalinger i front-end:
Vi har opdateret komponenten /app/components/result-component.tsx med faner til visning af resultater, visuelle data og anbefalinger. Anbefalingerne viser nu ogsÃ¥ en note nederst om, at data er hentet fra Supabase, hvis brugeren er admin (kan fjernes efter Ã¸nske).

Overordnet anbefalingsside (/fantasy/anbefalinger/generel):
Implementeret en lignende OpenAI-baseret anbefalingsfunktion, der henter data og viser den overordnede anbefaling med caching i overall_meta.

DatabaseÃ¦ndringer
Ny kolonne i overall_meta:
TilfÃ¸jet kolonnen quiz_key (tekst) for at kunne identificere anbefalinger per quiz. Dette har fjernet fejl ved forespÃ¸rgsler, der filtrerede pÃ¥ denne kolonne.
SQL tilfÃ¸jet for at opdatere eksisterende rÃ¦kker med et standard quiz_key

Tabel recommendation_sources:
Indeholder information om hvilke tabeller der er aktive som datakilder til anbefalingerne. API henter kun data fra tabeller, hvor enabled=true.

Ã˜vrigt
MiljÃ¸variabler og API-nÃ¸gle:
OpenAI API-nÃ¸glen skal vÃ¦re sat som miljÃ¸variabel OPENAI_API_KEY bÃ¥de lokalt i .env.local og i Railway eller anden deployment-platform for at undgÃ¥ fejl ved kald til OpenAI.

Deployment:
Tidligere fejl ved deployment er lÃ¸st ved at fjerne hardcoded API-nÃ¸gle fra koden og sikre korrekt miljÃ¸variabel-injektion.

# Opdatering d. 17. juni 2025 ##

### Fejl og debugging af quiz-resultat siden

**Problem:**
Ved gentagen navigation til en quizresultatside â€“ fx fra sidemenu og tilbage â€“ mistede anbefalingssektionen (`recommendations`) sine data, selvom de var korrekt vist fÃ¸rste gang. Symptomerne:

- FÃ¸rste gang siden indlÃ¦ses efter gennemfÃ¸rt quiz, fungerer alt korrekt.
- Ved navigation vÃ¦k og tilbage, vises kun spÃ¸rgsmÃ¥l og svar â€“ anbefaling forsvinder.
- Konsollen viser, at data (answers, questions, grouped) er til stede, men ingen ny anbefaling hentes.

**Debugging og Ã¦ndringer:**
- Brugt `useEffect` til at trigge fetch af anbefalinger.
- Skiftet fra `useMemo` til eksplicit `useState` og `setGrouped()` for at sikre re-evaluering.
- TilfÃ¸jet fallback rendering: `return <div className="text-center text-sm text-muted-foreground">Rendering fÃ¸lger...</div>` indtil data er klar.
- Fejlen er sandsynligvis forÃ¥rsaget af afhÃ¦ngigheder der ikke trigger en genberegning, nÃ¥r kun data kommer sekundÃ¦rt ind.

**Midlertidig lÃ¸sning:**
- `grouped` beregnes via separat `useEffect`, og opdateres med `setGrouped` nÃ¥r bÃ¥de questions og answers er loaded.
- Anbefaling hentes kun hvis grouped har indhold.
- Der logges aktivt til konsol for debugging.

**Status:**
Bug er delvist afhjulpet â€“ anbefaling hentes igen korrekt i de fleste tilfÃ¦lde, men fuld robusthed krÃ¦ver yderligere forbedringer i afhÃ¦ngighedslogik og dataflyt.

âœ… Opdatering â€“ 2025-06-18
Personlighedsmodul pÃ¥ profilsiden
ğŸ¨ Funktionel Ã¦ndring:

Der er tilfÃ¸jet en ny sektion/fane pÃ¥ /app/profile/page.tsx med navnet Personlighed.

Sektionen giver brugeren mulighed for at:

TrÃ¦kke fire farver i rÃ¦kkefÃ¸lge, som afspejler deres personlighed (baseret pÃ¥ DISC-lignende model):

ğŸ”´ RÃ¸d â€“ handlekraftig

ğŸŸ¡ Gul â€“ kreativ

ğŸŸ¢ GrÃ¸n â€“ omsorgsfuld

ğŸ”µ BlÃ¥ â€“ analytisk

Hver farve tildeles en prioritet fra 1 til 4, som gemmes i databasen.

Skrive en personlig beskrivelse i en textarea.

Indtaste fem frie nÃ¸gleord om sig selv.

ğŸ§  Teknisk implementering:

DnD (drag-and-drop) hÃ¥ndtering implementeret med @dnd-kit/core og @dnd-kit/sortable.

Hook-ordensfejl blev lÃ¸st ved at flytte useSensors uden for render-flowet.

Farvernes rÃ¦kkefÃ¸lge gemmes ved hjÃ¦lp af arrayMove, og prioritet udregnes via deres index-position.

Alle data lagres i Supabase gennem eksisterende handleSaveSizes() funktion.

ğŸ’¾ DatabaseÃ¦ndring (Supabase):
FÃ¸lgende nye kolonner er tilfÃ¸jet til profiles-tabellen:

sql
KopiÃ©r
Rediger
ALTER TABLE profiles
ADD COLUMN red text,
ADD COLUMN yellow text,
ADD COLUMN green text,
ADD COLUMN blue text,
ADD COLUMN personality_description text,
ADD COLUMN keyword_1 text,
ADD COLUMN keyword_2 text,
ADD COLUMN keyword_3 text,
ADD COLUMN keyword_4 text,
ADD COLUMN keyword_5 text;
ğŸ“‚ DatahÃ¥ndtering:

NÃ¥r brugeren gemmer sin profil, bliver farveprioriteter og personlighedsdata inkluderet i dataToSave og opdateret med supabase.from('profiles').update(...).

Felterne vises og redigeres i komponenten via state-objektet sizes.

ğŸ‘¤ UI / UX:

Fanen vises pÃ¥ profilsiden sammen med eksisterende faner (tÃ¸jstÃ¸rrelser, Ã¸nsker, etc.).

Designet fÃ¸lger det visuelle system med kort, afrundede bokse og blÃ¸de skygger.

Fuldt mobiloptimeret.

## README-opdatering â€“ 2025-06-19

### ğŸ”„ Overblik over Ã¦ndringer i denne session

#### ğŸ§  GPT Anbefalingssystem: 
Vi har arbejdet massivt pÃ¥ at gÃ¸re GPT-anbefalinger mere effektive, gennemsigtige og konfigurerbare:

#### ğŸ§¾ Nye database-tabeller
- `gpt_log`: Logger alle GPT-kald med prompt preview, model, tokenforbrug og tidspunkt.
- `recommendation_sources`: Indeholder prioriterede datakilder med beskrivelse og aktivering ("enabled").
- `widget_config`: Brugerkonfiguration af GPT-widgets (tonalitet, valgte tabeller, udeladelsesord).

#### ğŸ“ Nye og opdaterede filer
- **`/lib/gptHelper.ts`**
  - TilfÃ¸jet `generateGptRecommendation` med logging til `gpt_log`.
  - TilfÃ¸jet `getTokensForText` til estimering af tokenforbrug.

- **`/lib/generateWeeklyRecommendation.ts`**
  - Omskrevet til at bruge `getTokensForText` og stoppe ved 12000 tokens.
  - Logger alle GPT-kald.

- **API routes oprettet og/eller opdateret:**
  - `/api/weekly-recommendation`
  - `/api/generate-recommendation`
  - `/api/overall-recommendation`
  - Alle anvender `generateGptRecommendation` og logger til `gpt_log`

- **Frontend-side oprettet:**
  - `/settings/gpt/api/page.tsx`
    - Viser seneste 50 GPT-kald fra `gpt_log` med model, tidspunkt og tokenforbrug.

- **Sidebar-opdatering:**
  - TilfÃ¸jet korrekt undermenu for `Indstillinger > Gpt > API kald`.
  - Fejl i visning og tilstandsstyring er blevet debugget og rettet.

#### âš ï¸ Aktuelle problemer (skal lÃ¸ses i nÃ¦ste session)
1. **`/api/overall-recommendation` fejler med `Manglende data`**
   - FejlhÃ¥ndtering i route skjuler reelt input; `groupedQuestions` bliver `null`.

2. **`gpt_log` er tom efter kald**
   - Fordi ruten ikke nÃ¥r frem til GPT-kaldet pga. valideringsfejl.

3. **Side `/settings/gpt/api`**
   - Fungerer, men virker tom fordi der endnu ikke er loggede data.

4. **Manglende initial `getTokensForText` eksport**
   - Blev tilfÃ¸jet og integreret efter fejl i import.

5. **TokenbegrÃ¦nsning fungerer men krÃ¦ver bedre feedback**
   - Det er svÃ¦rt at se hvor tokens bruges â€“ mulig forbedring: visualisering per tabel.

6. **Sidebar state hÃ¥ndtering har vÃ¦ret ustabil**
   - Vi har forsÃ¸gt at refaktorere for at gÃ¸re det mere vedligeholdbart, men det blev for omfattende â€“ nÃ¦ste session bÃ¸r overveje at vende tilbage til enkel if-baseret state.

---

### ğŸ“ NÃ¦ste skridt
- FÃ¥ `overall-recommendation` til at virke (rettelse af JSON-parse blok).
- BekrÃ¦ft at data bliver logget i `gpt_log`.
- Implementer en visuel indikator pÃ¥ hvor tokens bliver brugt (pr. tabel).
- OptimÃ©r Sidebar hvis det stadig giver ustabil visning af undermenuer.

---

ğŸ—“ Opdatering â€“ 21. juni 2025
ğŸ® Nyt spil: "Tryk pÃ¥ min knap"
Et spil hvor Ã©n partner svarer pÃ¥ et spÃ¸rgsmÃ¥l (Elsker / Usikker / Trigger), og den anden forsÃ¸ger at gÃ¦tte svaret. Kun den der gÃ¦tter korrekt fÃ¥r XP.

âœ… Implementeret funktionalitet
Ny side:

/games/knob/page.tsx â€“ fuld spiloplevelse (visning, roller, svar)

Spillogik:

To faser: respond og guess

Rollen fastsÃ¦ttes ud fra Supabase-tabel knob_game_sessions

Svar gemmes i knob_game_answers

Automatisk tildeling af gÃ¦tterrolle via RPC-funktion create_knob_guess_session

checkGuessStatus() checker om begge har svaret, og sammenligner

Rollevisning:

Responders ser selve spÃ¸rgsmÃ¥let og vÃ¦lger svar

Guessers ser â€œGÃ¦t din partners svarâ€

NÃ¥r begge har svaret: viser om gÃ¦t var korrekt, og starter nyt spÃ¸rgsmÃ¥l

ğŸ—ƒ Oprettet i Supabase
ğŸ“„ Tabeller:
1. knob_game_questions

id (uuid)

question (text)

2. knob_game_sessions

id (uuid)

user_id (uuid) â†’ den der starter spÃ¸rgsmÃ¥let (responder)

question_id (uuid)

role (text: 'responder' / 'guesser')

created_at (timestamp)

3. knob_game_answers

id (uuid)

user_id (uuid)

question_id (uuid)

value (text: 'love' / 'uncertain' / 'trigger')

role (text: 'responder' / 'guesser')

created_at (timestamp)

âš™ï¸ RPC-funktioner:
1. get_next_knob_question(user_id)

Returnerer et tilfÃ¦ldigt spÃ¸rgsmÃ¥l, som brugeren endnu ikke har svaret pÃ¥.

2. create_knob_guess_session(responder_id, question_id)

IndsÃ¦tter en ny knob_game_sessions-rÃ¦kke med partnerens ID og rollen guesser.

ğŸ¨ Frontend-funktioner
HÃ¥ndtering af responder vs guesser

Automatisk polling hvert 3. sekund for guess-fasen

Feedback: â€œğŸ‰ Korrekt gÃ¦tâ€, â€œğŸ˜… Forkert gÃ¦tâ€

Statusbesked: â€œâœ… Svar gemt! Vent pÃ¥ din partner...â€

Bruger partner_id fra profiles til at finde hinanden

ğŸ”œ NÃ¦ste session â€“ To Do
ğŸ“Œ Funktionalitet:
 XP-tildeling ved korrekt gÃ¦t (brug xp_log og xp_settings)

Action: knob_guess_correct

Skal understÃ¸tte bÃ¥de mads og stine i xp_settings

 TilfÃ¸j til /settings/points:

Ny sektion: Spil â€“ Tryk pÃ¥ min knap

Handling: knob_guess_correct

XP-vÃ¦rdi skal kunne redigeres individuelt for begge brugere

ğŸ§  Spilflow:
 GÃ¦tteren skal ikke se spÃ¸rgsmÃ¥let fÃ¸r responder har svaret

 Begge skal se status â€œafventer partnerâ€ korrekt

 Nyt spÃ¸rgsmÃ¥l hentes korrekt efter gÃ¦t er givet

âœ… Opdatering 22/6 - 2025: Nyt spil â€“ Tryk pÃ¥ min knap
Der er nu implementeret et fuldt funktionelt spil til parforholdet, hvor den ene partner vÃ¦lger et fÃ¸lelsesmÃ¦ssigt svar pÃ¥ et spÃ¸rgsmÃ¥l, og den anden forsÃ¸ger at gÃ¦tte svaret. Systemet bygger videre pÃ¥ vores XP-gamification-struktur og benytter Supabase.

Side: /spil/knob

Funktionalitet
Spillet foregÃ¥r skiftevis mellem to faser: respond (vÃ¦lg fÃ¸lelse) og guess (gÃ¦t partnerens svar).

Mulige svar: Elsker, Usikker, Trigger

NÃ¥r begge har svaret, evalueres om svaret matcher:

Korrekt gÃ¦t â†’ XP til guesser (tages fra xp_settings)

Forkert gÃ¦t â†’ Ingen XP

Visuel status vises pÃ¥ skÃ¦rmen (â€œKorrekt gÃ¦t! Du har fÃ¥et XP!â€ eller â€œForkert gÃ¦t â€“ men godt forsÃ¸gt!â€)

NÃ¥r begge har svaret, starter en ny runde automatisk for den person, der var responder.

Teknisk implementering
State management: phase, sessionRole, question, status, hasAnswered, responderHasAnswered

XP-hÃ¥ndtering:

Henter XP fra xp_settings med action guess_knob_correct

Logger point til xp_log med beskrivelse

Realtime polling:

checkGuessStatus() kÃ¸rer hvert 3. sekund i guess-fasen

checkForNewSession() tjekker for nye sessioner i wait-fasen

Fejlbeskyttelse:

Dublet-svar forhindres

Ventefase aktiveres korrekt hvis partner endnu ikke har svaret

Session-flow:

Nye sessions oprettes med Supabase RPC: create_knob_session

Nye spÃ¸rgsmÃ¥l hentes via get_next_knob_question

DatabaseÃ¦ndringer
Ny tabel: knob_game_sessions (session med user_id og question_id)

Ny tabel: knob_game_answers (svar pr. session, rolle og bruger)

XP-log fÃ¸res i eksisterende xp_log tabel

XP konfigureres via eksisterende xp_settings med:

role: guesser

action: guess_knob_correct

effort: null

Teststatus
âœ… Ny session oprettes korrekt

âœ… Begge brugere fÃ¥r samme spÃ¸rgsmÃ¥l

âœ… Kun responder kan svare fÃ¸rst

âœ… Guesser fÃ¥r fÃ¸rst mulighed nÃ¥r responder har svaret

âœ… Guesser fÃ¥r XP hvis svar matcher

âœ… NÃ¦ste spÃ¸rgsmÃ¥l vises automatisk for responder

âœ… Guesser venter korrekt efter forkert gÃ¦t

âœ… XP bliver logget korrekt med beskrivelse

âœ… Debug og konsolvisning hjÃ¦lper til fejlfinding

2025-06-25 â€“ Dynamisk profilopslag i anbefalingssystemet
Opdateringer:

Alle API-endpoints til anbefalinger bruger nu dynamisk profilopslag fra Supabase.

Felter i tabellen profiles bruges automatisk i prompten til GPT, sÃ¥ nye felter (fx kÃ¦rlighedssprog, vÃ¦rdier mv.) bliver medtaget uden kodeÃ¦ndringer.

GÃ¦lder /api/weekly-recommendation/route.ts, /api/overall-recommendation/route.ts, /api/recommendations/route.ts, /api/generate-recommendation/route.ts, og /api/quiz-recommendation/route.ts.

Modelvalg for GPT (gpt-3.5-turbo eller gpt-4) er stadig dynamisk og hentes fra tabellen gpt_settings (key = default_model).

Tone, tabeller og ekskluderede ord kan nu styres dynamisk fra Supabase via widget_config (pÃ¥ f.eks. /settings/recommendation).

Tidligere hardcodede farvefelter, keywords mv. er fjernet til fordel for automatisk generering af profiloplysninger i prompten.

Endpoints til at generere anbefalinger, bÃ¥de ugentlig og overordnet, opretter nu data til korrekt modtager/afsender, sÃ¥ modtageren fÃ¥r anbefalingen vist pÃ¥ dashboard.

Status-endpoint /api/gpt-status/route.ts er uÃ¦ndret.

Ingen Ã¦ndringer til tabellerne â€“ kun kode, sÃ¥ evt. nye kolonner pÃ¥ profilen bruges automatisk.

Seneste flow:

TilfÃ¸j felter til profiles-tabellen â†’ de bruges i anbefalinger uden kodeÃ¦ndring.

Skift GPT-model og parametre via indstillingsside.

Generering, visning og opdatering af anbefalinger fungerer nu uden hardcoding af feltnavne.

Udviklingslog d. 25/6 - 2025
Nyt modul: Indtjekning â€“ Hverdag
Oprettet ny side /indtjekning/hverdag til daglig indtjekning.

Felter: Dato (med kalendervÃ¦lger), "Var I sammen i dag?", "Var der konflikt?", stemningsbarometer (Frost, KÃ¸lig, Neutral, Lun, Hed).

Data gemmes i Supabase-tabel daily_checkin med felter: user_id, checkin_date, was_together, conflict, mood.

Seneste 5 registreringer vises under formularen, inkl. dato, stemning, "Sammen"/"Ikke sammen" og "Konflikt".

Kalenderfeltet bruger react-day-picker til at vÃ¦lge dato. (Vi har forsÃ¸gt at markere registrerede dage i kalenderen, men dette virker ikke stabilt pt. â€“ funktionen er sat pÃ¥ pause.)

Formularen er responsiv og bruger eksisterende layout- og btn-klasser.

Brugeren skal vÃ¦re logget ind for at indsende og se egne registreringer.

Validering: Alle felter skal udfyldes for at kunne gemme.

Alt data hentes/synkroniseres fra Supabase ved render og submit.

Teknisk
Ny tabel daily_checkin oprettet med felter:

id uuid PRIMARY KEY

user_id uuid (foreign key)

checkin_date date

was_together boolean

conflict boolean

mood smallint

created_at timestamp

Frontend bruger @supabase/auth-helpers-react til user-auth og dataadgang.

Kalender: react-day-picker er implementeret, men markering af eksisterende registreringer i kalenderen udestÃ¥r.

Opdatering â€“ 25. juni 2025
Nye funktioner
Der er nu oprettet en komplet indtjekningsside for sexlivsregistrering, hvor man kan logge dato, tidspunkt, initiativ, type, stillinger, placering, sted og tags.

Alle valg kan tilfÃ¸jes, vÃ¦lges, slettes og genbruges som chips med farver.

Database-struktur
FÃ¸lgende tabeller er oprettet/tilpasset i Supabase til brug for sexlivslogning:

sexlife_logs
Indeholder selve hovedloggen for hver registrering:

id (uuid)

log_datetime (timestamp)

log_date (date)

log_time (text eller time)

had_sex (bool)

initiator (text)

sex_type (text)

sex_positions
Liste over mulige stillinger, der kan vÃ¦lges og tilfÃ¸jes af brugeren.

sexlife_log_positions
Relationstabel der forbinder logs og stillinger (mange-til-mange):

log_id (uuid, FK til sexlife_logs)

position_id (uuid, FK til sex_positions)

sex_locations
Liste over mulige placeringer.

sexlife_log_locations
Relationstabel for placeringer pr. log (mange-til-mange).

sex_places
Liste over steder ("huller" eller lokationer, f.eks. oralt, analt, vaginalt).

sexlife_log_places
Relationstabel for steder pr. log (mange-til-mange).

sex_tags
Liste over tags som kan bruges frit â€“ fx "bj", "hurtig", "langsom", "udenfor".

sexlife_log_tags
Relationstabel for tags pr. log (mange-til-mange).

Alle relationstabeller er opsat til mange-til-mange (log_id, [type]_id), og bruger uuid som primÃ¦r nÃ¸gle.

Frontend
Chips vises farvet og med â€œsletâ€-kryds i alle sektioner.

Der tages hÃ¸jde for at brugeren ikke kan vÃ¦lge eller gemme tags der er blevet slettet i databasen.

Alle relationer bliver ryddet efter en registrering, sÃ¥ nÃ¦ste indtastning starter frisk.

NÃ¦ste skridt
Visualisering: NÃ¦ste trin bliver at vise data grafisk, f.eks. fordeling af initiativ, typer, mest brugte tags, udvikling over tid osv.
Dette vil ske pÃ¥ en ny side, hvor der vises grafer for alle de dimensioner, vi har oprettet (f.eks. via Chart.js eller lignende).

## README-opdatering â€“ 2025-06-28 ##


Sex-data visualisering (/app/data/sex/page.tsx)
Implementeret omfattende dashboard til visning af sexlogs og statistik.

TilfÃ¸jet â€œSexlivs-temperaturâ€-kasse i toppen, der mÃ¥ler antal dage siden sidste sex.
Farve, emoji og tekst skifter dynamisk baseret pÃ¥ antal dage.

â€œTendens mÃ¥ned for mÃ¥nedâ€ er nu Ã¦ndret til â€œTendens pr. 14. dagâ€ for mere nuanceret overblik.

Seksuelle handlinger pr. mÃ¥ned og sex-type vises via Bar og Doughnut charts.

Oralsex-sektion tilpasset, sÃ¥ den virker med to forskellige tags (â€œOralsex til Madsâ€ og â€œOralsex til Stineâ€).

Statistik pÃ¥ oralsex for bÃ¥de Mads og Stine vises for de seneste 3 mÃ¥neder og samlet for Ã¥ret.

Implementeret sammenligning mellem almindelig sex og anal sex pr. mÃ¥ned med procentvis fordeling.

Nederst tre responsive statistik-kasser:

Placeringer: Visning af mest brugte placeringer, sorteret med den mest brugte Ã¸verst.

Stillinger: Visning af de mest anvendte sexstillinger, sorteret med flest hits Ã¸verst.

PrÃ¸vede noget nyt: Viser seneste gang â€œprÃ¸vede noget nytâ€ var afkrydset og teksten herfra.

Kasse for â€œSidste fantasiâ€ opdateret med farve, emoji og besked, der tilpasses hvor lÃ¦nge siden en fantasi er opfyldt.

Al logik er lavet sÃ¥ det kan udvides til andre analyser fremadrettet.

Databasen:

TilfÃ¸jet felterne tried_something_new (boolean) og tried_something_new_text (text) til tabellen sexlife_logs.

Ingen Ã¦ndringer i Ã¸vrige tabeller i dag.

Status:
Siden giver nu komplet og visuelt overblik over jeres sexliv og udvikling, med flere motiverende og sjove features.

## Opdatering 29-06-2025 ##


Fokus:

Indtjekning Hverdag (daglig stemningsregistrering, tags, fÃ¸lelser/tanker, konfliktbeskrivelser)

Visualisering af data pÃ¥ /data/hverdag

Widget til ugentlig anbefaling (/components/widgets/WeeklyRecommendation.tsx)

Indtjekning Hverdag
Ny version af indtjekningsside (med stemningsbarometer, konfliktbeskrivelse og kategoriserede fÃ¸lelses/tanke-tags)

Mulighed for at tilfÃ¸je egne fÃ¸lelser/tanker med kategori

FejlhÃ¥ndtering og loading states forbedret

Konflikt-beskrivelse vises kun ved valg af â€œjaâ€ til konflikt

Tags gemmes korrekt som array i Supabase

Data-visualisering /data/hverdag
Doughnut chart for stemningsfordeling (mood)

Bar chart for de hyppigste fÃ¸lelser/tanker (tags)

Line chart med udvikling i positive vs negative tags pr. mÃ¥ned (med mulighed for at vÃ¦lge antal mÃ¥neder)

Alle grafer er responsive og der er tilfÃ¸jet ekstra padding/mellemrum mellem sektioner

Ugentlig anbefalings-widget
Widgeten henter anbefaling fra Supabase og viser den til korrekt bruger (profil)

BÃ¥de brugerens og partnerens navn hentes live fra Supabase (display_name)

Anbefalingstekst kan nu indeholde enten {{partner_name}}-placeholder eller UUID, der automatisk udskiftes til brugernavn

XP kan optjenes ved at markere anbefaling som fuldfÃ¸rt (opdaterer xp_log og sÃ¦tter fulfilled i Supabase)

FejlhÃ¥ndtering og debug-logs tilfÃ¸jet, sÃ¥ fejl fra Supabase og evt. manglende felter logges tydeligt

Tekniske Ã¦ndringer
Alle user-id afhÃ¦ngigheder pÃ¥ indtjekning fjernet (for at kunne bruges â€œprivatâ€/solo)

Koden konsolideret, sÃ¥ samme feltnavne bruges pÃ¥ tvÃ¦rs af database og frontend (fx display_name)

CSV for profiles gennemgÃ¥et â€“ kolonnenavn til navn er nu display_name

Alle queries opdateret til at matche dette

